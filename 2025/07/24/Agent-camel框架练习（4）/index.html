<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="原作者链接🔗：https:&#x2F;&#x2F;fmhw1n4zpn.feishu.cn&#x2F;docx&#x2F;AF4XdOZpIo6TOaxzDK8cxInNnCe Task1通过调用API或本地部署reranker模型来快速将rerank模块集成到RAG应用中https:&#x2F;&#x2F;github.com&#x2F;camel-ai&#x2F;camel&#x2F;blob&#x2F;master&#x2F;camel&#x2F;retrievers&#x2F;cohere_rerank_retr">
<meta property="og:type" content="article">
<meta property="og:title" content="Agent-camel框架练习（4）">
<meta property="og:url" content="http://example.com/2025/07/24/Agent-camel%E6%A1%86%E6%9E%B6%E7%BB%83%E4%B9%A0%EF%BC%884%EF%BC%89/index.html">
<meta property="og:site_name" content="_010001SUTANG_">
<meta property="og:description" content="原作者链接🔗：https:&#x2F;&#x2F;fmhw1n4zpn.feishu.cn&#x2F;docx&#x2F;AF4XdOZpIo6TOaxzDK8cxInNnCe Task1通过调用API或本地部署reranker模型来快速将rerank模块集成到RAG应用中https:&#x2F;&#x2F;github.com&#x2F;camel-ai&#x2F;camel&#x2F;blob&#x2F;master&#x2F;camel&#x2F;retrievers&#x2F;cohere_rerank_retr">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-07-24T13:40:59.000Z">
<meta property="article:modified_time" content="2025-07-25T12:32:20.762Z">
<meta property="article:author" content="Su Tang">
<meta property="article:tag" content="AI">
<meta property="article:tag" content="CAMEL">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2025/07/24/Agent-camel%E6%A1%86%E6%9E%B6%E7%BB%83%E4%B9%A0%EF%BC%884%EF%BC%89/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2025/07/24/Agent-camel%E6%A1%86%E6%9E%B6%E7%BB%83%E4%B9%A0%EF%BC%884%EF%BC%89/","path":"2025/07/24/Agent-camel框架练习（4）/","title":"Agent-camel框架练习（4）"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Agent-camel框架练习（4） | _010001SUTANG_</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">_010001SUTANG_</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">To ancient evenings and distant music.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Task1"><span class="nav-number">1.</span> <span class="nav-text">Task1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E8%B0%83%E7%94%A8API%E6%88%96%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2reranker%E6%A8%A1%E5%9E%8B%E6%9D%A5%E5%BF%AB%E9%80%9F%E5%B0%86rerank%E6%A8%A1%E5%9D%97%E9%9B%86%E6%88%90%E5%88%B0RAG%E5%BA%94%E7%94%A8%E4%B8%AD"><span class="nav-number">1.1.</span> <span class="nav-text">通过调用API或本地部署reranker模型来快速将rerank模块集成到RAG应用中</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Task2"><span class="nav-number">2.</span> <span class="nav-text">Task2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E5%92%8C%E7%AE%80%E5%8D%95%E7%9A%84%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%9C%A8CAMEL%E6%A1%86%E6%9E%B6%E4%B8%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAReRanker%EF%BC%8C%E8%BE%BE%E6%88%90%E9%87%8D%E6%8E%92%E7%9A%84%E6%95%88%E6%9E%9C%EF%BC%88%E7%81%B5%E6%84%9F%E6%9D%A5%E8%87%AACAMEL-Shanghai-Hackathon%E9%9F%AC%E5%AD%90%E5%93%A5QAQ%EF%BC%89"><span class="nav-number">2.1.</span> <span class="nav-text">使用大语言模型和简单的提示词工程在CAMEL框架下实现一个ReRanker，达成重排的效果（灵感来自CAMEL Shanghai Hackathon韬子哥QAQ）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8ETask1%E5%92%8CTask2%E7%9A%84%E5%8C%BA%E5%88%AB%E6%80%9D%E8%80%83%EF%BC%9A%E8%BF%99%E4%B8%A4%E4%B8%AA%E4%BB%BB%E5%8A%A1%E9%83%BD%E6%B6%89%E5%8F%8A%E5%9C%A8RAG%E5%BA%94%E7%94%A8%E4%B8%AD%E9%9B%86%E6%88%90%E9%87%8D%E6%8E%92%EF%BC%88ReRanker%EF%BC%89%E6%A8%A1%E5%9D%97%EF%BC%8C%E4%BD%86%E5%AE%83%E4%BB%AC%E5%9C%A8%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%E5%92%8C%E6%89%80%E4%BE%9D%E8%B5%96%E7%9A%84%E6%8A%80%E6%9C%AF%E6%A0%88%E4%B8%8A%E5%AD%98%E5%9C%A8%E6%98%BE%E8%91%97%E5%8C%BA%E5%88%AB%EF%BC%9A"><span class="nav-number">2.2.</span> <span class="nav-text">关于Task1和Task2的区别思考：这两个任务都涉及在RAG应用中集成重排（ReRanker）模块，但它们在实现方式和所依赖的技术栈上存在显著区别：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Task-1%EF%BC%9A%E5%9F%BA%E4%BA%8EAPI%E8%B0%83%E7%94%A8%E6%88%96%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%E7%9A%84%E9%A2%84%E8%AE%AD%E7%BB%83Reranker%E6%A8%A1%E5%9E%8B%E9%9B%86%E6%88%90"><span class="nav-number">2.2.1.</span> <span class="nav-text">Task 1：基于API调用或本地部署的预训练Reranker模型集成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Task-2%EF%BC%9A%E5%9F%BA%E4%BA%8E%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E5%92%8C%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%AE%9E%E7%8E%B0Reranker"><span class="nav-number">2.2.2.</span> <span class="nav-text">Task 2：基于大语言模型和提示词工程实现Reranker</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E5%8C%BA%E5%88%AB%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="nav-number">2.3.</span> <span class="nav-text">核心区别总结：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Task3"><span class="nav-number">3.</span> <span class="nav-text">Task3</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%87%BA%E6%9C%AC%E6%95%99%E7%A8%8B%E6%96%87%E6%A1%A3%E4%BD%9C%E4%B8%BA%E4%B8%80%E4%B8%AAPDF%E6%96%87%E4%BB%B6%EF%BC%8C%E5%B0%9D%E8%AF%95%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%85%B7%E6%9C%89%E5%A4%9A%E6%A8%A1%E6%80%81%E6%A3%80%E7%B4%A2%E8%83%BD%E5%8A%9B%E7%9A%84RAG%E5%BA%94%E7%94%A8%E6%9D%A5%E5%B8%AE%E5%8A%A9%E5%85%B6%E4%BB%96%E5%AD%A6%E4%B9%A0%E8%80%85%E5%9B%9E%E7%AD%94%E9%97%AE%E9%A2%98%E3%80%82"><span class="nav-number">3.1.</span> <span class="nav-text">导出本教程文档作为一个PDF文件，尝试搭建一个具有多模态检索能力的RAG应用来帮助其他学习者回答问题。</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%A4%E4%BA%92%E5%BC%8F%E5%A4%9A%E6%A8%A1%E6%80%81RAG%E7%B3%BB%E7%BB%9F"><span class="nav-number">3.1.1.</span> <span class="nav-text">交互式多模态RAG系统</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B"><span class="nav-number">3.1.1.1.</span> <span class="nav-text">项目简介</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="nav-number">3.1.1.2.</span> <span class="nav-text">核心特性</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%A4%9A%E6%A8%A1%E6%80%81%E5%86%85%E5%AE%B9%E5%A4%84%E7%90%86"><span class="nav-number">3.1.1.2.1.</span> <span class="nav-text">多模态内容处理</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%A4%9A%E7%A7%8D%E6%A3%80%E7%B4%A2%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.1.1.2.2.</span> <span class="nav-text">多种检索模式</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#AI%E6%99%BA%E8%83%BD%E5%88%86%E6%9E%90"><span class="nav-number">3.1.1.2.3.</span> <span class="nav-text">AI智能分析</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%BD%91%E9%A1%B5%E7%A0%94%E7%A9%B6%E7%B3%BB%E7%BB%9F"><span class="nav-number">3.1.1.2.4.</span> <span class="nav-text">网页研究系统</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BA%A4%E4%BA%92%E5%BC%8F%E4%BD%93%E9%AA%8C"><span class="nav-number">3.1.1.2.5.</span> <span class="nav-text">交互式体验</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84"><span class="nav-number">3.1.1.3.</span> <span class="nav-text">系统架构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%A1%86%E6%9E%B6"><span class="nav-number">3.1.1.4.</span> <span class="nav-text">核心框架</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%87%E6%A1%A3%E5%A4%84%E7%90%86"><span class="nav-number">3.1.1.5.</span> <span class="nav-text">文档处理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A3%80%E7%B4%A2%E5%92%8C%E5%AD%98%E5%82%A8"><span class="nav-number">3.1.1.6.</span> <span class="nav-text">检索和存储</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BD%91%E9%A1%B5%E7%88%AC%E5%8F%96"><span class="nav-number">3.1.1.7.</span> <span class="nav-text">网页爬取</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B"><span class="nav-number">3.1.2.</span> <span class="nav-text">基本使用流程</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD"><span class="nav-number">3.1.2.1.</span> <span class="nav-text">高级功能</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%BD%91%E9%A1%B5%E7%A0%94%E7%A9%B6%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.1.2.1.1.</span> <span class="nav-text">网页研究模式</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A3%80%E7%B4%A2%E5%8F%82%E6%95%B0"><span class="nav-number">3.1.2.1.2.</span> <span class="nav-text">自定义检索参数</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A3%80%E7%B4%A2%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.1.2.2.</span> <span class="nav-text">检索模式</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E6%A3%80%E7%B4%A2"><span class="nav-number">3.1.2.2.1.</span> <span class="nav-text">快速检索</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%B7%B1%E5%BA%A6%E6%A3%80%E7%B4%A2"><span class="nav-number">3.1.2.2.2.</span> <span class="nav-text">深度检索</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%B8%BB%E9%A2%98%E6%A3%80%E7%B4%A2"><span class="nav-number">3.1.2.2.3.</span> <span class="nav-text">主题检索</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81%EF%BC%9A"><span class="nav-number">3.1.3.</span> <span class="nav-text">实现代码：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81%E4%B8%BB%E8%A6%81%E5%88%86%E4%B8%BA3%E4%B8%AA%E9%83%A8%E5%88%86%EF%BC%9A"><span class="nav-number">3.1.3.1.</span> <span class="nav-text">实现代码主要分为3个部分：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%88%91%E4%BB%AC%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%8B%E6%95%B4%E4%B8%AA%E7%B3%BB%E7%BB%9F%EF%BC%8C%E5%88%86%E5%88%AB%E6%B5%8B%E8%AF%95%E4%B8%80%E4%B8%8B%E5%90%84%E4%B8%AA%E6%A3%80%E7%B4%A2%E5%8A%9F%E8%83%BD%E7%9A%84%E5%B7%AE%E5%BC%82%EF%BC%9A"><span class="nav-number">3.1.3.2.</span> <span class="nav-text">我们运行一下整个系统，分别测试一下各个检索功能的差异：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E6%88%90%E5%8A%9F%EF%BC%8C%E6%9C%AC%E5%9C%B0PDF%E6%96%87%E4%BB%B6%E4%B9%9F%E6%88%90%E5%8A%9F%E5%8A%A0%E8%BD%BD%E4%BA%86%EF%BC%8C%E7%8E%B0%E5%9C%A8%E6%88%91%E4%BB%AC%E5%85%88%E8%BF%9B%E8%A1%8C%E5%BF%AB%E9%80%9F%E6%A3%80%E7%B4%A2%E7%9A%84%E6%BC%94%E7%A4%BA"><span class="nav-number">3.1.3.3.</span> <span class="nav-text">我们可以看到系统启动成功，本地PDF文件也成功加载了，现在我们先进行快速检索的演示:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8E%A5%E7%9D%80%E6%88%91%E4%BB%AC%E6%B5%8B%E8%AF%95%E6%B7%B1%E5%BA%A6%E6%A3%80%E7%B4%A2%E7%9A%84%E6%95%88%E6%9E%9C"><span class="nav-number">3.1.3.4.</span> <span class="nav-text">接着我们测试深度检索的效果</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%80%E5%90%8E%E6%88%91%E4%BB%AC%E6%9D%A5%E6%B5%8B%E8%AF%95%E4%B8%80%E4%B8%8B%E4%B8%BB%E9%A2%98%E6%A3%80%E7%B4%A2%EF%BC%9A"><span class="nav-number">3.1.3.5.</span> <span class="nav-text">最后我们来测试一下主题检索：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E4%BB%A5%E4%B8%8A%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C%EF%BC%8C%E6%88%91%E4%BB%AC%E6%9D%A5%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C"><span class="nav-number">3.1.3.6.</span> <span class="nav-text">基于以上运行结果，我们来总结一下功能实现效果</span></a></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Su Tang</p>
  <div class="site-description" itemprop="description">nothing is anything</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/24/Agent-camel%E6%A1%86%E6%9E%B6%E7%BB%83%E4%B9%A0%EF%BC%884%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Su Tang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="_010001SUTANG_">
      <meta itemprop="description" content="nothing is anything">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Agent-camel框架练习（4） | _010001SUTANG_">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Agent-camel框架练习（4）
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-07-24 21:40:59" itemprop="dateCreated datePublished" datetime="2025-07-24T21:40:59+08:00">2025-07-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-07-25 20:32:20" itemprop="dateModified" datetime="2025-07-25T20:32:20+08:00">2025-07-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%87%AA%E4%B8%BB%E7%BB%83%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">自主练习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><hr>
<p>原作者链接🔗：<a target="_blank" rel="noopener" href="https://fmhw1n4zpn.feishu.cn/docx/AF4XdOZpIo6TOaxzDK8cxInNnCe">https://fmhw1n4zpn.feishu.cn/docx/AF4XdOZpIo6TOaxzDK8cxInNnCe</a></p>
<h2 id="Task1"><a href="#Task1" class="headerlink" title="Task1"></a>Task1</h2><h3 id="通过调用API或本地部署reranker模型来快速将rerank模块集成到RAG应用中"><a href="#通过调用API或本地部署reranker模型来快速将rerank模块集成到RAG应用中" class="headerlink" title="通过调用API或本地部署reranker模型来快速将rerank模块集成到RAG应用中"></a>通过调用API或本地部署reranker模型来快速将rerank模块集成到RAG应用中</h3><p><a target="_blank" rel="noopener" href="https://github.com/camel-ai/camel/blob/master/camel/retrievers/cohere_rerank_retriever.py">https://github.com/camel-ai/camel/blob/master/camel/retrievers/cohere_rerank_retriever.py</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">精简版Reranker系统：在CAMEL框架下集成模拟的外部Reranker模型</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">该脚本旨在清晰地展示如何将一个独立的Reranker模块（通过模拟外部API或本地部署模型）</span></span><br><span class="line"><span class="string">集成到RAG应用中，以实现文档重排。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入CAMEL框架核心模块</span></span><br><span class="line"><span class="keyword">from</span> camel.models <span class="keyword">import</span> ModelFactory</span><br><span class="line"><span class="keyword">from</span> camel.types <span class="keyword">import</span> ModelPlatformType</span><br><span class="line"><span class="keyword">from</span> camel.agents <span class="keyword">import</span> ChatAgent</span><br><span class="line"><span class="keyword">from</span> camel.embeddings <span class="keyword">import</span> SentenceTransformerEncoder</span><br><span class="line"><span class="keyword">from</span> camel.retrievers <span class="keyword">import</span> VectorRetriever</span><br><span class="line"><span class="keyword">from</span> camel.storages.vectordb_storages <span class="keyword">import</span> QdrantStorage</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入环境变量模块</span></span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MinimalRerankerSystem</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    精简版Reranker系统类</span></span><br><span class="line"><span class="string">    包含知识库设置、模拟的外部Reranker和答案生成的核心功能</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, api_key: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        初始化精简版Reranker系统</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            api_key: ModelScope API密钥</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.api_key = api_key</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化嵌入模型 (用于向量检索，Reranker本身不直接使用)</span></span><br><span class="line">        <span class="variable language_">self</span>.embedding_model = SentenceTransformerEncoder(</span><br><span class="line">            model_name=<span class="string">&#x27;intfloat/e5-large-v2&#x27;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化向量存储 (用于演示文档检索，以便Reranker有文档可重排)</span></span><br><span class="line">        <span class="variable language_">self</span>.vector_storage = QdrantStorage(</span><br><span class="line">            vector_dim=<span class="variable language_">self</span>.embedding_model.get_output_dim(),</span><br><span class="line">            collection=<span class="string">&quot;minimal_reranker_collection&quot;</span>,</span><br><span class="line">            path=<span class="string">&quot;storage_minimal_reranker&quot;</span>,</span><br><span class="line">            collection_name=<span class="string">&quot;精简重排知识库&quot;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化向量检索器</span></span><br><span class="line">        <span class="variable language_">self</span>.vector_retriever = VectorRetriever(</span><br><span class="line">            embedding_model=<span class="variable language_">self</span>.embedding_model,</span><br><span class="line">            storage=<span class="variable language_">self</span>.vector_storage</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化LLM模型 (仅用于答案生成)</span></span><br><span class="line">        <span class="variable language_">self</span>.model = ModelFactory.create(</span><br><span class="line">            model_platform=ModelPlatformType.OPENAI_COMPATIBLE_MODEL,</span><br><span class="line">            model_type=<span class="string">&quot;Qwen/Qwen2.5-72B-Instruct&quot;</span>,</span><br><span class="line">            url=<span class="string">&#x27;https://api-inference.modelscope.cn/v1/&#x27;</span>,</span><br><span class="line">            api_key=<span class="variable language_">self</span>.api_key</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化RAG答案生成代理</span></span><br><span class="line">        <span class="variable language_">self</span>._init_agents()</span><br><span class="line">        <span class="variable language_">self</span>.knowledge_base_ready = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_init_agents</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;初始化RAG答案生成代理&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># RAG回答生成代理</span></span><br><span class="line">        rag_sys_msg = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        你是一个帮助回答问题的助手。</span></span><br><span class="line"><span class="string">        我会给你原始查询和检索到的上下文信息。</span></span><br><span class="line"><span class="string">        请根据检索到的上下文回答原始查询。</span></span><br><span class="line"><span class="string">        如果上下文信息不足以回答问题，请说&quot;根据提供的信息，我无法完全回答这个问题&quot;。</span></span><br><span class="line"><span class="string">        请确保回答准确、完整且有条理。</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.rag_agent = ChatAgent(</span><br><span class="line">            system_message=rag_sys_msg,</span><br><span class="line">            model=<span class="variable language_">self</span>.model</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setup_knowledge_base</span>(<span class="params">self, pdf_url: <span class="built_in">str</span> = <span class="literal">None</span>, pdf_path: <span class="built_in">str</span> = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        设置知识库，用于提供待重排的文档</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            pdf_url: PDF文件的URL</span></span><br><span class="line"><span class="string">            pdf_path: 本地PDF文件路径</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        os.makedirs(<span class="string">&#x27;local_data&#x27;</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> pdf_url:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在下载PDF文件...&quot;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                response = requests.get(pdf_url, timeout=<span class="number">30</span>)</span><br><span class="line">                response.raise_for_status()</span><br><span class="line">                pdf_path = <span class="string">&#x27;local_data/knowledge_base.pdf&#x27;</span></span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(pdf_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">                    file.write(response.content)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;✓ PDF文件已下载到: <span class="subst">&#123;pdf_path&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;PDF下载失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> pdf_path:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(pdf_path):</span><br><span class="line">                <span class="keyword">raise</span> FileNotFoundError(<span class="string">f&quot;PDF文件不存在: <span class="subst">&#123;pdf_path&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在处理PDF文件并建立向量数据库...&quot;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="variable language_">self</span>.vector_retriever.process(content=pdf_path)</span><br><span class="line">                <span class="variable language_">self</span>.knowledge_base_ready = <span class="literal">True</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;知识库设置完成！&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;知识库设置失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;必须提供 pdf_url 或 pdf_path 参数&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">retrieve_documents</span>(<span class="params">self, query: <span class="built_in">str</span>, top_k: <span class="built_in">int</span> = <span class="number">5</span></span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        从知识库中检索初步文档</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            query: 用户查询</span></span><br><span class="line"><span class="string">            top_k: 返回的文档数量</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            初步检索到的文档列表</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.knowledge_base_ready:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;知识库未准备好，无法检索文档。&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;正在初步检索文档 (Top-<span class="subst">&#123;top_k&#125;</span>)...&quot;</span>)</span><br><span class="line">        retrieved_docs = <span class="variable language_">self</span>.vector_retriever.query(query=query, top_k=top_k)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;✓ 初步检索到 <span class="subst">&#123;<span class="built_in">len</span>(retrieved_docs)&#125;</span> 个文档。&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> retrieved_docs</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perform_external_rerank</span>(<span class="params">self, query: <span class="built_in">str</span>, documents: <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]</span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        模拟外部Reranker模型对文档进行重排。</span></span><br><span class="line"><span class="string">        此函数模拟了调用外部API或本地部署的Reranker模型。</span></span><br><span class="line"><span class="string">        这里使用简单的关键词匹配作为模拟的重排逻辑。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            query: 用户查询</span></span><br><span class="line"><span class="string">            documents: 待重排的文档列表，每个文档字典包含 &#x27;text&#x27; 键</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            根据模拟的外部Reranker重排后的文档列表，每个文档会添加 &#x27;relevance_score&#x27; 字段。</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> documents:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;没有文档可供重排，跳过外部Reranker。&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;正在使用模拟的外部Reranker进行文档重排...&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将查询分割成关键词（这里简单地按空格分割，实际Reranker会进行更复杂的处理）</span></span><br><span class="line">        query_keywords = <span class="built_in">set</span>(query.lower().split())</span><br><span class="line"></span><br><span class="line">        scored_documents = []</span><br><span class="line">        <span class="keyword">for</span> doc <span class="keyword">in</span> documents:</span><br><span class="line">            doc_text_lower = doc[<span class="string">&#x27;text&#x27;</span>].lower()</span><br><span class="line">            <span class="comment"># 模拟计算相关性分数：文档中包含的查询关键词越多，分数越高</span></span><br><span class="line">            relevance_score = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> keyword <span class="keyword">in</span> query_keywords <span class="keyword">if</span> keyword <span class="keyword">in</span> doc_text_lower)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 也可以添加一些随机性来模拟真实模型的复杂性</span></span><br><span class="line">            <span class="comment"># import random</span></span><br><span class="line">            <span class="comment"># relevance_score += random.uniform(0, 0.1) </span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 将分数添加到文档字典中</span></span><br><span class="line">            doc_with_score = doc.copy()</span><br><span class="line">            doc_with_score[<span class="string">&#x27;relevance_score&#x27;</span>] = relevance_score</span><br><span class="line">            scored_documents.append(doc_with_score)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 根据相关性分数降序排序</span></span><br><span class="line">        reranked_documents = <span class="built_in">sorted</span>(scored_documents, key=<span class="keyword">lambda</span> x: x.get(<span class="string">&#x27;relevance_score&#x27;</span>, <span class="number">0</span>), reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;✓ 模拟外部Reranker重排完成。&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> reranked_documents</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_answer</span>(<span class="params">self, query: <span class="built_in">str</span>, retrieved_docs: <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        基于检索到的文档生成答案</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            query: 用户查询</span></span><br><span class="line"><span class="string">            retrieved_docs: 检索到的文档列表</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            生成的答案</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> retrieved_docs:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;根据提供的信息，我无法完全回答这个问题。&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 构建上下文</span></span><br><span class="line">        context = <span class="string">&quot;\n\n&quot;</span>.join([doc[<span class="string">&#x27;text&#x27;</span>] <span class="keyword">for</span> doc <span class="keyword">in</span> retrieved_docs])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 构建提示</span></span><br><span class="line">        prompt = <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        原始查询: <span class="subst">&#123;query&#125;</span></span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        检索到的上下文信息:</span></span><br><span class="line"><span class="string">        <span class="subst">&#123;context&#125;</span></span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        请根据上述上下文信息回答原始查询。</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n正在生成答案...&quot;</span>)</span><br><span class="line">        response = <span class="variable language_">self</span>.rag_agent.step(prompt)</span><br><span class="line">        answer = response.msgs[<span class="number">0</span>].content.strip()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;✓ 答案生成完成。&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> answer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_reranker_pipeline</span>(<span class="params">self, query: <span class="built_in">str</span>, top_k_initial: <span class="built_in">int</span> = <span class="number">5</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        运行重排器管道：初步检索 -&gt; 外部Reranker重排 -&gt; 答案生成</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            query: 用户查询</span></span><br><span class="line"><span class="string">            top_k_initial: 初步检索的文档数量</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            包含初步文档、重排文档和最终答案的字典</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;开始运行Reranker管道，查询: <span class="subst">&#123;query&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 步骤1: 初步检索文档</span></span><br><span class="line">        initial_retrieved_docs = <span class="variable language_">self</span>.retrieve_documents(query, top_k_initial)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 步骤2: 外部Reranker重排文档</span></span><br><span class="line">        reranked_docs = <span class="variable language_">self</span>.perform_external_rerank(query, initial_retrieved_docs)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 步骤3: 基于重排后的文档生成答案</span></span><br><span class="line">        final_answer = <span class="variable language_">self</span>.generate_answer(query, reranked_docs)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Reranker管道执行完成！&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;query&quot;</span>: query,</span><br><span class="line">            <span class="string">&quot;initial_retrieved_docs&quot;</span>: initial_retrieved_docs,</span><br><span class="line">            <span class="string">&quot;reranked_docs&quot;</span>: reranked_docs,</span><br><span class="line">            <span class="string">&quot;final_answer&quot;</span>: final_answer</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主函数：演示精简版Reranker系统的使用&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 加载环境变量</span></span><br><span class="line">    load_dotenv()</span><br><span class="line">    api_key = os.getenv(<span class="string">&#x27;MODELSCOPE_SDK_TOKEN&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> api_key:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;错误：请设置MODELSCOPE_SDK_TOKEN环境变量&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请在.env文件中添加 MODELSCOPE_SDK_TOKEN=你的API密钥&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 初始化Reranker系统</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;正在初始化Reranker系统...&quot;</span>)</span><br><span class="line">    reranker_system = MinimalRerankerSystem(api_key)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;系统初始化完成！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置知识库 (使用CAMEL论文作为示例)</span></span><br><span class="line">    pdf_url = <span class="string">&quot;https://arxiv.org/pdf/2303.17760.pdf&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n正在设置知识库（使用默认CAMEL论文: <span class="subst">&#123;pdf_url&#125;</span>）...&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        reranker_system.setup_knowledge_base(pdf_url=pdf_url)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;知识库设置失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 运行交互式会话</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        query = <span class="built_in">input</span>(<span class="string">&quot;\n请输入您的查询（输入&#x27;quit&#x27;退出）: &quot;</span>).strip()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> query.lower() <span class="keyword">in</span> [<span class="string">&#x27;quit&#x27;</span>, <span class="string">&#x27;exit&#x27;</span>, <span class="string">&#x27;退出&#x27;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;感谢使用！再见！&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> query:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;查询不能为空，请重新输入。&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            results = reranker_system.run_reranker_pipeline(query, top_k_initial=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n--- 原始检索结果 (Top 5) ---&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> results[<span class="string">&#x27;initial_retrieved_docs&#x27;</span>]:</span><br><span class="line">                <span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(results[<span class="string">&#x27;initial_retrieved_docs&#x27;</span>]):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;文档 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>: <span class="subst">&#123;doc[<span class="string">&#x27;text&#x27;</span>][:<span class="number">150</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;无原始检索文档。&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n--- 外部Reranker重排后的结果 ---&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> results[<span class="string">&#x27;reranked_docs&#x27;</span>]:</span><br><span class="line">                <span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(results[<span class="string">&#x27;reranked_docs&#x27;</span>]):</span><br><span class="line">                    <span class="comment"># 显示模拟的相关性分数</span></span><br><span class="line">                    score_info = <span class="string">f&quot; (相关性分数: <span class="subst">&#123;doc.get(<span class="string">&#x27;relevance_score&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>):<span class="number">.2</span>f&#125;</span>)&quot;</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;文档 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span><span class="subst">&#123;score_info&#125;</span>: <span class="subst">&#123;doc[<span class="string">&#x27;text&#x27;</span>][:<span class="number">150</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;无重排文档。&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n--- 最终答案 ---&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(results[<span class="string">&#x27;final_answer&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n发生错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">import</span> traceback</span><br><span class="line">            traceback.print_exc() <span class="comment"># 打印详细错误信息</span></span><br><span class="line">            continue_choice = <span class="built_in">input</span>(<span class="string">&quot;是否继续？(y/n): &quot;</span>).strip().lower()</span><br><span class="line">            <span class="keyword">if</span> continue_choice != <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>我们可以运行看一下重排效果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">PS D:\Camel_Test_Project&gt; &amp; D:/Download/Python/py-3.11.9/python.exe d:/Camel_Test_Project/Reranker_lite.py  </span><br><span class="line">正在初始化Reranker系统...</span><br><span class="line">W0724 23:07:45.865000 37864 site-packages\torch\distributed\elastic\multiprocessing\redirects.py:29] NOTE: Redirects are currently not supported in Windows or MacOs.   </span><br><span class="line">系统初始化完成！</span><br><span class="line"></span><br><span class="line">正在设置知识库（使用默认CAMEL论文: https://arxiv.org/pdf/2303.17760.pdf）...     </span><br><span class="line">正在下载PDF文件...</span><br><span class="line">✓ PDF文件已下载到: local_data/knowledge_base.pdf</span><br><span class="line">正在处理PDF文件并建立向量数据库...</span><br><span class="line">知识库设置完成！</span><br><span class="line"></span><br><span class="line">请输入您的查询（输入&#x27;quit&#x27;退出）: camel是什么？      </span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">开始运行Reranker管道，查询: camel是什么？</span><br><span class="line">============================================================</span><br><span class="line">正在初步检索文档 (Top-5)...</span><br><span class="line">✓ 初步检索到 5 个文档。</span><br><span class="line">正在使用模拟的外部Reranker进行文档重排...</span><br><span class="line">✓ 模拟外部Reranker重排完成。</span><br><span class="line"></span><br><span class="line">正在生成答案...</span><br><span class="line">✓ 答案生成完成。</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">Reranker管道执行完成！</span><br><span class="line">============================================================</span><br><span class="line"></span><br><span class="line">--- 原始检索结果 (Top 5) ---</span><br><span class="line">文档 1: 3 2 0 2</span><br><span class="line"></span><br><span class="line">v o N 2</span><br><span class="line"></span><br><span class="line">] I</span><br><span class="line"></span><br><span class="line">A . s c [</span><br><span class="line"></span><br><span class="line">2 v 0 6 7 7 1 . 3 0 3 2 : v i X r a</span><br><span class="line"></span><br><span class="line">CAMEL: Communicative Agents for “Mind” Exploration of Large Language Model Soci...  </span><br><span class="line">文档 2: 3 2 0 2</span><br><span class="line"></span><br><span class="line">v o N 2</span><br><span class="line"></span><br><span class="line">] I</span><br><span class="line"></span><br><span class="line">A . s c [</span><br><span class="line"></span><br><span class="line">2 v 0 6 7 7 1 . 3 0 3 2 : v i X r a</span><br><span class="line"></span><br><span class="line">CAMEL: Communicative Agents for “Mind” Exploration of Large Language Model Soci...  </span><br><span class="line">文档 3: me instructions and necessary inputs until you think the task is completed. When the task is completed, you must only reply with a single word &lt;CAMEL_...       </span><br><span class="line">文档 4: me instructions and necessary inputs until you think the task is completed. When the task is completed, you must only reply with a single word &lt;CAMEL_...       </span><br><span class="line">文档 5: Human Evaluation Guideline</span><br><span class="line"></span><br><span class="line">Thank you for participating in our task evaluation! We are comparing the performance of ChatGPT and a method called CAMEL ...</span><br><span class="line"></span><br><span class="line">--- 外部Reranker重排后的结果 ---</span><br><span class="line">文档 1 (相关性分数: 0.00): 3 2 0 2</span><br><span class="line"></span><br><span class="line">v o N 2</span><br><span class="line"></span><br><span class="line">] I</span><br><span class="line"></span><br><span class="line">A . s c [</span><br><span class="line"></span><br><span class="line">2 v 0 6 7 7 1 . 3 0 3 2 : v i X r a</span><br><span class="line"></span><br><span class="line">CAMEL: Communicative Agents for “Mind” Exploration of Large Language Model Soci...  </span><br><span class="line">文档 2 (相关性分数: 0.00): 3 2 0 2</span><br><span class="line"></span><br><span class="line">v o N 2</span><br><span class="line"></span><br><span class="line">] I</span><br><span class="line"></span><br><span class="line">A . s c [</span><br><span class="line"></span><br><span class="line">2 v 0 6 7 7 1 . 3 0 3 2 : v i X r a</span><br><span class="line"></span><br><span class="line">CAMEL: Communicative Agents for “Mind” Exploration of Large Language Model Soci...  </span><br><span class="line">文档 3 (相关性分数: 0.00): me instructions and necessary inputs until you think the task is completed. When the task is completed, you must only reply with a single word &lt;CAMEL_...</span><br><span class="line">文档 4 (相关性分数: 0.00): me instructions and necessary inputs until you think the task is completed. When the task is completed, you must only reply with a single word &lt;CAMEL_...</span><br><span class="line">文档 5 (相关性分数: 0.00): Human Evaluation Guideline</span><br><span class="line"></span><br><span class="line">Thank you for participating in our task evaluation! We are comparing the performance of ChatGPT and a method called CAMEL ...</span><br><span class="line"></span><br><span class="line">--- 最终答案 ---</span><br><span class="line">根据提供的信息，CAMEL（Communicative Agents for “Mind” Exploration of Large Language Model Society）是一种用于探索大型语言模型社会“心智”的交流代理系统。这个项目由沙特阿拉伯国王科技大学（KAUST）的研究人员开发，旨在通过交流代理来研究和理解大型语言模型之 间的互动和社会动态。更多详情可以参考该项目的官方网站：https://www.camel-ai.org。    </span><br><span class="line"></span><br><span class="line">请输入您的查询（输入&#x27;quit&#x27;退出）: quit</span><br><span class="line">感谢使用！再见！</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Task2"><a href="#Task2" class="headerlink" title="Task2"></a>Task2</h2><h3 id="使用大语言模型和简单的提示词工程在CAMEL框架下实现一个ReRanker，达成重排的效果（灵感来自CAMEL-Shanghai-Hackathon韬子哥QAQ）"><a href="#使用大语言模型和简单的提示词工程在CAMEL框架下实现一个ReRanker，达成重排的效果（灵感来自CAMEL-Shanghai-Hackathon韬子哥QAQ）" class="headerlink" title="使用大语言模型和简单的提示词工程在CAMEL框架下实现一个ReRanker，达成重排的效果（灵感来自CAMEL Shanghai Hackathon韬子哥QAQ）"></a>使用大语言模型和简单的提示词工程在CAMEL框架下实现一个ReRanker，达成重排的效果（灵感来自CAMEL Shanghai Hackathon韬子哥QAQ）</h3><p><a target="_blank" rel="noopener" href="https://github.com/fengju0213/NavigatorAI/blob/main/2Travel_information_generation.py">https://github.com/fengju0213/NavigatorAI/blob/main/2Travel_information_generation.py</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">LLM ReRanker：在CAMEL框架下实现基于大语言模型的文档重排</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">该脚本旨在清晰地展示如何使用CAMEL框架和简单的提示词工程实现文档重排。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入CAMEL框架核心模块</span></span><br><span class="line"><span class="keyword">from</span> camel.models <span class="keyword">import</span> ModelFactory</span><br><span class="line"><span class="keyword">from</span> camel.types <span class="keyword">import</span> ModelPlatformType</span><br><span class="line"><span class="keyword">from</span> camel.agents <span class="keyword">import</span> ChatAgent</span><br><span class="line"><span class="keyword">from</span> camel.embeddings <span class="keyword">import</span> SentenceTransformerEncoder</span><br><span class="line"><span class="keyword">from</span> camel.retrievers <span class="keyword">import</span> VectorRetriever</span><br><span class="line"><span class="keyword">from</span> camel.storages.vectordb_storages <span class="keyword">import</span> QdrantStorage</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入环境变量模块</span></span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MinimalLLMReranker</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    LLM ReRanker系统类</span></span><br><span class="line"><span class="string">    仅包含知识库设置、LLM ReRanker和答案生成的核心功能</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, api_key: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        初始化LLM ReRanker系统</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            api_key: ModelScope API密钥</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.api_key = api_key</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化嵌入模型 (用于向量检索，ReRanker本身不直接使用)</span></span><br><span class="line">        <span class="variable language_">self</span>.embedding_model = SentenceTransformerEncoder(</span><br><span class="line">            model_name=<span class="string">&#x27;intfloat/e5-large-v2&#x27;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化向量存储 (用于演示文档检索，以便ReRanker有文档可重排)</span></span><br><span class="line">        <span class="variable language_">self</span>.vector_storage = QdrantStorage(</span><br><span class="line">            vector_dim=<span class="variable language_">self</span>.embedding_model.get_output_dim(),</span><br><span class="line">            collection=<span class="string">&quot;minimal_reranker_collection&quot;</span>,</span><br><span class="line">            path=<span class="string">&quot;storage_minimal_reranker&quot;</span>,</span><br><span class="line">            collection_name=<span class="string">&quot;精简重排知识库&quot;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化向量检索器</span></span><br><span class="line">        <span class="variable language_">self</span>.vector_retriever = VectorRetriever(</span><br><span class="line">            embedding_model=<span class="variable language_">self</span>.embedding_model,</span><br><span class="line">            storage=<span class="variable language_">self</span>.vector_storage</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化LLM模型 (用于ReRanker和答案生成)</span></span><br><span class="line">        <span class="variable language_">self</span>.model = ModelFactory.create(</span><br><span class="line">            model_platform=ModelPlatformType.OPENAI_COMPATIBLE_MODEL,</span><br><span class="line">            model_type=<span class="string">&quot;Qwen/Qwen2.5-72B-Instruct&quot;</span>,</span><br><span class="line">            url=<span class="string">&#x27;https://api-inference.modelscope.cn/v1/&#x27;</span>,</span><br><span class="line">            api_key=<span class="variable language_">self</span>.api_key</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 初始化LLM ReRanker代理和RAG答案生成代理</span></span><br><span class="line">        <span class="variable language_">self</span>._init_agents()</span><br><span class="line">        <span class="variable language_">self</span>.knowledge_base_ready = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_init_agents</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;初始化LLM ReRanker代理和RAG答案生成代理&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># LLM ReRanker 代理</span></span><br><span class="line">        <span class="comment"># 提示词工程：明确要求输出格式为逗号分隔的数字序列，不含额外文字</span></span><br><span class="line">        reranker_sys_msg = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        你是一个文档重排助手。你的任务是根据用户查询，对提供的文档列表进行相关性排序。</span></span><br><span class="line"><span class="string">        你会接收一个用户查询和多个文档，每个文档都有一个编号。</span></span><br><span class="line"><span class="string">        请你根据文档与查询的深层相关性，从最相关到最不相关，输出文档的编号序列。</span></span><br><span class="line"><span class="string">        输出格式必须是逗号分隔的数字，例如：1, 3, 2, 4。</span></span><br><span class="line"><span class="string">        不要包含任何其他文字或解释。</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.reranker_agent = ChatAgent(</span><br><span class="line">            system_message=reranker_sys_msg,</span><br><span class="line">            model=<span class="variable language_">self</span>.model</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># RAG回答生成代理</span></span><br><span class="line">        rag_sys_msg = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        你是一个帮助回答问题的助手。</span></span><br><span class="line"><span class="string">        我会给你原始查询和检索到的上下文信息。</span></span><br><span class="line"><span class="string">        请根据检索到的上下文回答原始查询。</span></span><br><span class="line"><span class="string">        如果上下文信息不足以回答问题，请说&quot;根据提供的信息，我无法完全回答这个问题&quot;。</span></span><br><span class="line"><span class="string">        请确保回答准确、完整且有条理。</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.rag_agent = ChatAgent(</span><br><span class="line">            system_message=rag_sys_msg,</span><br><span class="line">            model=<span class="variable language_">self</span>.model</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setup_knowledge_base</span>(<span class="params">self, pdf_url: <span class="built_in">str</span> = <span class="literal">None</span>, pdf_path: <span class="built_in">str</span> = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        设置知识库，用于提供待重排的文档</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            pdf_url: PDF文件的URL</span></span><br><span class="line"><span class="string">            pdf_path: 本地PDF文件路径</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        os.makedirs(<span class="string">&#x27;local_data&#x27;</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> pdf_url:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在下载PDF文件...&quot;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                response = requests.get(pdf_url, timeout=<span class="number">30</span>)</span><br><span class="line">                response.raise_for_status()</span><br><span class="line">                pdf_path = <span class="string">&#x27;local_data/knowledge_base.pdf&#x27;</span></span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(pdf_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">                    file.write(response.content)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;✓ PDF文件已下载到: <span class="subst">&#123;pdf_path&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;PDF下载失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> pdf_path:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(pdf_path):</span><br><span class="line">                <span class="keyword">raise</span> FileNotFoundError(<span class="string">f&quot;PDF文件不存在: <span class="subst">&#123;pdf_path&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在处理PDF文件并建立向量数据库...&quot;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="variable language_">self</span>.vector_retriever.process(content=pdf_path)</span><br><span class="line">                <span class="variable language_">self</span>.knowledge_base_ready = <span class="literal">True</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;知识库设置完成！&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;知识库设置失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;必须提供 pdf_url 或 pdf_path 参数&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">retrieve_documents</span>(<span class="params">self, query: <span class="built_in">str</span>, top_k: <span class="built_in">int</span> = <span class="number">5</span></span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        从知识库中检索初步文档</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            query: 用户查询</span></span><br><span class="line"><span class="string">            top_k: 返回的文档数量</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            初步检索到的文档列表</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.knowledge_base_ready:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;知识库未准备好，无法检索文档。&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;正在初步检索文档 (Top-<span class="subst">&#123;top_k&#125;</span>)...&quot;</span>)</span><br><span class="line">        retrieved_docs = <span class="variable language_">self</span>.vector_retriever.query(query=query, top_k=top_k)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;✓ 初步检索到 <span class="subst">&#123;<span class="built_in">len</span>(retrieved_docs)&#125;</span> 个文档。&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> retrieved_docs</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rerank_documents</span>(<span class="params">self, query: <span class="built_in">str</span>, documents: <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]</span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        使用LLM对文档进行重排</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            query: 用户查询</span></span><br><span class="line"><span class="string">            documents: 待重排的文档列表，每个文档字典包含 &#x27;text&#x27; 键</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            根据LLM重排后的文档列表</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> documents:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;没有文档可供重排，跳过LLM重排。&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;正在使用LLM进行文档重排...&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 构建发送给LLM的提示</span></span><br><span class="line">        prompt_parts = [<span class="string">f&quot;用户查询: <span class="subst">&#123;query&#125;</span>\n\n以下是需要重排的文档列表：&quot;</span>]</span><br><span class="line">        <span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(documents):</span><br><span class="line">            <span class="comment"># 限制文档内容长度，避免超出LLM上下文窗口</span></span><br><span class="line">            truncated_text = doc[<span class="string">&#x27;text&#x27;</span>][:<span class="number">500</span>] + <span class="string">&quot;...&quot;</span> <span class="keyword">if</span> <span class="built_in">len</span>(doc[<span class="string">&#x27;text&#x27;</span>]) &gt; <span class="number">500</span> <span class="keyword">else</span> doc[<span class="string">&#x27;text&#x27;</span>]</span><br><span class="line">            prompt_parts.append(<span class="string">f&quot;文档 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>:\n<span class="subst">&#123;truncated_text&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">        prompt_parts.append(<span class="string">&quot;\n请根据文档与查询的相关性，从最相关到最不相关，输出文档的编号序列。输出格式必须是逗号分隔的数字，例如：1, 3, 2, 4。不要包含任何其他文字或解释。&quot;</span>)</span><br><span class="line">        rerank_prompt = <span class="string">&quot;\n&quot;</span>.join(prompt_parts)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = <span class="variable language_">self</span>.reranker_agent.step(rerank_prompt)</span><br><span class="line">            reranked_order_str = response.msgs[<span class="number">0</span>].content.strip()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 解析LLM的输出，获取排序后的文档索引</span></span><br><span class="line">            <span class="comment"># 使用正则表达式匹配数字和逗号，确保只提取数字序列</span></span><br><span class="line">            <span class="keyword">match</span> = re.search(<span class="string">r&#x27;^\s*(\d+(?:\s*,\s*\d+)*)\s*$&#x27;</span>, reranked_order_str)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                ordered_indices = [<span class="built_in">int</span>(idx.strip()) - <span class="number">1</span> <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="keyword">match</span>.group(<span class="number">1</span>).split(<span class="string">&#x27;,&#x27;</span>)]</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 过滤掉无效的索引（超出文档列表范围的）</span></span><br><span class="line">                valid_ordered_indices = [idx <span class="keyword">for</span> idx <span class="keyword">in</span> ordered_indices <span class="keyword">if</span> <span class="number">0</span> &lt;= idx &lt; <span class="built_in">len</span>(documents)]</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 根据LLM返回的顺序重排文档</span></span><br><span class="line">                reranked_documents = [documents[i] <span class="keyword">for</span> i <span class="keyword">in</span> valid_ordered_indices]</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 如果LLM返回的文档数量少于原始文档数量，将未被LLM排序的文档按原顺序追加到末尾</span></span><br><span class="line">                original_indices = <span class="built_in">set</span>(<span class="built_in">range</span>(<span class="built_in">len</span>(documents)))</span><br><span class="line">                llm_sorted_indices = <span class="built_in">set</span>(valid_ordered_indices)</span><br><span class="line">                remaining_indices = <span class="built_in">sorted</span>(<span class="built_in">list</span>(original_indices - llm_sorted_indices))</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">for</span> idx <span class="keyword">in</span> remaining_indices:</span><br><span class="line">                    reranked_documents.append(documents[idx])</span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;✓ LLM重排完成。新顺序: <span class="subst">&#123;[idx + <span class="number">1</span> <span class="keyword">for</span> idx <span class="keyword">in</span> valid_ordered_indices]&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> reranked_documents</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;LLM重排输出格式不正确，无法解析。原始输出: &#x27;<span class="subst">&#123;reranked_order_str&#125;</span>&#x27;。将返回原始文档顺序。&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> documents <span class="comment"># 返回原始文档顺序</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;LLM重排失败: <span class="subst">&#123;e&#125;</span>。将返回原始文档顺序。&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> documents <span class="comment"># 发生错误时返回原始文档顺序</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_answer</span>(<span class="params">self, query: <span class="built_in">str</span>, retrieved_docs: <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        基于检索到的文档生成答案</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            query: 用户查询</span></span><br><span class="line"><span class="string">            retrieved_docs: 检索到的文档列表</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            生成的答案</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> retrieved_docs:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;根据提供的信息，我无法完全回答这个问题。&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 构建上下文</span></span><br><span class="line">        context = <span class="string">&quot;\n\n&quot;</span>.join([doc[<span class="string">&#x27;text&#x27;</span>] <span class="keyword">for</span> doc <span class="keyword">in</span> retrieved_docs])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 构建提示</span></span><br><span class="line">        prompt = <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        原始查询: <span class="subst">&#123;query&#125;</span></span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        检索到的上下文信息:</span></span><br><span class="line"><span class="string">        <span class="subst">&#123;context&#125;</span></span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        请根据上述上下文信息回答原始查询。</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n正在生成答案...&quot;</span>)</span><br><span class="line">        response = <span class="variable language_">self</span>.rag_agent.step(prompt)</span><br><span class="line">        answer = response.msgs[<span class="number">0</span>].content.strip()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;✓ 答案生成完成。&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> answer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_reranker_pipeline</span>(<span class="params">self, query: <span class="built_in">str</span>, top_k_initial: <span class="built_in">int</span> = <span class="number">5</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        运行重排器管道：初步检索 -&gt; LLM重排 -&gt; 答案生成</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            query: 用户查询</span></span><br><span class="line"><span class="string">            top_k_initial: 初步检索的文档数量</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            包含初步文档、重排文档和最终答案的字典</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;开始运行LLM重排管道，查询: <span class="subst">&#123;query&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 步骤1: 初步检索文档</span></span><br><span class="line">        initial_retrieved_docs = <span class="variable language_">self</span>.retrieve_documents(query, top_k_initial)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 步骤2: LLM重排文档</span></span><br><span class="line">        reranked_docs = <span class="variable language_">self</span>.rerank_documents(query, initial_retrieved_docs)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 步骤3: 基于重排后的文档生成答案</span></span><br><span class="line">        final_answer = <span class="variable language_">self</span>.generate_answer(query, reranked_docs)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;LLM重排管道执行完成！&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;query&quot;</span>: query,</span><br><span class="line">            <span class="string">&quot;initial_retrieved_docs&quot;</span>: initial_retrieved_docs,</span><br><span class="line">            <span class="string">&quot;reranked_docs&quot;</span>: reranked_docs,</span><br><span class="line">            <span class="string">&quot;final_answer&quot;</span>: final_answer</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主函数：演示精简版LLM ReRanker系统的使用&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 加载环境变量</span></span><br><span class="line">    load_dotenv()</span><br><span class="line">    api_key = os.getenv(<span class="string">&#x27;MODELSCOPE_SDK_TOKEN&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> api_key:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;错误：请设置MODELSCOPE_SDK_TOKEN环境变量&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请在.env文件中添加 MODELSCOPE_SDK_TOKEN=你的API密钥&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 初始化LLM ReRanker系统</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;正在初始化LLM ReRanker系统...&quot;</span>)</span><br><span class="line">    reranker_system = MinimalLLMReranker(api_key)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;系统初始化完成！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置知识库 (使用CAMEL论文作为示例)</span></span><br><span class="line">    pdf_url = <span class="string">&quot;https://arxiv.org/pdf/2303.17760.pdf&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n正在设置知识库（使用默认CAMEL论文: <span class="subst">&#123;pdf_url&#125;</span>）...&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        reranker_system.setup_knowledge_base(pdf_url=pdf_url)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;知识库设置失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 运行交互式会话</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        query = <span class="built_in">input</span>(<span class="string">&quot;\n请输入您的查询（输入&#x27;quit&#x27;退出）: &quot;</span>).strip()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> query.lower() <span class="keyword">in</span> [<span class="string">&#x27;quit&#x27;</span>, <span class="string">&#x27;exit&#x27;</span>, <span class="string">&#x27;退出&#x27;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;感谢使用！再见！&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> query:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;查询不能为空，请重新输入。&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            results = reranker_system.run_reranker_pipeline(query, top_k_initial=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n--- 原始检索结果 (Top 5) ---&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> results[<span class="string">&#x27;initial_retrieved_docs&#x27;</span>]:</span><br><span class="line">                <span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(results[<span class="string">&#x27;initial_retrieved_docs&#x27;</span>]):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;文档 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>: <span class="subst">&#123;doc[<span class="string">&#x27;text&#x27;</span>][:<span class="number">150</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;无原始检索文档。&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n--- LLM重排后的结果 ---&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> results[<span class="string">&#x27;reranked_docs&#x27;</span>]:</span><br><span class="line">                <span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(results[<span class="string">&#x27;reranked_docs&#x27;</span>]):</span><br><span class="line">                    <span class="comment"># 尝试获取RRF分数或相似度，如果存在的话</span></span><br><span class="line">                    score_info = <span class="string">f&quot; (RRF分数: <span class="subst">&#123;doc[<span class="string">&#x27;rrf_score&#x27;</span>]:<span class="number">.4</span>f&#125;</span>)&quot;</span> <span class="keyword">if</span> <span class="string">&#x27;rrf_score&#x27;</span> <span class="keyword">in</span> doc <span class="keyword">else</span> <span class="string">&quot;&quot;</span></span><br><span class="line">                    score_info = <span class="string">f&quot; (相似度: <span class="subst">&#123;doc[<span class="string">&#x27;similarity&#x27;</span>]:<span class="number">.4</span>f&#125;</span>)&quot;</span> <span class="keyword">if</span> <span class="string">&#x27;similarity&#x27;</span> <span class="keyword">in</span> doc <span class="keyword">else</span> score_info</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;文档 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span><span class="subst">&#123;score_info&#125;</span>: <span class="subst">&#123;doc[<span class="string">&#x27;text&#x27;</span>][:<span class="number">150</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;无重排文档。&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n--- 最终答案 ---&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(results[<span class="string">&#x27;final_answer&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n发生错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">import</span> traceback</span><br><span class="line">            traceback.print_exc() <span class="comment"># 打印详细错误信息</span></span><br><span class="line">            continue_choice = <span class="built_in">input</span>(<span class="string">&quot;是否继续？(y/n): &quot;</span>).strip().lower()</span><br><span class="line">            <span class="keyword">if</span> continue_choice != <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>运行效果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PS D:\Camel_Test_Project&gt; python Reranker_simple.py</span><br><span class="line">正在初始化LLM ReRanker系统...</span><br><span class="line">W0724 21:56:33.691000 38432 site-packages\torch\distributed\elastic\multiprocessing\redirects.py:29] NOTE: Redirects are currently not supported in Windows or MacOs.   </span><br><span class="line">系统初始化完成！</span><br><span class="line"></span><br><span class="line">正在设置知识库（使用默认CAMEL论文: https://arxiv.org/pdf/2303.17760.pdf）...        </span><br><span class="line">正在下载PDF文件...</span><br><span class="line">✓ PDF文件已下载到: local_data/knowledge_base.pdf</span><br><span class="line">正在处理PDF文件并建立向量数据库...</span><br><span class="line">知识库设置完成！</span><br><span class="line"></span><br><span class="line">请输入您的查询（输入&#x27;quit&#x27;退出）:</span><br></pre></td></tr></table></figure>
<p>此时我们可以输入我们想要检索的内容，因为测试的PDF文件仍为CAMEL论文官方线上文件，所以我们直接问与CAMEL相关的：“camel是什么？对于我AI学习有什么帮助？”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">请输入您的查询（输入&#x27;quit&#x27;退出）:camel是什么？对于我AI学习有什么帮助？</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">开始运行LLM重排管道，查询: camel是什么？对于我AI学习有什么帮助？</span><br><span class="line">============================================================</span><br><span class="line">正在初步检索文档 (Top-5)...</span><br><span class="line">✓ 初步检索到 5 个文档。</span><br><span class="line">正在使用LLM进行文档重排...</span><br><span class="line">✓ LLM重排完成。新顺序: [5, 3, 4, 2, 1]</span><br><span class="line"></span><br><span class="line">正在生成答案...</span><br><span class="line">✓ 答案生成完成。</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">LLM重排管道执行完成！</span><br><span class="line">============================================================</span><br><span class="line"></span><br><span class="line">--- 原始检索结果 (Top 5) ---</span><br><span class="line">文档 1: Human Evaluation Guideline</span><br><span class="line"></span><br><span class="line">Thank you for participating in our task evaluation! We are comparing the performance of ChatGPT and a method called CAMEL ...</span><br><span class="line">文档 2: Objective: Your task is to compare two messages, one generated by CAMEL and the other by ChatGPT. These messages will be displayed anonymously on your...       </span><br><span class="line">文档 3: 3 2 0 2</span><br><span class="line"></span><br><span class="line">v o N 2</span><br><span class="line"></span><br><span class="line">] I</span><br><span class="line"></span><br><span class="line">A . s c [</span><br><span class="line"></span><br><span class="line">2 v 0 6 7 7 1 . 3 0 3 2 : v i X r a</span><br><span class="line"></span><br><span class="line">CAMEL: Communicative Agents for “Mind” Exploration of Large Language Model Soci...  </span><br><span class="line">文档 4: Feedback: We highly value your feedback. If you have any suggestions, concerns, or encounter any technical issues during the evaluation, please feel f...       </span><br><span class="line">文档 5: agent is asked to draw all the Camelidae species. It first reasons about what animals are included in the Camelidae family and then generates and save...       </span><br><span class="line"></span><br><span class="line">--- LLM重排后的结果 ---</span><br><span class="line">文档 1: agent is asked to draw all the Camelidae species. It first reasons about what animals are included in the Camelidae family and then generates and save...       </span><br><span class="line">文档 2: 3 2 0 2</span><br><span class="line"></span><br><span class="line">v o N 2</span><br><span class="line"></span><br><span class="line">] I</span><br><span class="line"></span><br><span class="line">A . s c [</span><br><span class="line"></span><br><span class="line">2 v 0 6 7 7 1 . 3 0 3 2 : v i X r a</span><br><span class="line"></span><br><span class="line">CAMEL: Communicative Agents for “Mind” Exploration of Large Language Model Soci...  </span><br><span class="line">文档 3: Feedback: We highly value your feedback. If you have any suggestions, concerns, or encounter any technical issues during the evaluation, please feel f...       </span><br><span class="line">文档 4: Objective: Your task is to compare two messages, one generated by CAMEL and the other by ChatGPT. These messages will be displayed anonymously on your...       </span><br><span class="line">文档 5: Human Evaluation Guideline</span><br><span class="line"></span><br><span class="line">Thank you for participating in our task evaluation! We are comparing the performance of ChatGPT and a method called CAMEL ...</span><br><span class="line"></span><br><span class="line">--- 最终答案 ---</span><br><span class="line">根据提供的信息，&quot;camel&quot;在这里有两个不同的含义：</span><br><span class="line"></span><br><span class="line">1. **生物学上的驼科（Camelidae）**：这是指一类哺乳动物，包括骆驼、羊驼等。然而，这个定义与您的AI学习没有直接关系。</span><br><span class="line"></span><br><span class="line">2. **CAMEL项目**：这是一个名为“Communicative Agents for ‘Mind’ Exploration of Large Language Model Society”的研究项目，由沙特阿拉伯阿卜杜拉国王科技大学（KAUST）的研究人员开发。CAMEL项目的目的是通过创建交互式代理来探索大型语言模型的社会“心智”。这些代理 可以生成图像、进行任务比较和评估，并通过用户反馈不断改进。</span><br><span class="line"></span><br><span class="line">### 对于AI学习的帮助：</span><br><span class="line">- **理解大型语言模型**：CAMEL项目可以帮助你更好地理解大型语言模型的工作原理和能力。 </span><br><span class="line">- **实践应用**：通过参与CAMEL项目，你可以实际操作和评估不同AI系统的性能，从而提升你 的实践技能。</span><br><span class="line">- **研究贡献**：你的反馈和参与可以为AI研究提供有价值的数据，推动AI技术的发展。      </span><br><span class="line"></span><br><span class="line">如果你对生物学上的驼科更感兴趣，建议查阅相关的生物学资料。如果你对AI学习更感兴趣，可以进一步了解CAMEL项目并参与其中。</span><br><span class="line"></span><br><span class="line">请输入您的查询（输入&#x27;quit&#x27;退出）:</span><br></pre></td></tr></table></figure>
<p>此时第一轮检索生成已经完成，代理自动进入第二个问题查询。我们继续输入我们的问题：“camel具备哪些特性？”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">请输入您的查询（输入&#x27;quit&#x27;退出）:camel具备哪些特性？            </span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">开始运行LLM重排管道，查询: camel具备哪些特性？</span><br><span class="line">============================================================</span><br><span class="line">正在初步检索文档 (Top-5)...</span><br><span class="line">✓ 初步检索到 5 个文档。</span><br><span class="line">正在使用LLM进行文档重排...</span><br><span class="line">✓ LLM重排完成。新顺序: [1, 2, 3, 4, 5]</span><br><span class="line"></span><br><span class="line">正在生成答案...</span><br><span class="line">✓ 答案生成完成。</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">LLM重排管道执行完成！</span><br><span class="line">============================================================</span><br><span class="line"></span><br><span class="line">--- 原始检索结果 (Top 5) ---</span><br><span class="line">文档 1: 3 2 0 2</span><br><span class="line"></span><br><span class="line">v o N 2</span><br><span class="line"></span><br><span class="line">] I</span><br><span class="line"></span><br><span class="line">A . s c [</span><br><span class="line"></span><br><span class="line">2 v 0 6 7 7 1 . 3 0 3 2 : v i X r a</span><br><span class="line"></span><br><span class="line">CAMEL: Communicative Agents for “Mind” Exploration of Large Language Model Soci...  </span><br><span class="line">文档 2: me instructions and necessary inputs until you think the task is completed. When the task is completed, you must only reply with a single word &lt;CAMEL_...       </span><br><span class="line">文档 3: Human Evaluation Guideline</span><br><span class="line"></span><br><span class="line">Thank you for participating in our task evaluation! We are comparing the performance of ChatGPT and a method called CAMEL ...</span><br><span class="line">文档 4: Objective: Your task is to compare two messages, one generated by CAMEL and the other by ChatGPT. These messages will be displayed anonymously on your...       </span><br><span class="line">文档 5: Feedback: We highly value your feedback. If you have any suggestions, concerns, or encounter any technical issues during the evaluation, please feel f...       </span><br><span class="line"></span><br><span class="line">--- LLM重排后的结果 ---</span><br><span class="line">文档 1: 3 2 0 2</span><br><span class="line"></span><br><span class="line">v o N 2</span><br><span class="line"></span><br><span class="line">] I</span><br><span class="line"></span><br><span class="line">A . s c [</span><br><span class="line"></span><br><span class="line">2 v 0 6 7 7 1 . 3 0 3 2 : v i X r a</span><br><span class="line"></span><br><span class="line">CAMEL: Communicative Agents for “Mind” Exploration of Large Language Model Soci...  </span><br><span class="line">文档 2: me instructions and necessary inputs until you think the task is completed. When the task is completed, you must only reply with a single word &lt;CAMEL_...       </span><br><span class="line">文档 3: Human Evaluation Guideline</span><br><span class="line"></span><br><span class="line">Thank you for participating in our task evaluation! We are comparing the performance of ChatGPT and a method called CAMEL ...</span><br><span class="line">文档 4: Objective: Your task is to compare two messages, one generated by CAMEL and the other by ChatGPT. These messages will be displayed anonymously on your...       </span><br><span class="line">文档 5: Feedback: We highly value your feedback. If you have any suggestions, concerns, or encounter any technical issues during the evaluation, please feel f...       </span><br><span class="line"></span><br><span class="line">--- 最终答案 ---</span><br><span class="line">根据提供的上下文信息，CAMEL（Communicative Agents for “Mind” Exploration of Large Language Model Society）具备以下特性：</span><br><span class="line"></span><br><span class="line">1. **交互式代理**：CAMEL项目使用交互式代理来生成和处理任务，这些代理可以模拟人类的对话和思维过程。</span><br><span class="line">2. **任务完成**：CAMEL代理能够接收任务指令，并在任务完成后回复特定的确认词 `&lt;CAMEL_TASK_DONE&gt;`。</span><br><span class="line">3. **性能评估**：CAMEL项目包括对不同AI系统（如ChatGPT和CAMEL自身）的性能评估，通过用户反馈和投票来比较它们的表现。</span><br><span class="line">4. **用户参与**：CAMEL项目鼓励用户参与任务评估，提供反馈和建议，以帮助改进AI系统的性能。</span><br><span class="line">5. **生成内容**：CAMEL框架可以生成各种内容，包括文本、图像等，用于任务完成和评估。  </span><br><span class="line">6. **社会“心智”探索**：CAMEL项目旨在通过代理之间的互动来探索大型语言模型的社会“心智”，即这些模型如何理解和处理社会互动和复杂任务。</span><br><span class="line"></span><br><span class="line">这些特性使得CAMEL项目在AI研究和应用中具有重要的意义，特别是在理解和发展更高级的交互 式AI系统方面。</span><br><span class="line"></span><br><span class="line">请输入您的查询（输入&#x27;quit&#x27;退出）: quit</span><br><span class="line">感谢使用！再见！</span><br></pre></td></tr></table></figure>

<p>此时我们可以看到两轮问答输出的排序效果：</p>
<p><strong>第一次查询：“camel是什么？对于我AI学习有什么帮助？”</strong></p>
<p>正在初步检索文档 (Top-5)…<br>✓ 初步检索到 5 个文档。<br>正在使用LLM进行文档重排…<br>✓ LLM重排完成。新顺序: [5, 3, 4, 2, 1]</p>
<ul>
<li><strong>原始检索结果：</strong> 文档3（“CAMEL: Communicative Agents for ‘Mind’ Exploration of Large Language Model Soci…”）是关于CAMEL项目的核心文档，但是代理将其排在第三位。而文档5（“agent is asked to draw all the Camelidae species…”）是关于生物学上的“驼科”的，与AI学习的相关性较低，故排在第五位。</li>
<li><strong>LLM重排后的结果：</strong> LLM将文档5（驼科）重排到了第一位，而将文档3（CAMEL项目）重排到了第二位。这表明LLM在这次重排中将生物学含义的“camel”置于了更高的优先级，尽管我们查询的后半部分明确指向了AI学习。</li>
<li><strong>最终答案：</strong> 尽管重排结果将次相关文档排在了前面，但最终答案依然能够正确识别“camel”的两种含义（生物学和CAMEL项目），并详细解释了CAMEL项目对AI学习的帮助，这说明RAG的生成部分能够有效地利用所有检索到的上下文，即使文档顺序不完全理想。</li>
</ul>
<p><strong>第二次查询：“camel具备哪些特性？”</strong></p>
<ul>
<li><strong>原始检索结果：</strong> 文档1（“CAMEL: Communicative Agents for ‘Mind’ Exploration of Large Language Model Soci…”）是关于CAMEL项目核心的文档，排在第一位。</li>
<li><strong>LLM重排后的结果：</strong> LLM的重排顺序是<code>[1, 2, 3, 4, 5]</code>，与原始检索结果的顺序完全一致。这表明LLM认为原始检索器提供的文档顺序已经足够优化，或者它没有找到更优的重排方式。</li>
<li><strong>最终答案：</strong> 最终答案详细列举了CAMEL项目的各项特性，这得益于原始检索结果中相关性高的文档（文档1）已经位于靠前的位置。</li>
</ul>
<p>因此可见**LLM ReRanker能够根据查询对文档进行重新排序。**在第一个查询中，它改变了文档顺序，但并非总是将最相关的文档（从人类角度看）排在首位，可能受到文档内容中“camel”多义性的影响。在第二个查询中，它维持了原始顺序。这表明LLM重排器在某些情况下可以优化文档顺序，但在处理多义性查询时可能需要更精细的提示词工程或结合其他信号来确保最高相关性的文档始终排在最前面。然而，即使重排结果并非完美，<strong>RAG的生成能力依然能够从提供的上下文中提取信息并给出较为全面的答案。</strong></p>
<h3 id="关于Task1和Task2的区别思考：这两个任务都涉及在RAG应用中集成重排（ReRanker）模块，但它们在实现方式和所依赖的技术栈上存在显著区别："><a href="#关于Task1和Task2的区别思考：这两个任务都涉及在RAG应用中集成重排（ReRanker）模块，但它们在实现方式和所依赖的技术栈上存在显著区别：" class="headerlink" title="关于Task1和Task2的区别思考：这两个任务都涉及在RAG应用中集成重排（ReRanker）模块，但它们在实现方式和所依赖的技术栈上存在显著区别："></a>关于Task1和Task2的区别思考：这两个任务都涉及在RAG应用中集成重排（ReRanker）模块，但它们在实现方式和所依赖的技术栈上存在显著区别：</h3><h4 id="Task-1：基于API调用或本地部署的预训练Reranker模型集成"><a href="#Task-1：基于API调用或本地部署的预训练Reranker模型集成" class="headerlink" title="Task 1：基于API调用或本地部署的预训练Reranker模型集成"></a>Task 1：基于API调用或本地部署的预训练Reranker模型集成</h4><ul>
<li><strong>实现方式：</strong> 这个任务侧重于利用<strong>外部的、专门训练过的重排模型或服务</strong>。<ul>
<li><strong>API 调用：</strong> 像Cohere ReRank这样的服务，提供了一个API接口，您可以将查询和文档列表发送给它，它会返回重排后的文档。这种方式通常开箱即用，性能经过优化。</li>
<li><strong>本地部署Reranker模型：</strong> 指的是下载并运行一个已经预训练好的重排模型（例如基于BERT、RoBERTa等架构的跨编码器模型），在本地环境中进行文档重排。</li>
</ul>
</li>
<li><strong>特点：</strong><ul>
<li><strong>效率高、性能优越：</strong> 这些模型通常是专门为重排任务训练的，能够捕捉文档和查询之间的细微相关性，性能通常比通用大模型在重排上的表现更稳定和高效。</li>
<li><strong>开箱即用：</strong> 集成过程通常是调用SDK或API，相对简单快捷。</li>
<li><strong>资源消耗：</strong> 如果是本地部署，需要一定的计算资源；如果调用API，则涉及外部服务费用。</li>
</ul>
</li>
<li><strong>参考链接分析：</strong> <code>https://github.com/camel-ai/camel/blob/master/camel/retrievers/cohere_rerank_retriever.py</code> 指向CAMEL框架中一个与Cohere ReRank服务集成的检索器。这明确表示Task 1是关于使用<strong>外部的、专业的重排服务</strong>。</li>
</ul>
<h4 id="Task-2：基于大语言模型和提示词工程实现Reranker"><a href="#Task-2：基于大语言模型和提示词工程实现Reranker" class="headerlink" title="Task 2：基于大语言模型和提示词工程实现Reranker"></a>Task 2：基于大语言模型和提示词工程实现Reranker</h4><ul>
<li><strong>实现方式：</strong> 这个任务的核心是利用<strong>通用大语言模型的零样本或少样本能力，通过精巧的提示词（Prompt Engineering）来“引导”LLM执行重排任务</strong>。<ul>
<li>您需要设计一个提示词，告诉LLM它是一个“重排助手”，提供查询和待重排的文档列表，并要求LLM输出重排后的文档顺序或评分。</li>
<li>重排的逻辑完全由LLM的推理能力和您的提示词设计决定。</li>
</ul>
</li>
<li><strong>特点：</strong><ul>
<li><strong>灵活性高：</strong> 可以根据具体需求，通过修改提示词来调整重排逻辑，适用于各种自定义场景。</li>
<li><strong>不依赖特定Reranker模型：</strong> 只要有通用大语言模型（如Qwen、ChatGPT等）即可实现，无需额外部署专门的重排模型。</li>
<li><strong>性能波动：</strong> 重排效果高度依赖于LLM的理解能力和提示词的质量，可能不如专门训练的Reranker模型稳定和极致。</li>
<li><strong>资源消耗：</strong> 调用LLM的API通常会有成本，且LLM的推理速度可能比专门的Reranker慢。</li>
</ul>
</li>
<li><strong>参考链接分析：</strong> <code>https://github.com/fengju0213/NavigatorAI/blob/main/2Travel_information_generation.py</code> 以及您之前让我优化过的代码，都是通过在CAMEL框架中使用 <code>ChatAgent</code>（即一个LLM代理）并结合自定义的系统消息和用户消息来模拟重排过程的。这明确表示Task 2是关于<strong>通过提示词工程将LLM作为重排器使用</strong>。</li>
</ul>
<h3 id="核心区别总结："><a href="#核心区别总结：" class="headerlink" title="核心区别总结："></a>核心区别总结：</h3><table>
<thead>
<tr>
<th>特征</th>
<th>Task 1：API&#x2F;本地部署Reranker模型</th>
<th>Task 2：LLM + 提示词工程实现Reranker</th>
</tr>
</thead>
<tbody><tr>
<td><strong>重排核心</strong></td>
<td>专门训练的重排模型&#x2F;服务</td>
<td>通用大语言模型 (LLM) 的推理能力</td>
</tr>
<tr>
<td><strong>实现方式</strong></td>
<td>调用成熟的API或SDK，或部署现有模型</td>
<td>设计提示词，引导LLM进行重排</td>
</tr>
<tr>
<td><strong>性能</strong></td>
<td>通常更稳定、高效，针对重排任务优化</td>
<td>依赖LLM能力和提示词质量，可能波动较大</td>
</tr>
<tr>
<td><strong>灵活性</strong></td>
<td>较低，重排逻辑固定在模型中</td>
<td>较高，可通过调整提示词灵活定制重排逻辑</td>
</tr>
<tr>
<td><strong>资源</strong></td>
<td>可能需要GPU（本地）或API费用（云服务）</td>
<td>调用LLM的API费用，LLM本身运行资源</td>
</tr>
<tr>
<td><strong>开发难度</strong></td>
<td>相对较低，多为配置和集成</td>
<td>需要精通提示词工程，调试LLM行为</td>
</tr>
</tbody></table>
<h2 id="Task3"><a href="#Task3" class="headerlink" title="Task3"></a>Task3</h2><h3 id="导出本教程文档作为一个PDF文件，尝试搭建一个具有多模态检索能力的RAG应用来帮助其他学习者回答问题。"><a href="#导出本教程文档作为一个PDF文件，尝试搭建一个具有多模态检索能力的RAG应用来帮助其他学习者回答问题。" class="headerlink" title="导出本教程文档作为一个PDF文件，尝试搭建一个具有多模态检索能力的RAG应用来帮助其他学习者回答问题。"></a>导出本教程文档作为一个PDF文件，尝试搭建一个具有多模态检索能力的RAG应用来帮助其他学习者回答问题。</h3><p>由于我没有找到很好的将本教程文档转化为一个线上可直接数据向量化的方法，但经过运行确认确实可以将线上的PDF文档本地下载初始化数据库。<br>因此我们演示时暂时采用本地下载好的本教程PDF文档作为演示案例。</p>
<p>我们先来说明一下整个系统的具体实现：</p>
<h4 id="交互式多模态RAG系统"><a href="#交互式多模态RAG系统" class="headerlink" title="交互式多模态RAG系统"></a>交互式多模态RAG系统</h4><h5 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h5><p>这是一个基于CAMEL框架的交互式多模态RAG（检索增强生成）系统，集成了PDF文档处理、网页爬取、知识图谱构建和多种检索模式。系统支持文本、图像、表格等多模态内容的智能检索和分析。</p>
<h5 id="核心特性"><a href="#核心特性" class="headerlink" title="核心特性"></a>核心特性</h5><h6 id="多模态内容处理"><a href="#多模态内容处理" class="headerlink" title="多模态内容处理"></a>多模态内容处理</h6><ul>
<li><strong>PDF文档解析</strong>：支持在线PDF和本地PDF文件加载</li>
<li><strong>多模态元素提取</strong>：自动识别和处理文本、图像、表格内容</li>
<li><strong>智能内容分类</strong>：按内容类型进行分类存储和检索</li>
</ul>
<h6 id="多种检索模式"><a href="#多种检索模式" class="headerlink" title="多种检索模式"></a>多种检索模式</h6><ol>
<li><strong>快速检索</strong>：基础向量检索，快速获取相关文档</li>
<li><strong>深度检索</strong>：查询重写 + HyDE + RRF融合的高级检索</li>
<li><strong>主题检索</strong>：PDF文档 + 网页爬取的综合检索</li>
</ol>
<h6 id="AI智能分析"><a href="#AI智能分析" class="headerlink" title="AI智能分析"></a>AI智能分析</h6><ul>
<li><strong>CAMEL框架集成</strong>：使用CAMEL ModelFactory进行模型管理</li>
<li><strong>查询重写</strong>：智能优化用户查询以提高检索效果</li>
<li><strong>HyDE增强</strong>：假设文档生成技术提升检索精度</li>
<li><strong>RRF融合</strong>：多路检索结果的智能融合排序</li>
</ul>
<h6 id="网页研究系统"><a href="#网页研究系统" class="headerlink" title="网页研究系统"></a>网页研究系统</h6><ul>
<li><strong>智能网页爬取</strong>：基于主题的网页内容抓取</li>
<li><strong>知识图谱构建</strong>：自动构建主题相关的知识图谱</li>
<li><strong>多源信息融合</strong>：PDF文档与网页信息的智能整合</li>
</ul>
<h6 id="交互式体验"><a href="#交互式体验" class="headerlink" title="交互式体验"></a>交互式体验</h6><ul>
<li><strong>实时对话界面</strong>：支持连续问答和上下文理解</li>
<li><strong>结果可视化</strong>：详细的检索结果展示和分析</li>
<li><strong>报告生成</strong>：自动生成研究报告和结果保存</li>
</ul>
<h5 id="系统架构"><a href="#系统架构" class="headerlink" title="系统架构"></a>系统架构</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">交互式多模态RAG系统</span><br><span class="line">├── 核心组件</span><br><span class="line">│   ├── SimpleLLMInterface (CAMEL模型接口)</span><br><span class="line">│   ├── SimpleEmbeddingModel (嵌入模型)</span><br><span class="line">│   ├── SimpleVectorRetriever (向量检索器)</span><br><span class="line">│   └── SimpleRAGSystem (RAG核心系统)</span><br><span class="line">├── 检索模式</span><br><span class="line">│   ├── 快速检索 (基础向量检索)</span><br><span class="line">│   ├── 深度检索 (重写+HyDE+RRF)</span><br><span class="line">│   └── 主题检索 (PDF+网页爬取)</span><br><span class="line">├── 网页研究系统</span><br><span class="line">│   ├── UniversalResearchSystem (通用研究系统)</span><br><span class="line">│   ├── InteractiveResearchSystem (交互式研究)</span><br><span class="line">│   └── EnhancedInteractiveResearchSystem (增强版)</span><br><span class="line">└── 交互界面</span><br><span class="line">    ├── 知识库管理</span><br><span class="line">    ├── 查询处理</span><br><span class="line">    └── 结果展示</span><br></pre></td></tr></table></figure>
<h5 id="核心框架"><a href="#核心框架" class="headerlink" title="核心框架"></a>核心框架</h5><ul>
<li><strong>CAMEL</strong>: AI智能体框架，提供模型管理和工具集成</li>
<li><strong>LangChain</strong>: 大语言模型应用开发框架</li>
<li><strong>Sentence Transformers</strong>: 文本嵌入和语义检索</li>
</ul>
<h5 id="文档处理"><a href="#文档处理" class="headerlink" title="文档处理"></a>文档处理</h5><ul>
<li><strong>PyPDF</strong>: PDF文档解析和文本提取</li>
<li><strong>Unstructured</strong>: 多模态文档元素识别和处理</li>
<li><strong>BeautifulSoup</strong>: HTML内容解析和清理</li>
</ul>
<h5 id="检索和存储"><a href="#检索和存储" class="headerlink" title="检索和存储"></a>检索和存储</h5><ul>
<li><strong>Scikit-learn</strong>: 向量相似度计算和机器学习</li>
<li><strong>NumPy</strong>: 数值计算和向量操作</li>
<li><strong>Neo4j</strong>: 知识图谱存储和查询（可选）</li>
</ul>
<h5 id="网页爬取"><a href="#网页爬取" class="headerlink" title="网页爬取"></a>网页爬取</h5><ul>
<li><strong>Requests</strong>: HTTP请求和网页内容获取</li>
<li><strong>Firecrawl</strong>: 智能网页内容抓取</li>
<li><strong>SearchToolkit</strong>: 网页搜索和信息检索</li>
</ul>
<h4 id="基本使用流程"><a href="#基本使用流程" class="headerlink" title="基本使用流程"></a>基本使用流程</h4><ol>
<li><p><strong>选择PDF来源</strong></p>
<ul>
<li>在线PDF（输入URL）</li>
<li>本地PDF（输入文件路径）</li>
<li>默认示例PDF（CAMEL论文）</li>
</ul>
</li>
<li><p><strong>选择检索模式</strong></p>
<ul>
<li>快速检索：适合简单问答</li>
<li>深度检索：适合复杂分析</li>
<li>主题检索：适合综合研究</li>
</ul>
</li>
<li><p><strong>输入查询问题</strong></p>
<ul>
<li>支持中英文查询</li>
<li>支持复杂的多步骤问题</li>
<li>支持上下文相关的连续对话</li>
</ul>
</li>
<li><p><strong>查看结果</strong></p>
<ul>
<li>检索到的相关文档</li>
<li>AI生成的详细答案</li>
<li>可选的结果保存功能</li>
</ul>
</li>
</ol>
<h5 id="高级功能"><a href="#高级功能" class="headerlink" title="高级功能"></a>高级功能</h5><h6 id="网页研究模式"><a href="#网页研究模式" class="headerlink" title="网页研究模式"></a>网页研究模式</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动增强版研究系统</span></span><br><span class="line">python RAG_WEB_TOPIC_Enhanced.py</span><br></pre></td></tr></table></figure>

<h6 id="自定义检索参数"><a href="#自定义检索参数" class="headerlink" title="自定义检索参数"></a>自定义检索参数</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在代码中调整检索参数</span></span><br><span class="line">results = rag_system.enhanced_query(</span><br><span class="line">    original_query=query,</span><br><span class="line">    use_rewriting=<span class="literal">True</span>,      <span class="comment"># 启用查询重写</span></span><br><span class="line">    use_hyde=<span class="literal">True</span>,           <span class="comment"># 启用HyDE增强</span></span><br><span class="line">    use_rrf=<span class="literal">True</span>,            <span class="comment"># 启用RRF融合</span></span><br><span class="line">    top_k=<span class="number">5</span>,                 <span class="comment"># 返回文档数量</span></span><br><span class="line">    multimodal_preference=[<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;image&#x27;</span>, <span class="string">&#x27;table&#x27;</span>]  <span class="comment"># 多模态偏好</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="检索模式"><a href="#检索模式" class="headerlink" title="检索模式"></a>检索模式</h5><h6 id="快速检索"><a href="#快速检索" class="headerlink" title="快速检索"></a>快速检索</h6><ul>
<li><strong>用途</strong>：基础问答和快速信息查找</li>
<li><strong>特点</strong>：速度快，资源消耗低</li>
<li><strong>适用场景</strong>：简单事实查询，概念解释</li>
</ul>
<h6 id="深度检索"><a href="#深度检索" class="headerlink" title="深度检索"></a>深度检索</h6><ul>
<li><strong>用途</strong>：复杂分析和深度研究</li>
<li><strong>特点</strong>：多步骤处理，结果精确</li>
<li><strong>适用场景</strong>：学术研究，技术分析</li>
</ul>
<h6 id="主题检索"><a href="#主题检索" class="headerlink" title="主题检索"></a>主题检索</h6><ul>
<li><strong>用途</strong>：综合信息收集和跨源研究</li>
<li><strong>特点</strong>：结合PDF和网页信息</li>
<li><strong>适用场景</strong>：市场调研，趋势分析</li>
</ul>
<p>接下来我们来看看具体的实现代码：</p>
<h4 id="实现代码："><a href="#实现代码：" class="headerlink" title="实现代码："></a>实现代码：</h4><h5 id="实现代码主要分为3个部分："><a href="#实现代码主要分为3个部分：" class="headerlink" title="实现代码主要分为3个部分："></a>实现代码主要分为3个部分：</h5><p><strong>主代码</strong>：【Interactive_Multimodal_RAG.py】集成“快速检索”+“深度检索”的多模态RAG应用<br><strong>分支代码</strong>：【RAG_WEB_TOPIC_Enhanced.py + RAG_WEB_TOPIC.py】集成“主题”检索的Web 抓取 + 知识图谱构建的综合RAG应用</p>
<p>说明：RAG_WEB_TOPIC_Enhanced.py 系统基于 RAG_WEB_TOPIC.py 改进开发，在使用运行RAG_WEB_TOPIC_Enhanced.py 的时候会同时运行 RAG_WEB_TOPIC.py 中的一些基础依赖和配置。</p>
<p><strong>主代码</strong>：【Interactive_Multimodal_RAG.py】</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">交互式多模态RAG系统</span></span><br><span class="line"><span class="string">支持PDF上传、多种检索模式和网页爬取功能</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Any</span>, <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics.pairwise <span class="keyword">import</span> cosine_similarity</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在文件顶部添加CAMEL相关导入</span></span><br><span class="line"><span class="keyword">from</span> camel.models <span class="keyword">import</span> ModelFactory</span><br><span class="line"><span class="keyword">from</span> camel.types <span class="keyword">import</span> ModelPlatformType</span><br><span class="line"></span><br><span class="line"><span class="comment"># PDF处理</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> pypdf <span class="keyword">import</span> PdfReader</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;缺少pypdf库，请运行: pip install pypdf&quot;</span>)</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> unstructured.partition.auto <span class="keyword">import</span> partition</span><br><span class="line">    <span class="keyword">from</span> unstructured.documents.elements <span class="keyword">import</span> Text, Image, Table</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;缺少unstructured库，请运行: pip install unstructured&quot;</span>)</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 嵌入模型</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> sentence_transformers <span class="keyword">import</span> SentenceTransformer</span><br><span class="line">    EMBEDDING_AVAILABLE = <span class="literal">True</span></span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;缺少sentence-transformers库&quot;</span>)</span><br><span class="line">    EMBEDDING_AVAILABLE = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入网页研究系统</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> RAG_WEB_TOPIC_Enhanced <span class="keyword">import</span> EnhancedInteractiveResearchSystem</span><br><span class="line">    WEB_RESEARCH_AVAILABLE = <span class="literal">True</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Web research system available&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Web research system not available&quot;</span>)</span><br><span class="line">    WEB_RESEARCH_AVAILABLE = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleLLMInterface</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;LLM接口 - 使用CAMEL ModelFactory&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, api_key: <span class="built_in">str</span>, model_name: <span class="built_in">str</span> = <span class="string">&quot;Qwen/Qwen2.5-72B-Instruct&quot;</span>, use_camel: <span class="built_in">bool</span> = <span class="literal">True</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> api_key:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;API key is required&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.api_key = api_key</span><br><span class="line">        <span class="variable language_">self</span>.model_name = model_name</span><br><span class="line">        <span class="variable language_">self</span>.use_camel = use_camel</span><br><span class="line">        <span class="variable language_">self</span>.model = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> use_camel:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 使用CAMEL ModelFactory初始化模型</span></span><br><span class="line">                <span class="variable language_">self</span>.model = ModelFactory.create(</span><br><span class="line">                    model_platform=ModelPlatformType.OPENAI_COMPATIBLE_MODEL,</span><br><span class="line">                    model_type=model_name,</span><br><span class="line">                    url=<span class="string">&#x27;https://api-inference.modelscope.cn/v1/&#x27;</span>,</span><br><span class="line">                    api_key=api_key</span><br><span class="line">                )</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;CAMEL LLM initialized: <span class="subst">&#123;model_name&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;API key: <span class="subst">&#123;api_key[:<span class="number">10</span>]&#125;</span>...<span class="subst">&#123;api_key[-<span class="number">4</span>:]&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;CAMEL initialization failed, using fallback: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="variable language_">self</span>.model = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Direct API LLM initialized: <span class="subst">&#123;model_name&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;API key: <span class="subst">&#123;api_key[:<span class="number">10</span>]&#125;</span>...<span class="subst">&#123;api_key[-<span class="number">4</span>:]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate</span>(<span class="params">self, prompt: <span class="built_in">str</span>, max_tokens: <span class="built_in">int</span> = <span class="number">500</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;生成文本回答 - 使用CAMEL模型或直接API调用&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 如果CAMEL模型可用，尝试使用</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.model <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Generating response with CAMEL model...&quot;</span>)</span><br><span class="line">                <span class="comment"># 使用CAMEL模型生成回答</span></span><br><span class="line">                <span class="keyword">from</span> camel.messages <span class="keyword">import</span> BaseMessage</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 创建用户消息</span></span><br><span class="line">                user_message = BaseMessage.make_user_message(</span><br><span class="line">                    role_name=<span class="string">&quot;user&quot;</span>,</span><br><span class="line">                    content=prompt</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 调用模型生成回答</span></span><br><span class="line">                response = <span class="variable language_">self</span>.model.run([user_message])</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 修复：正确处理CAMEL模型的响应</span></span><br><span class="line">                <span class="keyword">if</span> response:</span><br><span class="line">                    <span class="comment"># 如果响应是BaseMessage对象</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">hasattr</span>(response, <span class="string">&#x27;content&#x27;</span>):</span><br><span class="line">                        <span class="keyword">return</span> response.content</span><br><span class="line">                    <span class="comment"># 如果响应是列表，取第一个元素</span></span><br><span class="line">                    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(response, <span class="built_in">list</span>) <span class="keyword">and</span> <span class="built_in">len</span>(response) &gt; <span class="number">0</span>:</span><br><span class="line">                        first_response = response[<span class="number">0</span>]</span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">hasattr</span>(first_response, <span class="string">&#x27;content&#x27;</span>):</span><br><span class="line">                            <span class="keyword">return</span> first_response.content</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">return</span> <span class="built_in">str</span>(first_response)</span><br><span class="line">                    <span class="comment"># 如果响应是字符串</span></span><br><span class="line">                    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(response, <span class="built_in">str</span>):</span><br><span class="line">                        <span class="keyword">return</span> response</span><br><span class="line">                    <span class="comment"># 其他情况转换为字符串</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">return</span> <span class="built_in">str</span>(response)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">raise</span> Exception(<span class="string">&quot;No response generated from CAMEL model&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;CAMEL generation failed, using fallback: <span class="subst">&#123;<span class="built_in">str</span>(e)[:<span class="number">100</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">                <span class="comment"># 降级到直接API调用</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">self</span>._fallback_generate(prompt, max_tokens)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 直接使用API调用</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Generating response with direct API call...&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>._fallback_generate(prompt, max_tokens)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_fallback_generate</span>(<span class="params">self, prompt: <span class="built_in">str</span>, max_tokens: <span class="built_in">int</span> = <span class="number">500</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;降级方案：直接API调用 - 增加重试机制和超时处理&quot;&quot;&quot;</span></span><br><span class="line">        max_retries = <span class="number">3</span></span><br><span class="line">        timeout_seconds = <span class="number">60</span>  <span class="comment"># 增加超时时间</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> attempt <span class="keyword">in</span> <span class="built_in">range</span>(max_retries):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">import</span> requests</span><br><span class="line">                </span><br><span class="line">                headers = &#123;</span><br><span class="line">                    <span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;self.api_key&#125;</span>&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                data = &#123;</span><br><span class="line">                    <span class="string">&quot;model&quot;</span>: <span class="variable language_">self</span>.model_name,</span><br><span class="line">                    <span class="string">&quot;messages&quot;</span>: [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: prompt&#125;],</span><br><span class="line">                    <span class="string">&quot;max_tokens&quot;</span>: max_tokens,</span><br><span class="line">                    <span class="string">&quot;temperature&quot;</span>: <span class="number">0.7</span></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;API调用 <span class="subst">&#123;attempt + <span class="number">1</span>&#125;</span>/<span class="subst">&#123;max_retries&#125;</span>...&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                response = requests.post(</span><br><span class="line">                    <span class="string">&quot;https://api-inference.modelscope.cn/v1/chat/completions&quot;</span>,</span><br><span class="line">                    headers=headers,</span><br><span class="line">                    json=data,</span><br><span class="line">                    timeout=timeout_seconds</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">                    result = response.json()</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">&#x27;choices&#x27;</span> <span class="keyword">in</span> result <span class="keyword">and</span> <span class="built_in">len</span>(result[<span class="string">&#x27;choices&#x27;</span>]) &gt; <span class="number">0</span>:</span><br><span class="line">                        content = result[<span class="string">&#x27;choices&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;√ API调用成功&quot;</span>)</span><br><span class="line">                        <span class="keyword">return</span> content</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">raise</span> Exception(<span class="string">f&quot;API响应格式错误: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">raise</span> Exception(<span class="string">f&quot;API调用失败 (状态码: <span class="subst">&#123;response.status_code&#125;</span>): <span class="subst">&#123;response.text&#125;</span>&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.Timeout:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;API调用超时 (尝试 <span class="subst">&#123;attempt + <span class="number">1</span>&#125;</span>/<span class="subst">&#123;max_retries&#125;</span>)&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> attempt == max_retries - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">f&quot;抱歉，由于网络超时，无法生成回答。请稍后重试。&quot;</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ConnectionError:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;网络连接错误 (尝试 <span class="subst">&#123;attempt + <span class="number">1</span>&#125;</span>/<span class="subst">&#123;max_retries&#125;</span>)&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> attempt == max_retries - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">f&quot;抱歉，网络连接失败，无法生成回答。请检查网络连接。&quot;</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;API调用失败 (尝试 <span class="subst">&#123;attempt + <span class="number">1</span>&#125;</span>/<span class="subst">&#123;max_retries&#125;</span>): <span class="subst">&#123;<span class="built_in">str</span>(e)[:<span class="number">100</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> attempt == max_retries - <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">f&quot;生成答案时出现错误: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;抱歉，多次尝试后仍无法生成回答，请稍后重试。&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleEmbeddingModel</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;简化的嵌入模型&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model_name: <span class="built_in">str</span> = <span class="string">&#x27;intfloat/e5-large-v2&#x27;</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> EMBEDDING_AVAILABLE:</span><br><span class="line">            <span class="keyword">raise</span> ImportError(<span class="string">&quot;sentence-transformers not available&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="variable language_">self</span>.model = SentenceTransformer(model_name)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;√ Embedding model loaded: <span class="subst">&#123;model_name&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Failed to load embedding model: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">self, texts: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; np.ndarray:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;文本编码&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.model.encode(texts, convert_to_numpy=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Encoding failed: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> np.array([])</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleVectorRetriever</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;简化的向量检索器&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, embedding_model: SimpleEmbeddingModel</span>):</span><br><span class="line">        <span class="variable language_">self</span>.embedding_model = embedding_model</span><br><span class="line">        <span class="variable language_">self</span>.documents = []</span><br><span class="line">        <span class="variable language_">self</span>.doc_metadata = []</span><br><span class="line">        <span class="variable language_">self</span>.document_ids = []</span><br><span class="line">        <span class="variable language_">self</span>.doc_embeddings = <span class="literal">None</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;√ Simple vector retriever initialized&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_documents</span>(<span class="params">self, texts: <span class="type">List</span>[<span class="built_in">str</span>], metadata: <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;添加文档&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> texts:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 生成文档ID</span></span><br><span class="line">            new_ids = [<span class="string">f&quot;doc_<span class="subst">&#123;<span class="built_in">len</span>(self.documents) + i&#125;</span>&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(texts))]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 存储文档</span></span><br><span class="line">            <span class="variable language_">self</span>.documents.extend(texts)</span><br><span class="line">            <span class="variable language_">self</span>.doc_metadata.extend(metadata)</span><br><span class="line">            <span class="variable language_">self</span>.document_ids.extend(new_ids)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 计算嵌入</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Computing embeddings for <span class="subst">&#123;<span class="built_in">len</span>(texts)&#125;</span> documents...&quot;</span>)</span><br><span class="line">            new_embeddings = <span class="variable language_">self</span>.embedding_model.encode(texts)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.doc_embeddings <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="variable language_">self</span>.doc_embeddings = new_embeddings</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="variable language_">self</span>.doc_embeddings = np.vstack([<span class="variable language_">self</span>.doc_embeddings, new_embeddings])</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Added <span class="subst">&#123;<span class="built_in">len</span>(texts)&#125;</span> documents to retriever&quot;</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Error adding documents: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query</span>(<span class="params">self, query_text: <span class="built_in">str</span>, top_k: <span class="built_in">int</span> = <span class="number">5</span>, filter_type: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;检索相关文档&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.documents <span class="keyword">or</span> <span class="variable language_">self</span>.doc_embeddings <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;No documents in retriever&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 计算查询嵌入</span></span><br><span class="line">            query_embedding = <span class="variable language_">self</span>.embedding_model.encode([query_text])</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 计算相似度</span></span><br><span class="line">            similarities = cosine_similarity(query_embedding, <span class="variable language_">self</span>.doc_embeddings)[<span class="number">0</span>]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 获取top_k结果</span></span><br><span class="line">            top_indices = np.argsort(similarities)[::-<span class="number">1</span>][:top_k * <span class="number">2</span>]</span><br><span class="line">            </span><br><span class="line">            results = []</span><br><span class="line">            <span class="keyword">for</span> idx <span class="keyword">in</span> top_indices:</span><br><span class="line">                <span class="keyword">if</span> idx &gt;= <span class="built_in">len</span>(<span class="variable language_">self</span>.documents):</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                    </span><br><span class="line">                doc_type = <span class="variable language_">self</span>.doc_metadata[idx].get(<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;unknown&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> filter_type <span class="keyword">and</span> doc_type != filter_type:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">                results.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;text&#x27;</span>: <span class="variable language_">self</span>.documents[idx],</span><br><span class="line">                    <span class="string">&#x27;similarity&#x27;</span>: <span class="built_in">float</span>(similarities[idx]),</span><br><span class="line">                    <span class="string">&#x27;metadata&#x27;</span>: <span class="variable language_">self</span>.doc_metadata[idx],</span><br><span class="line">                    <span class="string">&#x27;id&#x27;</span>: <span class="variable language_">self</span>.document_ids[idx]</span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(results) &gt;= top_k:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Retrieved <span class="subst">&#123;<span class="built_in">len</span>(results)&#125;</span> documents&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> results</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Query failed: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleRAGSystem</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;简化的RAG系统 - 集成CAMEL ModelFactory&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, api_key: <span class="built_in">str</span>, model_name: <span class="built_in">str</span> = <span class="string">&quot;Qwen/Qwen2.5-72B-Instruct&quot;</span>, use_camel: <span class="built_in">bool</span> = <span class="literal">True</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> api_key:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;错误：API key required&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> use_camel:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Initializing Simple RAG System with CAMEL...&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Initializing Simple RAG System with direct API...&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 使用LLM接口（CAMEL或直接API）</span></span><br><span class="line">            <span class="variable language_">self</span>.llm = SimpleLLMInterface(api_key=api_key, model_name=model_name, use_camel=use_camel)</span><br><span class="line">            <span class="comment"># 保持原有的嵌入模型和检索器</span></span><br><span class="line">            <span class="variable language_">self</span>.embedding_model = SimpleEmbeddingModel()</span><br><span class="line">            <span class="variable language_">self</span>.vector_retriever = SimpleVectorRetriever(<span class="variable language_">self</span>.embedding_model)</span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">self</span>.knowledge_base_initialized = <span class="literal">False</span></span><br><span class="line">            <span class="variable language_">self</span>.multimodal_content_store = &#123;&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;√ Simple RAG System initialized successfully!&quot;</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;错误：Initialization failed: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setup_knowledge_base</span>(<span class="params">self, pdf_url: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>, pdf_path: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;设置知识库&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> pdf_url:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;↓ Loading PDF from URL: <span class="subst">&#123;pdf_url&#125;</span>&quot;</span>)</span><br><span class="line">                response = requests.get(pdf_url, timeout=<span class="number">30</span>)</span><br><span class="line">                response.raise_for_status()</span><br><span class="line">                pdf_bytes = response.content</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;√ PDF downloaded (<span class="subst">&#123;<span class="built_in">len</span>(pdf_bytes)&#125;</span> bytes)&quot;</span>)</span><br><span class="line">                pdf_file = io.BytesIO(pdf_bytes)</span><br><span class="line">                elements = partition(file=pdf_file)</span><br><span class="line">            <span class="keyword">elif</span> pdf_path:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Loading PDF from: <span class="subst">&#123;pdf_path&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(pdf_path):</span><br><span class="line">                    <span class="keyword">raise</span> FileNotFoundError(<span class="string">f&quot;错误：PDF not found: <span class="subst">&#123;pdf_path&#125;</span>&quot;</span>)</span><br><span class="line">                elements = partition(filename=pdf_path)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;√ PDF loaded successfully&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&quot;错误：Either pdf_url or pdf_path required&quot;</span>)</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;错误：PDF loading error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 处理文档元素</span></span><br><span class="line">        texts_to_embed = []</span><br><span class="line">        metadata_to_embed = []</span><br><span class="line">        multimodal_id_counter = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> element <span class="keyword">in</span> elements:</span><br><span class="line">            element_text = <span class="built_in">str</span>(element).strip()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> element_text <span class="keyword">or</span> <span class="built_in">len</span>(element_text) &lt; <span class="number">10</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            multimodal_id = <span class="string">f&quot;multimodal_<span class="subst">&#123;multimodal_id_counter&#125;</span>&quot;</span></span><br><span class="line">            multimodal_id_counter += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(element, Text):</span><br><span class="line">                texts_to_embed.append(element_text)</span><br><span class="line">                metadata_to_embed.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;source&#x27;</span>: <span class="string">&#x27;pdf&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;multimodal_id&#x27;</span>: multimodal_id</span><br><span class="line">                &#125;)</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(element, Image):</span><br><span class="line">                <span class="comment"># 图像处理</span></span><br><span class="line">                image_description = <span class="string">f&quot;图像内容: <span class="subst">&#123;element_text&#125;</span>&quot;</span></span><br><span class="line">                texts_to_embed.append(image_description)</span><br><span class="line">                metadata_to_embed.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;image&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;source&#x27;</span>: <span class="string">&#x27;pdf&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;multimodal_id&#x27;</span>: multimodal_id</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="variable language_">self</span>.multimodal_content_store[multimodal_id] = &#123;</span><br><span class="line">                    <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;image&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;data&#x27;</span>: element_text</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(element, Table):</span><br><span class="line">                <span class="comment"># 表格处理</span></span><br><span class="line">                table_description = <span class="string">f&quot;表格内容: <span class="subst">&#123;element_text&#125;</span>&quot;</span></span><br><span class="line">                texts_to_embed.append(table_description)</span><br><span class="line">                metadata_to_embed.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;table&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;source&#x27;</span>: <span class="string">&#x27;pdf&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;multimodal_id&#x27;</span>: multimodal_id</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="variable language_">self</span>.multimodal_content_store[multimodal_id] = &#123;</span><br><span class="line">                    <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;table&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;data&#x27;</span>: element_text</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 其他类型作为文本处理</span></span><br><span class="line">                texts_to_embed.append(element_text)</span><br><span class="line">                metadata_to_embed.append(&#123;</span><br><span class="line">                    <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;source&#x27;</span>: <span class="string">&#x27;pdf&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;multimodal_id&#x27;</span>: multimodal_id</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> texts_to_embed:</span><br><span class="line">            <span class="variable language_">self</span>.vector_retriever.add_documents(texts_to_embed, metadata_to_embed)</span><br><span class="line">            <span class="variable language_">self</span>.knowledge_base_initialized = <span class="literal">True</span></span><br><span class="line">            </span><br><span class="line">            text_count = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> meta <span class="keyword">in</span> metadata_to_embed <span class="keyword">if</span> meta.get(<span class="string">&#x27;type&#x27;</span>) == <span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">            image_count = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> meta <span class="keyword">in</span> metadata_to_embed <span class="keyword">if</span> meta.get(<span class="string">&#x27;type&#x27;</span>) == <span class="string">&#x27;image&#x27;</span>)</span><br><span class="line">            table_count = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> meta <span class="keyword">in</span> metadata_to_embed <span class="keyword">if</span> meta.get(<span class="string">&#x27;type&#x27;</span>) == <span class="string">&#x27;table&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;√ Knowledge base setup complete: <span class="subst">&#123;<span class="built_in">len</span>(texts_to_embed)&#125;</span> elements&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot; Content: <span class="subst">&#123;text_count&#125;</span> text, <span class="subst">&#123;image_count&#125;</span> images, <span class="subst">&#123;table_count&#125;</span> tables&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;No content extracted from PDF&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_available_retrieval_methods</span>(<span class="params">self</span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取可用的检索方法&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&quot;Vector&quot;</span>, <span class="string">&quot;Enhanced&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_query_rewriting</span>(<span class="params">self, original_query: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;查询重写 - 使用CAMEL模型&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            prompt = <span class="string">f&quot;&quot;&quot;请重写以下查询，使其更适合文档检索和信息提取：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">原始查询：<span class="subst">&#123;original_query&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">重写要求：</span></span><br><span class="line"><span class="string">1. 保持查询的核心意图</span></span><br><span class="line"><span class="string">2. 使用更具体和明确的词汇</span></span><br><span class="line"><span class="string">3. 适合向量检索和语义匹配</span></span><br><span class="line"><span class="string">4. 只返回重写后的查询，不要其他解释</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">重写后的查询：&quot;&quot;&quot;</span></span><br><span class="line">            </span><br><span class="line">            rewritten_query = <span class="variable language_">self</span>.llm.generate(prompt, max_tokens=<span class="number">100</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 清理返回结果，只保留重写的查询</span></span><br><span class="line">            <span class="keyword">if</span> rewritten_query <span class="keyword">and</span> <span class="keyword">not</span> rewritten_query.startswith(<span class="string">&quot;抱歉&quot;</span>) <span class="keyword">and</span> <span class="keyword">not</span> rewritten_query.startswith(<span class="string">&quot;生成答案时出现错误&quot;</span>):</span><br><span class="line">                <span class="comment"># 提取实际的重写查询</span></span><br><span class="line">                lines = rewritten_query.strip().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">                    line = line.strip()</span><br><span class="line">                    <span class="keyword">if</span> line <span class="keyword">and</span> <span class="keyword">not</span> line.startswith(<span class="string">&#x27;重写后的查询&#x27;</span>) <span class="keyword">and</span> <span class="keyword">not</span> line.startswith(<span class="string">&#x27;原始查询&#x27;</span>):</span><br><span class="line">                        rewritten_query = line</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Query rewritten: <span class="subst">&#123;original_query&#125;</span> -&gt; <span class="subst">&#123;rewritten_query[:<span class="number">50</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> rewritten_query.strip()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;警告：Query rewriting failed, using original query&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> original_query</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;警告：Query rewriting failed: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> original_query</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_hyde_generation</span>(<span class="params">self, query: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;HyDE假设文档生成 - 使用CAMEL模型&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            prompt = <span class="string">f&quot;&quot;&quot;基于以下查询，生成一个假设性的文档片段，该片段可能包含查询的答案：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">查询：<span class="subst">&#123;query&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">要求：</span></span><br><span class="line"><span class="string">1. 生成一个200-300字的文档片段</span></span><br><span class="line"><span class="string">2. 内容应该直接回答查询问题</span></span><br><span class="line"><span class="string">3. 使用专业和准确的语言</span></span><br><span class="line"><span class="string">4. 包含相关的技术细节和概念</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">假设文档：&quot;&quot;&quot;</span></span><br><span class="line">            </span><br><span class="line">            hyde_doc = <span class="variable language_">self</span>.llm.generate(prompt, max_tokens=<span class="number">300</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> hyde_doc <span class="keyword">and</span> <span class="keyword">not</span> hyde_doc.startswith(<span class="string">&quot;抱歉&quot;</span>) <span class="keyword">and</span> <span class="keyword">not</span> hyde_doc.startswith(<span class="string">&quot;生成答案时出现错误&quot;</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;📝 HyDE document generated: <span class="subst">&#123;<span class="built_in">len</span>(hyde_doc)&#125;</span> characters&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> hyde_doc.strip()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;警告：HyDE generation failed, using original query&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> query</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;警告：HyDE generation failed: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> query</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_rrf_fusion</span>(<span class="params">self, all_results: <span class="type">List</span>[<span class="type">List</span>[<span class="type">Dict</span>]], k: <span class="built_in">int</span> = <span class="number">60</span></span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;RRF融合多个检索结果&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            doc_scores = &#123;&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> results <span class="keyword">in</span> all_results:</span><br><span class="line">                <span class="keyword">for</span> rank, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(results):</span><br><span class="line">                    doc_id = doc.get(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                    <span class="keyword">if</span> doc_id:</span><br><span class="line">                        rrf_score = <span class="number">1.0</span> / (k + rank + <span class="number">1</span>)</span><br><span class="line">                        <span class="keyword">if</span> doc_id <span class="keyword">in</span> doc_scores:</span><br><span class="line">                            doc_scores[doc_id][<span class="string">&#x27;score&#x27;</span>] += rrf_score</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            doc_scores[doc_id] = &#123;</span><br><span class="line">                                <span class="string">&#x27;doc&#x27;</span>: doc,</span><br><span class="line">                                <span class="string">&#x27;score&#x27;</span>: rrf_score</span><br><span class="line">                            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 按分数排序</span></span><br><span class="line">            sorted_docs = <span class="built_in">sorted</span>(doc_scores.values(), key=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;score&#x27;</span>], reverse=<span class="literal">True</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 为文档添加RRF分数</span></span><br><span class="line">            final_docs = []</span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> sorted_docs:</span><br><span class="line">                doc = item[<span class="string">&#x27;doc&#x27;</span>].copy()</span><br><span class="line">                doc[<span class="string">&#x27;rrf_score&#x27;</span>] = item[<span class="string">&#x27;score&#x27;</span>]</span><br><span class="line">                final_docs.append(doc)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> final_docs</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;警告：RRF fusion failed: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> all_results[<span class="number">0</span>] <span class="keyword">if</span> all_results <span class="keyword">else</span> []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">enhanced_query</span>(<span class="params">self, original_query: <span class="built_in">str</span>, use_rewriting: <span class="built_in">bool</span> = <span class="literal">True</span>, use_hyde: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">                      use_rrf: <span class="built_in">bool</span> = <span class="literal">True</span>, top_k: <span class="built_in">int</span> = <span class="number">5</span>, rrf_k: <span class="built_in">int</span> = <span class="number">60</span>,</span></span><br><span class="line"><span class="params">                      multimodal_preference: <span class="type">Optional</span>[<span class="type">List</span>[<span class="built_in">str</span>]] = <span class="literal">None</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;执行增强型RAG查询&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.knowledge_base_initialized:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;Knowledge base not initialized&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 根据参数确定检索类型</span></span><br><span class="line">        <span class="keyword">if</span> use_rewriting <span class="keyword">and</span> use_hyde <span class="keyword">and</span> use_rrf:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n执行深度检索...&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;开始执行深度RAG查询&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n执行检索...&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">40</span>)</span><br><span class="line"></span><br><span class="line">        query_for_retrieval = original_query</span><br><span class="line">        rewritten_query = <span class="literal">None</span></span><br><span class="line">        hyde_doc = <span class="literal">None</span></span><br><span class="line">        retrieval_method = <span class="string">&quot;Vector&quot;</span></span><br><span class="line">        all_retrieved_results = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 步骤1: 查询重写</span></span><br><span class="line">        <span class="keyword">if</span> use_rewriting:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n步骤1: 查询重写&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">30</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;原始查询: <span class="subst">&#123;original_query&#125;</span>&quot;</span>)</span><br><span class="line">            rewritten_query = <span class="variable language_">self</span>._query_rewriting(original_query)</span><br><span class="line">            query_for_retrieval = rewritten_query</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;重写查询: <span class="subst">&#123;rewritten_query&#125;</span>&quot;</span>)</span><br><span class="line">            retrieval_method += <span class="string">&quot;+Rewriting&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 步骤2: 文档检索</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n步骤2: 文档检索&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">30</span>)</span><br><span class="line">        <span class="keyword">if</span> use_hyde <span class="keyword">and</span> use_rrf:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;使用HyDE+RRF组合方法进行检索...&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;使用RRF算法进行混合检索（HyDE增强向量检索）...&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;使用基础向量检索...&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># HyDE生成</span></span><br><span class="line">        <span class="keyword">if</span> use_hyde:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;执行HyDE增强向量检索...&quot;</span>)</span><br><span class="line">            hyde_doc = <span class="variable language_">self</span>._hyde_generation(query_for_retrieval)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;生成的假设文档:&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(hyde_doc)</span><br><span class="line">            retrieval_method += <span class="string">&quot;+HyDE&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 多模态检索</span></span><br><span class="line">        text_results = <span class="variable language_">self</span>.vector_retriever.query(query_for_retrieval, top_k=top_k, filter_type=<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">        all_retrieved_results.append(text_results)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;✓ HyDE向量检索完成，获得 <span class="subst">&#123;<span class="built_in">len</span>(text_results)&#125;</span> 个结果&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> multimodal_preference:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;image&#x27;</span> <span class="keyword">in</span> multimodal_preference:</span><br><span class="line">                image_results = <span class="variable language_">self</span>.vector_retriever.query(query_for_retrieval, top_k=top_k, filter_type=<span class="string">&#x27;image&#x27;</span>)</span><br><span class="line">                all_retrieved_results.append(image_results)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;✓ 图像检索完成，获得 <span class="subst">&#123;<span class="built_in">len</span>(image_results)&#125;</span> 个结果&quot;</span>)</span><br><span class="line">                retrieval_method += <span class="string">&quot;+Image&quot;</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;table&#x27;</span> <span class="keyword">in</span> multimodal_preference:</span><br><span class="line">                table_results = <span class="variable language_">self</span>.vector_retriever.query(query_for_retrieval, top_k=top_k, filter_type=<span class="string">&#x27;table&#x27;</span>)</span><br><span class="line">                all_retrieved_results.append(table_results)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;✓ 表格检索完成，获得 <span class="subst">&#123;<span class="built_in">len</span>(table_results)&#125;</span> 个结果&quot;</span>)</span><br><span class="line">                retrieval_method += <span class="string">&quot;+Table&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> hyde_doc:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;执行BM25检索（使用原始查询）...&quot;</span>)</span><br><span class="line">            hyde_results = <span class="variable language_">self</span>.vector_retriever.query(hyde_doc, top_k=top_k)</span><br><span class="line">            all_retrieved_results.append(hyde_results)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;✓ BM25检索成功，获得 <span class="subst">&#123;<span class="built_in">len</span>(hyde_results)&#125;</span> 个结果&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># RRF融合</span></span><br><span class="line">        <span class="keyword">if</span> use_rrf <span class="keyword">and</span> <span class="built_in">len</span>(all_retrieved_results) &gt; <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;使用RRF算法融合检索结果...&quot;</span>)</span><br><span class="line">            final_retrieved_docs = <span class="variable language_">self</span>._rrf_fusion(all_retrieved_results, k=rrf_k)</span><br><span class="line">            retrieval_method += <span class="string">&quot;+RRF&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 统计唯一文档数量</span></span><br><span class="line">            unique_doc_ids = <span class="built_in">set</span>()</span><br><span class="line">            <span class="keyword">for</span> res_list <span class="keyword">in</span> all_retrieved_results:</span><br><span class="line">                <span class="keyword">for</span> doc <span class="keyword">in</span> res_list:</span><br><span class="line">                    unique_doc_ids.add(doc.get(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;RRF融合完成，共处理 <span class="subst">&#123;<span class="built_in">len</span>(unique_doc_ids)&#125;</span> 个唯一文档，返回前 <span class="subst">&#123;top_k&#125;</span> 个结果&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;HyDE+RRF检索完成，返回 <span class="subst">&#123;<span class="built_in">len</span>(final_retrieved_docs)&#125;</span> 个文档&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            unique_docs = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> res_list <span class="keyword">in</span> all_retrieved_results:</span><br><span class="line">                <span class="keyword">for</span> doc <span class="keyword">in</span> res_list:</span><br><span class="line">                    <span class="keyword">if</span> doc.get(<span class="string">&#x27;id&#x27;</span>) <span class="keyword">not</span> <span class="keyword">in</span> unique_docs:</span><br><span class="line">                        unique_docs[doc.get(<span class="string">&#x27;id&#x27;</span>)] = doc</span><br><span class="line">            final_retrieved_docs = <span class="built_in">list</span>(unique_docs.values())</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;文档合并完成，返回 <span class="subst">&#123;<span class="built_in">len</span>(final_retrieved_docs)&#125;</span> 个文档&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 限制最终文档数量</span></span><br><span class="line">        final_retrieved_docs = final_retrieved_docs[:top_k]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 显示检索到的文档预览</span></span><br><span class="line">        <span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(final_retrieved_docs, <span class="number">1</span>):</span><br><span class="line">            similarity = doc.get(<span class="string">&#x27;similarity&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">            rrf_score = <span class="built_in">getattr</span>(doc, <span class="string">&#x27;rrf_score&#x27;</span>, similarity)  <span class="comment"># 如果有RRF分数则使用，否则使用相似度</span></span><br><span class="line">            text_preview = doc.get(<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;&#x27;</span>)[:<span class="number">200</span>] + <span class="string">&quot;...&quot;</span> <span class="keyword">if</span> <span class="built_in">len</span>(doc.get(<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;&#x27;</span>)) &gt; <span class="number">200</span> <span class="keyword">else</span> doc.get(<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;文档 <span class="subst">&#123;i&#125;</span> (RRF分数: <span class="subst">&#123;rrf_score:<span class="number">.4</span>f&#125;</span>):&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;text_preview&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 步骤3: 答案生成</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;步骤3: 答案生成&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">30</span>)</span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 构建上下文</span></span><br><span class="line">        context_texts = []</span><br><span class="line">        <span class="keyword">for</span> doc <span class="keyword">in</span> final_retrieved_docs:</span><br><span class="line">            context_texts.append(doc[<span class="string">&#x27;text&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 生成最终答案</span></span><br><span class="line">        separator = <span class="string">&#x27;\n---\n&#x27;</span></span><br><span class="line">        context_str = separator.join(context_texts)</span><br><span class="line">        </span><br><span class="line">        prompt_for_llm = <span class="string">f&quot;&quot;&quot;你是一个专业的文档分析助手。请基于以下PDF文档内容回答用户问题。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">文档内容：</span></span><br><span class="line"><span class="string"><span class="subst">&#123;context_str&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">用户问题：<span class="subst">&#123;original_query&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">回答要求：</span></span><br><span class="line"><span class="string">1. 仔细阅读并理解文档内容</span></span><br><span class="line"><span class="string">2. 基于文档内容提供准确、详细的答案</span></span><br><span class="line"><span class="string">3. 如果文档中没有相关信息，请明确说明</span></span><br><span class="line"><span class="string">4. 使用清晰的结构组织答案</span></span><br><span class="line"><span class="string">5. 引用具体的文档内容支持你的回答</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">请提供详细的答案：&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;正在生成最终答案...&quot;</span>)</span><br><span class="line">        final_answer = <span class="variable language_">self</span>.llm.generate(prompt_for_llm, max_tokens=<span class="number">800</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> final_answer <span class="keyword">and</span> <span class="keyword">not</span> final_answer.startswith(<span class="string">&quot;抱歉&quot;</span>) <span class="keyword">and</span> <span class="keyword">not</span> final_answer.startswith(<span class="string">&quot;生成答案时出现错误&quot;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;√ 答案生成成功&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;最终答案:&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(final_answer)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;警告：答案生成失败，提供基于检索文档的简化回答&quot;</span>)</span><br><span class="line">            <span class="comment"># 提供基于检索文档的简化回答</span></span><br><span class="line">            simple_answer = <span class="string">f&quot;基于检索到的文档内容，关于&#x27;<span class="subst">&#123;original_query&#125;</span>&#x27;的相关信息如下：\n\n&quot;</span></span><br><span class="line">            <span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(final_retrieved_docs[:<span class="number">3</span>], <span class="number">1</span>):</span><br><span class="line">                simple_answer += <span class="string">f&quot;<span class="subst">&#123;i&#125;</span>. <span class="subst">&#123;doc[<span class="string">&#x27;text&#x27;</span>][:<span class="number">200</span>]&#125;</span>...\n\n&quot;</span></span><br><span class="line">            final_answer = simple_answer</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;最终答案:&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(final_answer)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;original_query&#x27;</span>: original_query,</span><br><span class="line">            <span class="string">&#x27;rewritten_query&#x27;</span>: rewritten_query,</span><br><span class="line">            <span class="string">&#x27;hyde_doc&#x27;</span>: hyde_doc,</span><br><span class="line">            <span class="string">&#x27;retrieved_docs&#x27;</span>: final_retrieved_docs,</span><br><span class="line">            <span class="string">&#x27;final_answer&#x27;</span>: final_answer,</span><br><span class="line">            <span class="string">&#x27;retrieval_method&#x27;</span>: retrieval_method</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InteractiveMultimodalRAG</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;交互式多模态RAG系统 - 集成CAMEL ModelFactory&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.api_key = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.rag_system = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.web_research_system = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.knowledge_base_loaded = <span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>.current_pdf_source = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">initialize_system</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;初始化系统 - 使用CAMEL ModelFactory&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;初始化交互式多模态RAG系统...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 加载环境变量</span></span><br><span class="line">        load_dotenv()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取API密钥</span></span><br><span class="line">        <span class="variable language_">self</span>.api_key = os.getenv(<span class="string">&#x27;MODELSCOPE_SDK_TOKEN&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.api_key:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;错误：错误：请设置MODELSCOPE_SDK_TOKEN环境变量&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;提示：在.env文件中添加 MODELSCOPE_SDK_TOKEN=your_api_key&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 使用集成CAMEL的简化RAG系统</span></span><br><span class="line">            <span class="variable language_">self</span>.rag_system = SimpleRAGSystem(api_key=<span class="variable language_">self</span>.api_key, model_name=<span class="string">&quot;Qwen/Qwen2.5-72B-Instruct&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;√ 集成CAMEL的RAG系统初始化成功&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 初始化网页研究系统</span></span><br><span class="line">            <span class="keyword">if</span> WEB_RESEARCH_AVAILABLE:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="variable language_">self</span>.web_research_system = EnhancedInteractiveResearchSystem()</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;√ 网页研究系统初始化成功&quot;</span>)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;！警告： 网页研究系统初始化失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="variable language_">self</span>.web_research_system = <span class="literal">None</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;！错误：系统初始化失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_pdf_knowledge_base</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;加载PDF知识库&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nPDF知识库设置&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;1. 在线PDF (输入URL)&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;2. 本地PDF (输入文件路径)&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;3. 使用默认示例PDF&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        choice = <span class="built_in">input</span>(<span class="string">&quot;\n请选择PDF来源 (1-3): &quot;</span>).strip()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> choice == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">                pdf_url = <span class="built_in">input</span>(<span class="string">&quot;请输入PDF的URL: &quot;</span>).strip()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> pdf_url:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;错误：URL不能为空&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">                </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;↓ 正在加载在线PDF: <span class="subst">&#123;pdf_url&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="variable language_">self</span>.rag_system.setup_knowledge_base(pdf_url=pdf_url)</span><br><span class="line">                <span class="variable language_">self</span>.current_pdf_source = <span class="string">f&quot;在线PDF: <span class="subst">&#123;pdf_url&#125;</span>&quot;</span></span><br><span class="line">                </span><br><span class="line">            <span class="keyword">elif</span> choice == <span class="string">&quot;2&quot;</span>:</span><br><span class="line">                pdf_path = <span class="built_in">input</span>(<span class="string">&quot;请输入PDF文件路径: &quot;</span>).strip()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> pdf_path:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;错误：文件路径不能为空&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(pdf_path):</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;错误：文件不存在: <span class="subst">&#123;pdf_path&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">                </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;状态查询： 正在加载本地PDF: <span class="subst">&#123;pdf_path&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="variable language_">self</span>.rag_system.setup_knowledge_base(pdf_path=pdf_path)</span><br><span class="line">                <span class="variable language_">self</span>.current_pdf_source = <span class="string">f&quot;本地PDF: <span class="subst">&#123;pdf_path&#125;</span>&quot;</span></span><br><span class="line">                </span><br><span class="line">            <span class="keyword">elif</span> choice == <span class="string">&quot;3&quot;</span>:</span><br><span class="line">                pdf_url = <span class="string">&quot;https://arxiv.org/pdf/2303.17760.pdf&quot;</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;↓ 正在加载默认示例PDF: <span class="subst">&#123;pdf_url&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="variable language_">self</span>.rag_system.setup_knowledge_base(pdf_url=pdf_url)</span><br><span class="line">                <span class="variable language_">self</span>.current_pdf_source = <span class="string">f&quot;示例PDF: CAMEL论文&quot;</span></span><br><span class="line">                </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;错误：无效选择&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">self</span>.knowledge_base_loaded = <span class="literal">True</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;√ PDF知识库加载成功！&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;错误：PDF加载失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute_query</span>(<span class="params">self, query: <span class="built_in">str</span>, retrieval_mode: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;执行查询&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.knowledge_base_loaded:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;知识库未加载，请先加载PDF&quot;</span>&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n执行查询: <span class="subst">&#123;query&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;检索模式: <span class="subst">&#123;retrieval_mode&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> retrieval_mode == <span class="string">&quot;快速检索&quot;</span>:</span><br><span class="line">                <span class="comment"># 基础向量检索 - 直接检索生成答案</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">self</span>.quick_retrieval(query)</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">elif</span> retrieval_mode == <span class="string">&quot;深度检索&quot;</span>:</span><br><span class="line">                <span class="comment"># 完整增强检索</span></span><br><span class="line">                results = <span class="variable language_">self</span>.rag_system.enhanced_query(</span><br><span class="line">                    original_query=query,</span><br><span class="line">                    use_rewriting=<span class="literal">True</span>,</span><br><span class="line">                    use_hyde=<span class="literal">True</span>,</span><br><span class="line">                    use_rrf=<span class="literal">True</span>,</span><br><span class="line">                    top_k=<span class="number">5</span>,</span><br><span class="line">                    multimodal_preference=[<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;image&#x27;</span>, <span class="string">&#x27;table&#x27;</span>]</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">elif</span> retrieval_mode == <span class="string">&quot;主题检索&quot;</span>:</span><br><span class="line">                <span class="comment"># 网页爬取检索 - 使用真实的网页研究系统</span></span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">self</span>.topic_retrieval(query)</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">f&quot;未知检索模式: <span class="subst">&#123;retrieval_mode&#125;</span>&quot;</span>&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> results</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">f&quot;查询执行失败: <span class="subst">&#123;e&#125;</span>&quot;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">quick_retrieval</span>(<span class="params">self, query: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;快速检索 - 基础向量检索直接生成答案&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n执行快速检索...&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">40</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 直接进行向量检索</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在进行向量检索...&quot;</span>)</span><br><span class="line">            retrieved_docs = <span class="variable language_">self</span>.rag_system.vector_retriever.query(query, top_k=<span class="number">3</span>, filter_type=<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> retrieved_docs:</span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;未找到相关文档&quot;</span>&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;√ 检索到 <span class="subst">&#123;<span class="built_in">len</span>(retrieved_docs)&#125;</span> 个相关文档&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 显示检索到的文档</span></span><br><span class="line">            <span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(retrieved_docs, <span class="number">1</span>):</span><br><span class="line">                similarity = doc.get(<span class="string">&#x27;similarity&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">                text_preview = doc.get(<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;&#x27;</span>)[:<span class="number">150</span>] + <span class="string">&quot;...&quot;</span> <span class="keyword">if</span> <span class="built_in">len</span>(doc.get(<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;&#x27;</span>)) &gt; <span class="number">150</span> <span class="keyword">else</span> doc.get(<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;文档 <span class="subst">&#123;i&#125;</span> (相似度: <span class="subst">&#123;similarity:<span class="number">.3</span>f&#125;</span>):&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;   <span class="subst">&#123;text_preview&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 构建简单的上下文</span></span><br><span class="line">            context_texts = [doc[<span class="string">&#x27;text&#x27;</span>] <span class="keyword">for</span> doc <span class="keyword">in</span> retrieved_docs]</span><br><span class="line">            context_str = <span class="string">&#x27;\n---\n&#x27;</span>.join(context_texts)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 生成答案</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在生成答案...&quot;</span>)</span><br><span class="line">            prompt = <span class="string">f&quot;&quot;&quot;基于以下文档内容回答问题：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">文档内容：</span></span><br><span class="line"><span class="string"><span class="subst">&#123;context_str&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">问题：<span class="subst">&#123;query&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">请提供简洁明确的答案：&quot;&quot;&quot;</span></span><br><span class="line">            </span><br><span class="line">            final_answer = <span class="variable language_">self</span>.rag_system.llm.generate(prompt, max_tokens=<span class="number">400</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;√ 快速检索完成&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&#x27;original_query&#x27;</span>: query,</span><br><span class="line">                <span class="string">&#x27;retrieved_docs&#x27;</span>: retrieved_docs,</span><br><span class="line">                <span class="string">&#x27;final_answer&#x27;</span>: final_answer,</span><br><span class="line">                <span class="string">&#x27;retrieval_method&#x27;</span>: <span class="string">&#x27;Quick Vector Retrieval&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">f&quot;快速检索失败: <span class="subst">&#123;e&#125;</span>&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">topic_retrieval</span>(<span class="params">self, query: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;主题检索 - 集成网页研究系统&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n执行网页检索...&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">40</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.web_research_system:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;警告：网页研究系统不可用，使用备用方案&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">self</span>.perform_fallback_topic_search(query)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 使用网页研究系统进行搜索</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在进行网页研究...&quot;</span>)</span><br><span class="line">            web_content = <span class="string">&quot;&quot;</span></span><br><span class="line">            web_sources = []</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 检查可用的方法并调用正确的方法</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">hasattr</span>(<span class="variable language_">self</span>.web_research_system, <span class="string">&#x27;research_and_analyze&#x27;</span>):</span><br><span class="line">                    <span class="comment"># 使用正确的方法名</span></span><br><span class="line">                    research_result = <span class="variable language_">self</span>.web_research_system.research_and_analyze(query)</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">isinstance</span>(research_result, <span class="built_in">dict</span>):</span><br><span class="line">                        web_content = research_result.get(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                        web_sources = research_result.get(<span class="string">&#x27;sources&#x27;</span>, [])</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        web_content = <span class="built_in">str</span>(research_result)</span><br><span class="line">                        web_sources = [<span class="string">&quot;网页研究结果&quot;</span>]</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;√ 网页研究完成&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">elif</span> <span class="built_in">hasattr</span>(<span class="variable language_">self</span>.web_research_system, <span class="string">&#x27;toolkit&#x27;</span>) <span class="keyword">and</span> <span class="built_in">hasattr</span>(<span class="variable language_">self</span>.web_research_system.toolkit, <span class="string">&#x27;search_web_for_topic&#x27;</span>):</span><br><span class="line">                    <span class="comment"># 使用工具包搜索</span></span><br><span class="line">                    search_result = <span class="variable language_">self</span>.web_research_system.toolkit.search_web_for_topic(query, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                    web_content = search_result</span><br><span class="line">                    web_sources = [<span class="string">&quot;网页搜索结果&quot;</span>]</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;√ 网页搜索完成&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">elif</span> <span class="built_in">hasattr</span>(<span class="variable language_">self</span>.web_research_system, <span class="string">&#x27;run_interactive_session&#x27;</span>):</span><br><span class="line">                    <span class="comment"># 尝试使用交互式会话方法</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;警告：使用交互式研究系统，但无法直接调用&quot;</span>)</span><br><span class="line">                    web_content = <span class="string">f&quot;关于&#x27;<span class="subst">&#123;query&#125;</span>&#x27;的网页研究信息需要交互式操作&quot;</span></span><br><span class="line">                    web_sources = [<span class="string">&quot;交互式研究系统&quot;</span>]</span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;警告：网页研究系统方法不可用&quot;</span>)</span><br><span class="line">                    web_content = <span class="string">f&quot;关于&#x27;<span class="subst">&#123;query&#125;</span>&#x27;的网页搜索信息暂时不可用&quot;</span></span><br><span class="line">                    web_sources = []</span><br><span class="line">                    </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;警告：网页搜索失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                web_content = <span class="string">f&quot;网页搜索遇到错误: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line">                web_sources = []</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 同时进行PDF检索</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在检索PDF文档...&quot;</span>)</span><br><span class="line">            pdf_docs = <span class="variable language_">self</span>.rag_system.vector_retriever.query(query, top_k=<span class="number">3</span>, filter_type=<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 合并结果</span></span><br><span class="line">            combined_context = <span class="string">&quot;&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加PDF内容</span></span><br><span class="line">            <span class="keyword">if</span> pdf_docs:</span><br><span class="line">                pdf_context = <span class="string">&quot;\n&quot;</span>.join([doc[<span class="string">&#x27;text&#x27;</span>] <span class="keyword">for</span> doc <span class="keyword">in</span> pdf_docs])</span><br><span class="line">                combined_context += <span class="string">f&quot;PDF文档内容：\n<span class="subst">&#123;pdf_context&#125;</span>\n\n&quot;</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;√ 检索到 <span class="subst">&#123;<span class="built_in">len</span>(pdf_docs)&#125;</span> 个PDF文档&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加网页内容</span></span><br><span class="line">            <span class="keyword">if</span> web_content <span class="keyword">and</span> web_content.strip() <span class="keyword">and</span> <span class="keyword">not</span> web_content.startswith(<span class="string">&quot;关于&quot;</span>) <span class="keyword">and</span> <span class="keyword">not</span> web_content.startswith(<span class="string">&quot;网页搜索遇到错误&quot;</span>):</span><br><span class="line">                combined_context += <span class="string">f&quot;网页搜索内容：\n<span class="subst">&#123;web_content&#125;</span>\n\n&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> combined_context.strip():</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;警告：未找到相关信息，使用备用方案&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">self</span>.perform_fallback_topic_search(query)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 生成综合答案</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在生成综合答案...&quot;</span>)</span><br><span class="line">            prompt = <span class="string">f&quot;&quot;&quot;基于以下PDF文档和网页搜索的信息，回答问题：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="subst">&#123;combined_context&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">问题：<span class="subst">&#123;query&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">请提供综合性的详细答案：&quot;&quot;&quot;</span></span><br><span class="line">            </span><br><span class="line">            final_answer = <span class="variable language_">self</span>.rag_system.llm.generate(prompt, max_tokens=<span class="number">800</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;主题检索完成&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&#x27;original_query&#x27;</span>: query,</span><br><span class="line">                <span class="string">&#x27;pdf_docs&#x27;</span>: pdf_docs,</span><br><span class="line">                <span class="string">&#x27;web_sources&#x27;</span>: web_sources,</span><br><span class="line">                <span class="string">&#x27;final_answer&#x27;</span>: final_answer,</span><br><span class="line">                <span class="string">&#x27;retrieval_method&#x27;</span>: <span class="string">&#x27;PDF+Web Topic Retrieval&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;警告：主题检索失败，使用备用方案: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.perform_fallback_topic_search(query)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perform_web_research</span>(<span class="params">self, query: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;执行网页研究&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;正在进行网页研究...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 模拟网页研究结果</span></span><br><span class="line">            web_content = <span class="string">f&quot;基于网页搜索的<span class="subst">&#123;query&#125;</span>相关信息：\n&quot;</span></span><br><span class="line">            web_content += <span class="string">&quot;- 网页来源1的相关内容\n&quot;</span></span><br><span class="line">            web_content += <span class="string">&quot;- 网页来源2的相关内容\n&quot;</span></span><br><span class="line">            web_content += <span class="string">&quot;- 网页来源3的相关内容&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;web_content&quot;</span>: web_content,</span><br><span class="line">                <span class="string">&quot;sources&quot;</span>: [<span class="string">&quot;网页来源1&quot;</span>, <span class="string">&quot;网页来源2&quot;</span>, <span class="string">&quot;网页来源3&quot;</span>],</span><br><span class="line">                <span class="string">&quot;method&quot;</span>: <span class="string">&quot;web_research&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;网页研究失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">f&quot;网页研究失败: <span class="subst">&#123;e&#125;</span>&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perform_fallback_topic_search</span>(<span class="params">self, query: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;备用主题搜索 - 仅使用PDF检索&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;执行备用主题搜索（仅PDF检索）...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 进行PDF检索</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在检索PDF文档...&quot;</span>)</span><br><span class="line">            pdf_docs = <span class="variable language_">self</span>.rag_system.vector_retriever.query(query, top_k=<span class="number">5</span>, filter_type=<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> pdf_docs:</span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;未找到相关PDF文档&quot;</span>&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;检索到 <span class="subst">&#123;<span class="built_in">len</span>(pdf_docs)&#125;</span> 个PDF文档&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 显示检索到的文档</span></span><br><span class="line">            <span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(pdf_docs, <span class="number">1</span>):</span><br><span class="line">                similarity = doc.get(<span class="string">&#x27;similarity&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">                text_preview = doc.get(<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;&#x27;</span>)[:<span class="number">150</span>] + <span class="string">&quot;...&quot;</span> <span class="keyword">if</span> <span class="built_in">len</span>(doc.get(<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;&#x27;</span>)) &gt; <span class="number">150</span> <span class="keyword">else</span> doc.get(<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;文档 <span class="subst">&#123;i&#125;</span> (相似度: <span class="subst">&#123;similarity:<span class="number">.3</span>f&#125;</span>):&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;   <span class="subst">&#123;text_preview&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 构建上下文</span></span><br><span class="line">            pdf_context = <span class="string">&quot;\n&quot;</span>.join([doc[<span class="string">&#x27;text&#x27;</span>] <span class="keyword">for</span> doc <span class="keyword">in</span> pdf_docs])</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 生成答案</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;正在生成答案...&quot;</span>)</span><br><span class="line">            prompt = <span class="string">f&quot;&quot;&quot;基于以下PDF文档内容回答问题：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">PDF文档内容：</span></span><br><span class="line"><span class="string"><span class="subst">&#123;pdf_context&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">问题：<span class="subst">&#123;query&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">请提供详细的答案，特别关注CAMEL框架的特性和工具：&quot;&quot;&quot;</span></span><br><span class="line">            </span><br><span class="line">            final_answer = <span class="variable language_">self</span>.rag_system.llm.generate(prompt, max_tokens=<span class="number">800</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;√ 备用主题搜索完成&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&#x27;original_query&#x27;</span>: query,</span><br><span class="line">                <span class="string">&#x27;retrieved_docs&#x27;</span>: pdf_docs,</span><br><span class="line">                <span class="string">&#x27;final_answer&#x27;</span>: final_answer,</span><br><span class="line">                <span class="string">&#x27;retrieval_method&#x27;</span>: <span class="string">&#x27;Fallback PDF Topic Retrieval&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;备用主题搜索失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">f&quot;备用主题搜索失败: <span class="subst">&#123;e&#125;</span>&quot;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">merge_web_and_pdf_results</span>(<span class="params">self, web_results: <span class="type">Dict</span>, pdf_results: <span class="type">Dict</span>, query: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;合并网页和PDF检索结果&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 合并上下文</span></span><br><span class="line">            combined_context = <span class="string">&quot;&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加PDF内容</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;retrieved_docs&#x27;</span> <span class="keyword">in</span> pdf_results:</span><br><span class="line">                pdf_context = <span class="string">&quot;\n&quot;</span>.join([doc[<span class="string">&#x27;text&#x27;</span>] <span class="keyword">for</span> doc <span class="keyword">in</span> pdf_results[<span class="string">&#x27;retrieved_docs&#x27;</span>]])</span><br><span class="line">                combined_context += <span class="string">f&quot;PDF文档内容：\n<span class="subst">&#123;pdf_context&#125;</span>\n\n&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 添加网页内容</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;web_content&#x27;</span> <span class="keyword">in</span> web_results:</span><br><span class="line">                combined_context += <span class="string">f&quot;网页搜索内容：\n<span class="subst">&#123;web_results[<span class="string">&#x27;web_content&#x27;</span>]&#125;</span>\n\n&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 生成综合答案</span></span><br><span class="line">            prompt = <span class="string">f&quot;基于以下PDF文档和网页搜索的信息，回答问题：\n\n<span class="subst">&#123;combined_context&#125;</span>\n\n问题：<span class="subst">&#123;query&#125;</span>\n\n请提供综合性的详细答案。&quot;</span></span><br><span class="line">            </span><br><span class="line">            final_answer = <span class="variable language_">self</span>.rag_system.llm.generate(prompt, max_tokens=<span class="number">800</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&#x27;original_query&#x27;</span>: query,</span><br><span class="line">                <span class="string">&#x27;pdf_docs&#x27;</span>: pdf_results.get(<span class="string">&#x27;retrieved_docs&#x27;</span>, []),</span><br><span class="line">                <span class="string">&#x27;web_sources&#x27;</span>: web_results.get(<span class="string">&#x27;sources&#x27;</span>, []),</span><br><span class="line">                <span class="string">&#x27;final_answer&#x27;</span>: final_answer,</span><br><span class="line">                <span class="string">&#x27;retrieval_method&#x27;</span>: <span class="string">&#x27;PDF+Web主题检索&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">f&quot;结果合并失败: <span class="subst">&#123;e&#125;</span>&quot;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display_results</span>(<span class="params">self, results: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;显示查询结果&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;error&#x27;</span> <span class="keyword">in</span> results:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;错误: <span class="subst">&#123;results[<span class="string">&#x27;error&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">20</span> + <span class="string">&quot; 深度检索结果 &quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">20</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;原结始查询: <span class="subst">&#123;results.get(<span class="string">&#x27;original_query&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> results.get(<span class="string">&#x27;rewritten_query&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;重写查询: <span class="subst">&#123;results[<span class="string">&#x27;rewritten_query&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;检索方法: <span class="subst">&#123;results.get(<span class="string">&#x27;retrieval_method&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 显示检索到的文档</span></span><br><span class="line">        retrieved_docs = results.get(<span class="string">&#x27;retrieved_docs&#x27;</span>, [])</span><br><span class="line">        <span class="keyword">if</span> retrieved_docs:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n检索到的文档 (共<span class="subst">&#123;<span class="built_in">len</span>(retrieved_docs)&#125;</span>个):&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>()</span><br><span class="line">            <span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(retrieved_docs, <span class="number">1</span>):</span><br><span class="line">                rrf_score = doc.get(<span class="string">&#x27;rrf_score&#x27;</span>, doc.get(<span class="string">&#x27;similarity&#x27;</span>, <span class="number">0</span>))</span><br><span class="line">                text_preview = doc.get(<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;&#x27;</span>)[:<span class="number">200</span>] + <span class="string">&quot;...&quot;</span> <span class="keyword">if</span> <span class="built_in">len</span>(doc.get(<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;&#x27;</span>)) &gt; <span class="number">200</span> <span class="keyword">else</span> doc.get(<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;文档 <span class="subst">&#123;i&#125;</span>:&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;相关度分数: <span class="subst">&#123;rrf_score&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;内容预览: <span class="subst">&#123;text_preview&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 显示最终答案</span></span><br><span class="line">        final_answer = results.get(<span class="string">&#x27;final_answer&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;💡 生成答案:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(final_answer)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 询问是否保存结果</span></span><br><span class="line">        save_choice = <span class="built_in">input</span>(<span class="string">&quot;\n询问：是否保存结果到文件？(y/n): &quot;</span>).strip().lower()</span><br><span class="line">        <span class="keyword">if</span> save_choice == <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">            <span class="variable language_">self</span>._save_results_to_file(results)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_save_results_to_file</span>(<span class="params">self, results: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;保存结果到文件&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">            timestamp = datetime.now().strftime(<span class="string">&#x27;%Y%m%d_%H%M%S&#x27;</span>)</span><br><span class="line">            filename = <span class="string">f&quot;rag_query_result_<span class="subst">&#123;timestamp&#125;</span>.txt&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(<span class="string">&quot;=&quot;</span>*<span class="number">60</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                f.write(<span class="string">&quot;RAG查询结果报告\n&quot;</span>)</span><br><span class="line">                f.write(<span class="string">&quot;=&quot;</span>*<span class="number">60</span> + <span class="string">&quot;\n\n&quot;</span>)</span><br><span class="line">                f.write(<span class="string">f&quot;查询时间: <span class="subst">&#123;datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)&#125;</span>\n&quot;</span>)</span><br><span class="line">                f.write(<span class="string">f&quot;原始查询: <span class="subst">&#123;results.get(<span class="string">&#x27;original_query&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>)&#125;</span>\n&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> results.get(<span class="string">&#x27;rewritten_query&#x27;</span>):</span><br><span class="line">                    f.write(<span class="string">f&quot;重写查询: <span class="subst">&#123;results[<span class="string">&#x27;rewritten_query&#x27;</span>]&#125;</span>\n&quot;</span>)</span><br><span class="line">                f.write(<span class="string">f&quot;检索方法: <span class="subst">&#123;results.get(<span class="string">&#x27;retrieval_method&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>)&#125;</span>\n\n&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 保存检索文档</span></span><br><span class="line">                retrieved_docs = results.get(<span class="string">&#x27;retrieved_docs&#x27;</span>, [])</span><br><span class="line">                <span class="keyword">if</span> retrieved_docs:</span><br><span class="line">                    f.write(<span class="string">f&quot;检索到的文档 (共<span class="subst">&#123;<span class="built_in">len</span>(retrieved_docs)&#125;</span>个):\n&quot;</span>)</span><br><span class="line">                    f.write(<span class="string">&quot;-&quot;</span> * <span class="number">40</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                    <span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(retrieved_docs, <span class="number">1</span>):</span><br><span class="line">                        rrf_score = doc.get(<span class="string">&#x27;rrf_score&#x27;</span>, doc.get(<span class="string">&#x27;similarity&#x27;</span>, <span class="number">0</span>))</span><br><span class="line">                        f.write(<span class="string">f&quot;\n文档 <span class="subst">&#123;i&#125;</span>:\n&quot;</span>)</span><br><span class="line">                        f.write(<span class="string">f&quot;相关度分数: <span class="subst">&#123;rrf_score&#125;</span>\n&quot;</span>)</span><br><span class="line">                        f.write(<span class="string">f&quot;内容: <span class="subst">&#123;doc.get(<span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;&#x27;</span>)&#125;</span>\n&quot;</span>)</span><br><span class="line">                        f.write(<span class="string">&quot;-&quot;</span> * <span class="number">40</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 保存最终答案</span></span><br><span class="line">                f.write(<span class="string">f&quot;\n生成答案:\n&quot;</span>)</span><br><span class="line">                f.write(results.get(<span class="string">&#x27;final_answer&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>))</span><br><span class="line">                f.write(<span class="string">&quot;\n\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;√ 结果已保存到: <span class="subst">&#123;filename&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;错误：保存失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_interactive_session</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;运行交互式会话&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.initialize_system():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n交互式多模态RAG系统&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;功能特性:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;- 支持在线/本地PDF加载&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;- 三种检索模式&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;- 网页爬取集成&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;- 多模态内容处理&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 加载知识库</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.load_pdf_knowledge_base():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;知识库加载失败，退出系统&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n当前知识库: <span class="subst">&#123;self.current_pdf_source&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;🔧 可用检索方法: <span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(self.rag_system.get_available_retrieval_methods())&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;查询选项&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 获取用户查询</span></span><br><span class="line">                query = <span class="built_in">input</span>(<span class="string">&quot;请输入您的问题 (输入 &#x27;quit&#x27; 退出, &#x27;reload&#x27; 重新加载PDF): &quot;</span>).strip()</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> query.lower() == <span class="string">&#x27;quit&#x27;</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">elif</span> query.lower() == <span class="string">&#x27;reload&#x27;</span>:</span><br><span class="line">                    <span class="keyword">if</span> <span class="variable language_">self</span>.load_pdf_knowledge_base():</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;√ 知识库已重新加载: <span class="subst">&#123;self.current_pdf_source&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">elif</span> <span class="keyword">not</span> query:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;问题不能为空&quot;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 选择检索模式</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\n选择检索模式:&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;1. 快速检索 (基础向量检索)&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;2. 深度检索 (重写+HyDE+RRF)&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;3. 主题检索 (PDF+网页爬取)&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                mode_choice = <span class="built_in">input</span>(<span class="string">&quot;请选择模式 (1-3): &quot;</span>).strip()</span><br><span class="line">                </span><br><span class="line">                mode_map = &#123;</span><br><span class="line">                    <span class="string">&quot;1&quot;</span>: <span class="string">&quot;快速检索&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;2&quot;</span>: <span class="string">&quot;深度检索&quot;</span>, </span><br><span class="line">                    <span class="string">&quot;3&quot;</span>: <span class="string">&quot;主题检索&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                retrieval_mode = mode_map.get(mode_choice)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> retrieval_mode:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;无效选择，使用默认快速检索&quot;</span>)</span><br><span class="line">                    retrieval_mode = <span class="string">&quot;快速检索&quot;</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 执行查询</span></span><br><span class="line">                results = <span class="variable language_">self</span>.execute_query(query, retrieval_mode)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 显示结果</span></span><br><span class="line">                <span class="variable language_">self</span>.display_results(results)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 询问是否继续</span></span><br><span class="line">                continue_choice = <span class="built_in">input</span>(<span class="string">&quot;\n是否继续查询？(y/n): &quot;</span>).strip().lower()</span><br><span class="line">                <span class="keyword">if</span> continue_choice != <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                    </span><br><span class="line">            <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\n\n用户中断，退出系统&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;系统错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n感谢使用交互式多模态RAG系统！&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        interactive_rag = InteractiveMultimodalRAG()</span><br><span class="line">        interactive_rag.run_interactive_session()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;系统启动失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>


<p><strong>分支代码1</strong>：【RAG_WEB_TOPIC_Enhanced.py】</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Optional</span>, <span class="type">Any</span></span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> agentops</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span> Fore, init</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> camel.loaders <span class="keyword">import</span> Firecrawl, UnstructuredIO</span><br><span class="line"><span class="keyword">from</span> camel.retrievers <span class="keyword">import</span> AutoRetriever</span><br><span class="line"><span class="keyword">from</span> camel.toolkits <span class="keyword">import</span> FunctionTool, SearchToolkit</span><br><span class="line"><span class="keyword">from</span> camel.types <span class="keyword">import</span> ModelPlatformType, StorageType</span><br><span class="line"><span class="keyword">from</span> camel.embeddings <span class="keyword">import</span> SentenceTransformerEncoder</span><br><span class="line"><span class="keyword">from</span> camel.models <span class="keyword">import</span> ModelFactory</span><br><span class="line"><span class="keyword">from</span> camel.societies <span class="keyword">import</span> RolePlaying</span><br><span class="line"><span class="keyword">from</span> camel.utils <span class="keyword">import</span> print_text_animated</span><br><span class="line"><span class="keyword">from</span> camel.storages <span class="keyword">import</span> Neo4jGraph</span><br><span class="line"><span class="keyword">from</span> camel.agents <span class="keyword">import</span> KnowledgeGraphAgent, ChatAgent</span><br><span class="line"><span class="keyword">from</span> camel.messages <span class="keyword">import</span> BaseMessage</span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入原始系统的所有类和配置</span></span><br><span class="line"><span class="keyword">from</span> RAG_WEB_TOPIC <span class="keyword">import</span> (</span><br><span class="line">    ResearchConfig, ConfigManager, UniversalResearchSystem, </span><br><span class="line">    InteractiveResearchSystem</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化 colorama</span></span><br><span class="line">init(autoreset=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局会话数据记录</span></span><br><span class="line">research_session_data = &#123;</span><br><span class="line">    <span class="string">&#x27;start_time&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">&#x27;end_time&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">&#x27;topic&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;research_question&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;search_results&#x27;</span>: [],</span><br><span class="line">    <span class="string">&#x27;retrieval_results&#x27;</span>: [],</span><br><span class="line">    <span class="string">&#x27;knowledge_graphs&#x27;</span>: [],</span><br><span class="line">    <span class="string">&#x27;conversation_history&#x27;</span>: [],</span><br><span class="line">    <span class="string">&#x27;generated_files&#x27;</span>: [],</span><br><span class="line">    <span class="string">&#x27;system_stats&#x27;</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EnhancedInteractiveResearchSystem</span>(<span class="title class_ inherited__">InteractiveResearchSystem</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;增强版交互式研究系统 - 支持最终报告生成&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.session_data = research_session_data</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_search_result</span>(<span class="params">self, query: <span class="built_in">str</span>, results: <span class="type">Any</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;记录搜索结果&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.session_data[<span class="string">&#x27;search_results&#x27;</span>].append(&#123;</span><br><span class="line">            <span class="string">&#x27;query&#x27;</span>: query,</span><br><span class="line">            <span class="string">&#x27;results&#x27;</span>: <span class="built_in">str</span>(results)[:<span class="number">1000</span>],  <span class="comment"># 限制长度</span></span><br><span class="line">            <span class="string">&#x27;timestamp&#x27;</span>: datetime.now().isoformat()</span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_retrieval_result</span>(<span class="params">self, urls: <span class="type">List</span>[<span class="built_in">str</span>], query: <span class="built_in">str</span>, results: <span class="type">Any</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;记录检索结果&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.session_data[<span class="string">&#x27;retrieval_results&#x27;</span>].append(&#123;</span><br><span class="line">            <span class="string">&#x27;urls&#x27;</span>: urls,</span><br><span class="line">            <span class="string">&#x27;query&#x27;</span>: query,</span><br><span class="line">            <span class="string">&#x27;results&#x27;</span>: <span class="built_in">str</span>(results)[:<span class="number">1000</span>],  <span class="comment"># 限制长度</span></span><br><span class="line">            <span class="string">&#x27;timestamp&#x27;</span>: datetime.now().isoformat()</span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_knowledge_graph</span>(<span class="params">self, text_input: <span class="built_in">str</span>, topic: <span class="built_in">str</span>, result: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;记录知识图谱构建&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.session_data[<span class="string">&#x27;knowledge_graphs&#x27;</span>].append(&#123;</span><br><span class="line">            <span class="string">&#x27;input_text&#x27;</span>: text_input[:<span class="number">500</span>] + <span class="string">&quot;...&quot;</span> <span class="keyword">if</span> <span class="built_in">len</span>(text_input) &gt; <span class="number">500</span> <span class="keyword">else</span> text_input,</span><br><span class="line">            <span class="string">&#x27;topic&#x27;</span>: topic,</span><br><span class="line">            <span class="string">&#x27;result&#x27;</span>: result[:<span class="number">500</span>] + <span class="string">&quot;...&quot;</span> <span class="keyword">if</span> <span class="built_in">len</span>(result) &gt; <span class="number">500</span> <span class="keyword">else</span> result,</span><br><span class="line">            <span class="string">&#x27;timestamp&#x27;</span>: datetime.now().isoformat()</span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_conversation</span>(<span class="params">self, role: <span class="built_in">str</span>, content: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;记录对话历史&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.session_data[<span class="string">&#x27;conversation_history&#x27;</span>].append(&#123;</span><br><span class="line">            <span class="string">&#x27;role&#x27;</span>: role,</span><br><span class="line">            <span class="string">&#x27;content&#x27;</span>: content[:<span class="number">800</span>] + <span class="string">&quot;...&quot;</span> <span class="keyword">if</span> <span class="built_in">len</span>(content) &gt; <span class="number">800</span> <span class="keyword">else</span> content,</span><br><span class="line">            <span class="string">&#x27;timestamp&#x27;</span>: datetime.now().isoformat()</span><br><span class="line">        &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_enhanced_research_tools</span>(<span class="params">self, topic: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[FunctionTool]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;创建增强版研究工具（带日志记录）&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">enhanced_retrieve_urls</span>(<span class="params">urls: <span class="type">List</span>[<span class="built_in">str</span>], query: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">            result = <span class="variable language_">self</span>.toolkit.retrieve_information_from_urls(urls, query)</span><br><span class="line">            <span class="variable language_">self</span>.log_retrieval_result(urls, query, result)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">enhanced_search_topic</span>(<span class="params">query: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">            result = <span class="variable language_">self</span>.toolkit.search_web_for_topic(query, topic)</span><br><span class="line">            <span class="variable language_">self</span>.log_search_result(query, result)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">enhanced_build_kg</span>(<span class="params">text_input: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">            result = <span class="variable language_">self</span>.toolkit.build_knowledge_graph(text_input, topic)</span><br><span class="line">            <span class="variable language_">self</span>.log_knowledge_graph(text_input, topic, result)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            FunctionTool(enhanced_retrieve_urls),</span><br><span class="line">            FunctionTool(enhanced_search_topic),</span><br><span class="line">            FunctionTool(enhanced_build_kg),</span><br><span class="line">        ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_final_research_report</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;生成最终研究报告&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.model:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;❌ AI模型未初始化，无法生成最终报告&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(Fore.BLUE + <span class="string">&quot;📊 正在生成最终研究报告...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 计算统计数据</span></span><br><span class="line">        duration = <span class="string">&quot;未知&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.session_data[<span class="string">&#x27;start_time&#x27;</span>] <span class="keyword">and</span> <span class="variable language_">self</span>.session_data[<span class="string">&#x27;end_time&#x27;</span>]:</span><br><span class="line">            start = datetime.fromisoformat(<span class="variable language_">self</span>.session_data[<span class="string">&#x27;start_time&#x27;</span>])</span><br><span class="line">            end = datetime.fromisoformat(<span class="variable language_">self</span>.session_data[<span class="string">&#x27;end_time&#x27;</span>])</span><br><span class="line">            duration = <span class="built_in">str</span>(end - start)</span><br><span class="line">        </span><br><span class="line">        total_searches = <span class="built_in">len</span>(<span class="variable language_">self</span>.session_data[<span class="string">&#x27;search_results&#x27;</span>])</span><br><span class="line">        total_retrievals = <span class="built_in">len</span>(<span class="variable language_">self</span>.session_data[<span class="string">&#x27;retrieval_results&#x27;</span>])</span><br><span class="line">        total_kg = <span class="built_in">len</span>(<span class="variable language_">self</span>.session_data[<span class="string">&#x27;knowledge_graphs&#x27;</span>])</span><br><span class="line">        total_conversations = <span class="built_in">len</span>(<span class="variable language_">self</span>.session_data[<span class="string">&#x27;conversation_history&#x27;</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 收集关键信息</span></span><br><span class="line">        search_summary = <span class="string">&quot;\n&quot;</span>.join([<span class="string">f&quot;- <span class="subst">&#123;item[<span class="string">&#x27;query&#x27;</span>]&#125;</span>: <span class="subst">&#123;item[<span class="string">&#x27;results&#x27;</span>][:<span class="number">200</span>]&#125;</span>...&quot;</span> </span><br><span class="line">                                   <span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable language_">self</span>.session_data[<span class="string">&#x27;search_results&#x27;</span>][:<span class="number">5</span>]])</span><br><span class="line">        </span><br><span class="line">        retrieval_summary = <span class="string">&quot;\n&quot;</span>.join([<span class="string">f&quot;- <span class="subst">&#123;item[<span class="string">&#x27;query&#x27;</span>]&#125;</span>: <span class="subst">&#123;item[<span class="string">&#x27;results&#x27;</span>][:<span class="number">200</span>]&#125;</span>...&quot;</span> </span><br><span class="line">                                      <span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable language_">self</span>.session_data[<span class="string">&#x27;retrieval_results&#x27;</span>][:<span class="number">5</span>]])</span><br><span class="line">        </span><br><span class="line">        conversation_summary = <span class="string">&quot;\n&quot;</span>.join([<span class="string">f&quot;**<span class="subst">&#123;item[<span class="string">&#x27;role&#x27;</span>]&#125;</span>**: <span class="subst">&#123;item[<span class="string">&#x27;content&#x27;</span>][:<span class="number">300</span>]&#125;</span>...&quot;</span> </span><br><span class="line">                                         <span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable language_">self</span>.session_data[<span class="string">&#x27;conversation_history&#x27;</span>][:<span class="number">10</span>]])</span><br><span class="line">        </span><br><span class="line">        report_prompt = <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">基于以下研究系统的完整运行数据，生成一份详细的最终研究报告：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 研究基本信息：</span></span><br><span class="line"><span class="string">- 研究主题: <span class="subst">&#123;self.session_data[<span class="string">&#x27;topic&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">- 研究问题: <span class="subst">&#123;self.session_data[<span class="string">&#x27;research_question&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">- 研究时长: <span class="subst">&#123;duration&#125;</span></span></span><br><span class="line"><span class="string">- 开始时间: <span class="subst">&#123;self.session_data[<span class="string">&#x27;start_time&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">- 结束时间: <span class="subst">&#123;self.session_data[<span class="string">&#x27;end_time&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 系统运行统计：</span></span><br><span class="line"><span class="string">- 执行搜索次数: <span class="subst">&#123;total_searches&#125;</span></span></span><br><span class="line"><span class="string">- 执行检索次数: <span class="subst">&#123;total_retrievals&#125;</span></span></span><br><span class="line"><span class="string">- 生成知识图谱数量: <span class="subst">&#123;total_kg&#125;</span></span></span><br><span class="line"><span class="string">- 对话轮次: <span class="subst">&#123;total_conversations&#125;</span></span></span><br><span class="line"><span class="string">- 生成文件数量: <span class="subst">&#123;<span class="built_in">len</span>(self.session_data[<span class="string">&#x27;generated_files&#x27;</span>])&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 搜索结果摘要：</span></span><br><span class="line"><span class="string"><span class="subst">&#123;search_summary&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 检索结果摘要：</span></span><br><span class="line"><span class="string"><span class="subst">&#123;retrieval_summary&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 对话历史摘要：</span></span><br><span class="line"><span class="string"><span class="subst">&#123;conversation_summary&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 生成的文件：</span></span><br><span class="line"><span class="string"><span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(self.session_data[<span class="string">&#x27;generated_files&#x27;</span>])&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">请按以下结构生成最终研究报告：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># <span class="subst">&#123;self.session_data[<span class="string">&#x27;topic&#x27;</span>]&#125;</span> - 研究最终报告</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 1. 执行摘要</span></span><br><span class="line"><span class="string">- 研究目标和范围</span></span><br><span class="line"><span class="string">- 主要发现概述</span></span><br><span class="line"><span class="string">- 系统运行效果评估</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 2. 研究方法和过程</span></span><br><span class="line"><span class="string">- 数据收集方法</span></span><br><span class="line"><span class="string">- 检索和分析流程</span></span><br><span class="line"><span class="string">- 知识图谱构建过程</span></span><br><span class="line"><span class="string">- 技术工具使用情况</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 3. 详细研究结果</span></span><br><span class="line"><span class="string">- 核心发现和数据</span></span><br><span class="line"><span class="string">- 关键信息分析</span></span><br><span class="line"><span class="string">- 重要观点整理</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 4. 系统性能分析</span></span><br><span class="line"><span class="string">- RAG检索效果评估</span></span><br><span class="line"><span class="string">- 知识图谱构建质量</span></span><br><span class="line"><span class="string">- 对话系统表现</span></span><br><span class="line"><span class="string">- 数据处理效率</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 5. 结论和建议</span></span><br><span class="line"><span class="string">- 研究结论总结</span></span><br><span class="line"><span class="string">- 发现的问题和局限</span></span><br><span class="line"><span class="string">- 改进建议</span></span><br><span class="line"><span class="string">- 后续研究方向</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 6. 技术附录</span></span><br><span class="line"><span class="string">- 系统配置参数</span></span><br><span class="line"><span class="string">- 生成的文件清单</span></span><br><span class="line"><span class="string">- 数据来源统计</span></span><br><span class="line"><span class="string">- 运行日志摘要</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">请确保报告内容详实、分析深入、结论客观，重点回答研究问题。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 创建报告生成智能体</span></span><br><span class="line">            report_agent = ChatAgent(</span><br><span class="line">                system_message=BaseMessage.make_assistant_message(</span><br><span class="line">                    role_name=<span class="string">&quot;研究报告专家&quot;</span>,</span><br><span class="line">                    content=<span class="string">&quot;你是一个专业的研究分析师和技术系统评估专家，擅长生成详细的研究报告和系统评估报告。&quot;</span></span><br><span class="line">                ),</span><br><span class="line">                model=<span class="variable language_">self</span>.model</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            user_msg = BaseMessage.make_user_message(</span><br><span class="line">                role_name=<span class="string">&quot;报告请求者&quot;</span>, </span><br><span class="line">                content=report_prompt</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            response = report_agent.step(user_msg)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 保存最终报告</span></span><br><span class="line">            timestamp = datetime.now().strftime(<span class="string">&#x27;%Y%m%d_%H%M%S&#x27;</span>)</span><br><span class="line">            topic_safe = <span class="string">&quot;&quot;</span>.join(c <span class="keyword">for</span> c <span class="keyword">in</span> <span class="variable language_">self</span>.session_data[<span class="string">&#x27;topic&#x27;</span>] <span class="keyword">if</span> c.isalnum() <span class="keyword">or</span> c <span class="keyword">in</span> (<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;_&#x27;</span>)).rstrip()</span><br><span class="line">            topic_safe = topic_safe.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;_&#x27;</span>)[:<span class="number">50</span>]  <span class="comment"># 限制文件名长度</span></span><br><span class="line">            </span><br><span class="line">            report_filename = <span class="string">f&quot;final_research_report_<span class="subst">&#123;topic_safe&#125;</span>_<span class="subst">&#123;timestamp&#125;</span>.md&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(report_filename, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(response.msg.content)</span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">self</span>.session_data[<span class="string">&#x27;generated_files&#x27;</span>].append(report_filename)</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(Fore.GREEN + <span class="string">f&quot;✅ 最终报告已保存: <span class="subst">&#123;report_filename&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> response.msg.content</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            error_msg = <span class="string">f&quot;❌ 最终报告生成失败: <span class="subst">&#123;e&#125;</span>&quot;</span></span><br><span class="line">            <span class="built_in">print</span>(Fore.RED + error_msg)</span><br><span class="line">            <span class="keyword">return</span> error_msg</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_enhanced_interactive_research</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;运行增强版交互式研究（含最终报告）&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.model <span class="keyword">or</span> <span class="keyword">not</span> <span class="variable language_">self</span>.research_system:</span><br><span class="line">            <span class="built_in">print</span>(Fore.RED + <span class="string">&quot;❌ 系统未正确初始化，无法运行&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(Fore.CYAN + <span class="string">&quot;🚀 增强版通用AI研究系统（含最终报告）&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">70</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 重置会话数据</span></span><br><span class="line">                <span class="variable language_">self</span>.session_data.update(&#123;</span><br><span class="line">                    <span class="string">&#x27;start_time&#x27;</span>: datetime.now().isoformat(),</span><br><span class="line">                    <span class="string">&#x27;end_time&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">                    <span class="string">&#x27;topic&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;research_question&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;search_results&#x27;</span>: [],</span><br><span class="line">                    <span class="string">&#x27;retrieval_results&#x27;</span>: [],</span><br><span class="line">                    <span class="string">&#x27;knowledge_graphs&#x27;</span>: [],</span><br><span class="line">                    <span class="string">&#x27;conversation_history&#x27;</span>: [],</span><br><span class="line">                    <span class="string">&#x27;generated_files&#x27;</span>: [],</span><br><span class="line">                    <span class="string">&#x27;system_stats&#x27;</span>: &#123;&#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 获取用户输入</span></span><br><span class="line">                <span class="built_in">print</span>(Fore.YELLOW + <span class="string">&quot;\n请输入研究信息:&quot;</span>)</span><br><span class="line">                topic = <span class="built_in">input</span>(Fore.CYAN + <span class="string">&quot;研究主题: &quot;</span>).strip()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> topic:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line">                research_question = <span class="built_in">input</span>(Fore.CYAN + <span class="string">&quot;具体问题: &quot;</span>).strip()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> research_question:</span><br><span class="line">                    research_question = <span class="string">f&quot;关于<span class="subst">&#123;topic&#125;</span>的综合信息&quot;</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 记录研究信息</span></span><br><span class="line">                <span class="variable language_">self</span>.session_data[<span class="string">&#x27;topic&#x27;</span>] = topic</span><br><span class="line">                <span class="variable language_">self</span>.session_data[<span class="string">&#x27;research_question&#x27;</span>] = research_question</span><br><span class="line">                </span><br><span class="line">                <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;\n📋 开始研究:&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;   主题: <span class="subst">&#123;topic&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;   问题: <span class="subst">&#123;research_question&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">70</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 创建增强版研究工具和任务</span></span><br><span class="line">                tools = <span class="variable language_">self</span>.create_enhanced_research_tools(topic)</span><br><span class="line">                task_prompt = <span class="variable language_">self</span>.create_research_task(topic, research_question)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 创建角色扮演系统</span></span><br><span class="line">                role_play_session = RolePlaying(</span><br><span class="line">                    assistant_role_name=<span class="string">&quot;AI研究助理&quot;</span>,</span><br><span class="line">                    user_role_name=<span class="string">&quot;研究用户&quot;</span>,</span><br><span class="line">                    assistant_agent_kwargs=<span class="built_in">dict</span>(</span><br><span class="line">                        model=<span class="variable language_">self</span>.model,</span><br><span class="line">                        tools=tools,</span><br><span class="line">                    ),</span><br><span class="line">                    user_agent_kwargs=<span class="built_in">dict</span>(model=<span class="variable language_">self</span>.model),</span><br><span class="line">                    task_prompt=task_prompt,</span><br><span class="line">                    with_task_specify=<span class="literal">False</span>,</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 记录初始对话</span></span><br><span class="line">                <span class="variable language_">self</span>.log_conversation(<span class="string">&quot;系统&quot;</span>, <span class="string">f&quot;开始研究: <span class="subst">&#123;topic&#125;</span> - <span class="subst">&#123;research_question&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 执行研究</span></span><br><span class="line">                <span class="built_in">print</span>(Fore.GREEN + <span class="string">f&quot;🤖 AI助理已准备就绪&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;👤 开始研究对话...&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                input_msg = role_play_session.init_chat()</span><br><span class="line">                chat_turn_limit = <span class="number">8</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(chat_turn_limit):</span><br><span class="line">                    <span class="built_in">print</span>(Fore.MAGENTA + <span class="string">f&quot;\n--- 研究轮次 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span> ---&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        assistant_response, user_response = role_play_session.step(input_msg)</span><br><span class="line">                        </span><br><span class="line">                        <span class="comment"># 记录对话</span></span><br><span class="line">                        <span class="variable language_">self</span>.log_conversation(<span class="string">&quot;助理&quot;</span>, assistant_response.msg.content)</span><br><span class="line">                        <span class="variable language_">self</span>.log_conversation(<span class="string">&quot;用户&quot;</span>, user_response.msg.content)</span><br><span class="line">                        </span><br><span class="line">                        <span class="keyword">if</span> assistant_response.terminated <span class="keyword">or</span> user_response.terminated:</span><br><span class="line">                            <span class="built_in">print</span>(Fore.GREEN + <span class="string">&quot;✅ 研究任务完成&quot;</span>)</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                        </span><br><span class="line">                        <span class="comment"># 显示进度</span></span><br><span class="line">                        <span class="built_in">print</span>(Fore.CYAN + <span class="string">f&quot;🔄 助理: <span class="subst">&#123;assistant_response.msg.content[:<span class="number">200</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">                        <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;🔄 用户: <span class="subst">&#123;user_response.msg.content[:<span class="number">200</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">                        </span><br><span class="line">                        input_msg = assistant_response.msg</span><br><span class="line">                        time.sleep(<span class="number">1</span>)  <span class="comment"># 避免请求过快</span></span><br><span class="line">                        </span><br><span class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                        <span class="built_in">print</span>(Fore.RED + <span class="string">f&quot;研究过程出错: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 记录结束时间</span></span><br><span class="line">                <span class="variable language_">self</span>.session_data[<span class="string">&#x27;end_time&#x27;</span>] = datetime.now().isoformat()</span><br><span class="line">                </span><br><span class="line">                <span class="built_in">print</span>(Fore.GREEN + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">80</span>)</span><br><span class="line">                <span class="built_in">print</span>(Fore.GREEN + <span class="string">&quot;✅ 角色扮演研究阶段完成&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(Fore.GREEN + <span class="string">&quot;=&quot;</span>*<span class="number">80</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 生成最终报告</span></span><br><span class="line">                <span class="built_in">print</span>(Fore.CYAN + <span class="string">&quot;\n🎯 开始生成最终研究报告...&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">70</span>)</span><br><span class="line">                </span><br><span class="line">                final_report = <span class="variable language_">self</span>.generate_final_research_report()</span><br><span class="line">                </span><br><span class="line">                <span class="built_in">print</span>(Fore.MAGENTA + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">100</span>)</span><br><span class="line">                <span class="built_in">print</span>(Fore.MAGENTA + <span class="string">&quot;📊 最终研究报告预览&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(Fore.MAGENTA + <span class="string">&quot;=&quot;</span>*<span class="number">100</span>)</span><br><span class="line">                <span class="built_in">print</span>(final_report[:<span class="number">1000</span>] + <span class="string">&quot;...&quot;</span> <span class="keyword">if</span> <span class="built_in">len</span>(final_report) &gt; <span class="number">1000</span> <span class="keyword">else</span> final_report)</span><br><span class="line">                <span class="built_in">print</span>(Fore.MAGENTA + <span class="string">&quot;=&quot;</span>*<span class="number">100</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 显示生成的文件统计</span></span><br><span class="line">                <span class="built_in">print</span>(Fore.GREEN + <span class="string">f&quot;\n📁 本次研究共生成 <span class="subst">&#123;<span class="built_in">len</span>(self.session_data[<span class="string">&#x27;generated_files&#x27;</span>])&#125;</span> 个文件:&quot;</span>)</span><br><span class="line">                <span class="keyword">for</span> file <span class="keyword">in</span> <span class="variable language_">self</span>.session_data[<span class="string">&#x27;generated_files&#x27;</span>]:</span><br><span class="line">                    <span class="built_in">print</span>(Fore.GREEN + <span class="string">f&quot;   📄 <span class="subst">&#123;file&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 询问是否继续</span></span><br><span class="line">                <span class="built_in">print</span>(Fore.YELLOW + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">70</span>)</span><br><span class="line">                continue_research = <span class="built_in">input</span>(Fore.CYAN + <span class="string">&quot;是否继续新的研究? (y/n): &quot;</span>).strip().lower()</span><br><span class="line">                <span class="keyword">if</span> continue_research != <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                    </span><br><span class="line">            <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">                <span class="built_in">print</span>(Fore.YELLOW + <span class="string">&quot;\n用户中断研究&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(Fore.RED + <span class="string">f&quot;系统错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(Fore.GREEN + <span class="string">&quot;\n👋 感谢使用增强版通用AI研究系统！&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(Fore.CYAN + <span class="string">&quot;🎯 增强版通用AI研究系统启动（含最终报告）&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        enhanced_system = EnhancedInteractiveResearchSystem()</span><br><span class="line">        enhanced_system.run_enhanced_interactive_research()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(Fore.RED + <span class="string">f&quot;❌ 系统启动失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(Fore.YELLOW + <span class="string">&quot;💡 请检查配置和依赖项&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>



<p><strong>分支代码2</strong>：【RAG_WEB_TOPIC.py】</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">import</span> agentops</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span> Fore, init</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> camel.loaders <span class="keyword">import</span> Firecrawl, UnstructuredIO</span><br><span class="line"><span class="keyword">from</span> camel.retrievers <span class="keyword">import</span> AutoRetriever</span><br><span class="line"><span class="keyword">from</span> camel.toolkits <span class="keyword">import</span> FunctionTool, SearchToolkit</span><br><span class="line"><span class="keyword">from</span> camel.types <span class="keyword">import</span> ModelPlatformType, StorageType</span><br><span class="line"><span class="keyword">from</span> camel.embeddings <span class="keyword">import</span> SentenceTransformerEncoder</span><br><span class="line"><span class="keyword">from</span> camel.models <span class="keyword">import</span> ModelFactory</span><br><span class="line"><span class="keyword">from</span> camel.societies <span class="keyword">import</span> RolePlaying</span><br><span class="line"><span class="keyword">from</span> camel.utils <span class="keyword">import</span> print_text_animated</span><br><span class="line"><span class="keyword">from</span> camel.storages <span class="keyword">import</span> Neo4jGraph</span><br><span class="line"><span class="keyword">from</span> camel.agents <span class="keyword">import</span> KnowledgeGraphAgent</span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载环境变量</span></span><br><span class="line">load_dotenv()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化 colorama</span></span><br><span class="line">init(autoreset=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ResearchConfig</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;研究系统配置类&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># API配置 - 直接配置所有必要密钥</span></span><br><span class="line">    agentops_api_key: <span class="built_in">str</span> = <span class="string">&quot;3e6edf79-2c28-400f-8433-cf4fa764444d&quot;</span></span><br><span class="line">    firecrawl_api_key: <span class="built_in">str</span> = <span class="string">&quot;fc-58764a3cc0184450b220d2dd1ca687c2&quot;</span></span><br><span class="line">    modelscope_api_key: <span class="built_in">str</span> = <span class="string">&quot;64af0689-2660-4285-99ff-270e4c7416a3&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Neo4j配置</span></span><br><span class="line">    neo4j_url: <span class="built_in">str</span> = <span class="string">&quot;bolt://localhost:7687&quot;</span></span><br><span class="line">    neo4j_username: <span class="built_in">str</span> = <span class="string">&quot;neo4j&quot;</span></span><br><span class="line">    neo4j_password: <span class="built_in">str</span> = <span class="string">&quot;tyy20060315&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模型配置</span></span><br><span class="line">    model_platform: <span class="built_in">str</span> = <span class="string">&quot;openai_compatible&quot;</span></span><br><span class="line">    model_name: <span class="built_in">str</span> = <span class="string">&quot;Qwen/Qwen2.5-72B-Instruct&quot;</span></span><br><span class="line">    model_url: <span class="built_in">str</span> = <span class="string">&quot;https://api-inference.modelscope.cn/v1/&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 存储配置</span></span><br><span class="line">    vector_storage_path: <span class="built_in">str</span> = <span class="string">&quot;research_data&quot;</span></span><br><span class="line">    storage_type: <span class="built_in">str</span> = <span class="string">&quot;qdrant&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 搜索配置</span></span><br><span class="line">    max_search_results: <span class="built_in">int</span> = <span class="number">10</span></span><br><span class="line">    max_urls_to_process: <span class="built_in">int</span> = <span class="number">5</span></span><br><span class="line">    similarity_threshold: <span class="built_in">float</span> = <span class="number">0.3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConfigManager</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;配置管理器 - 安全地处理敏感信息&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config_file: <span class="built_in">str</span> = <span class="string">&quot;config.json&quot;</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.config_file = Path(config_file)</span><br><span class="line">        <span class="variable language_">self</span>.config = ResearchConfig()</span><br><span class="line">        <span class="variable language_">self</span>._load_config()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_load_config</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;从配置文件和环境变量加载配置&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 直接使用配置的API密钥，如果环境变量存在则优先使用环境变量</span></span><br><span class="line">        <span class="variable language_">self</span>.config.agentops_api_key = os.getenv(<span class="string">&quot;AGENTOPS_API_KEY&quot;</span>, <span class="variable language_">self</span>.config.agentops_api_key)</span><br><span class="line">        <span class="variable language_">self</span>.config.firecrawl_api_key = os.getenv(<span class="string">&quot;FIRECRAWL_API_KEY&quot;</span>, <span class="variable language_">self</span>.config.firecrawl_api_key)</span><br><span class="line">        <span class="variable language_">self</span>.config.modelscope_api_key = os.getenv(<span class="string">&quot;MODELSCOPE_SDK_TOKEN&quot;</span>, <span class="variable language_">self</span>.config.modelscope_api_key)</span><br><span class="line">        <span class="variable language_">self</span>.config.neo4j_password = os.getenv(<span class="string">&quot;NEO4J_PASSWORD&quot;</span>, <span class="variable language_">self</span>.config.neo4j_password)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 设置环境变量以供其他组件使用</span></span><br><span class="line">        os.environ[<span class="string">&quot;AGENTOPS_API_KEY&quot;</span>] = <span class="variable language_">self</span>.config.agentops_api_key</span><br><span class="line">        os.environ[<span class="string">&quot;FIRECRAWL_API_KEY&quot;</span>] = <span class="variable language_">self</span>.config.firecrawl_api_key</span><br><span class="line">        os.environ[<span class="string">&quot;MODELSCOPE_SDK_TOKEN&quot;</span>] = <span class="variable language_">self</span>.config.modelscope_api_key</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 从配置文件加载非敏感配置</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.config_file.exists():</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(<span class="variable language_">self</span>.config_file, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    file_config = json.load(f)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 更新非敏感配置</span></span><br><span class="line">                <span class="keyword">for</span> key, value <span class="keyword">in</span> file_config.items():</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> key.endswith(<span class="string">&#x27;_key&#x27;</span>) <span class="keyword">and</span> <span class="keyword">not</span> key.endswith(<span class="string">&#x27;_password&#x27;</span>):</span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">hasattr</span>(<span class="variable language_">self</span>.config, key):</span><br><span class="line">                            <span class="built_in">setattr</span>(<span class="variable language_">self</span>.config, key, value)</span><br><span class="line">                            </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logging.warning(<span class="string">f&quot;配置文件加载失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_sample_config</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;创建示例配置文件&quot;&quot;&quot;</span></span><br><span class="line">        sample_config = &#123;</span><br><span class="line">            <span class="string">&quot;neo4j_url&quot;</span>: <span class="string">&quot;bolt://localhost:7687&quot;</span>,</span><br><span class="line">            <span class="string">&quot;neo4j_username&quot;</span>: <span class="string">&quot;neo4j&quot;</span>,</span><br><span class="line">            <span class="string">&quot;model_name&quot;</span>: <span class="string">&quot;Qwen/Qwen2.5-72B-Instruct&quot;</span>,</span><br><span class="line">            <span class="string">&quot;model_url&quot;</span>: <span class="string">&quot;https://api-inference.modelscope.cn/v1/&quot;</span>,</span><br><span class="line">            <span class="string">&quot;vector_storage_path&quot;</span>: <span class="string">&quot;research_data&quot;</span>,</span><br><span class="line">            <span class="string">&quot;max_search_results&quot;</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="string">&quot;max_urls_to_process&quot;</span>: <span class="number">5</span>,</span><br><span class="line">            <span class="string">&quot;similarity_threshold&quot;</span>: <span class="number">0.3</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="variable language_">self</span>.config_file, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            json.dump(sample_config, f, indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(Fore.YELLOW + <span class="string">f&quot;已创建示例配置文件: <span class="subst">&#123;self.config_file&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display_config_status</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;显示配置状态&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(Fore.CYAN + <span class="string">&quot;\n🔧 系统配置状态:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># API密钥状态</span></span><br><span class="line">        <span class="built_in">print</span>(Fore.BLUE + <span class="string">&quot;📋 API密钥配置:&quot;</span>)</span><br><span class="line">        api_keys = [</span><br><span class="line">            (<span class="string">&quot;AgentOps&quot;</span>, <span class="variable language_">self</span>.config.agentops_api_key),</span><br><span class="line">            (<span class="string">&quot;Firecrawl&quot;</span>, <span class="variable language_">self</span>.config.firecrawl_api_key),</span><br><span class="line">            (<span class="string">&quot;ModelScope&quot;</span>, <span class="variable language_">self</span>.config.modelscope_api_key),</span><br><span class="line">        ]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> name, key <span class="keyword">in</span> api_keys:</span><br><span class="line">            <span class="keyword">if</span> key:</span><br><span class="line">                masked_key = key[:<span class="number">8</span>] + <span class="string">&quot;...&quot;</span> + key[-<span class="number">4</span>:] <span class="keyword">if</span> <span class="built_in">len</span>(key) &gt; <span class="number">12</span> <span class="keyword">else</span> <span class="string">&quot;***&quot;</span></span><br><span class="line">                <span class="built_in">print</span>(Fore.GREEN + <span class="string">f&quot;  ✅ <span class="subst">&#123;name&#125;</span>: <span class="subst">&#123;masked_key&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(Fore.RED + <span class="string">f&quot;  ❌ <span class="subst">&#123;name&#125;</span>: 未配置&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Neo4j配置状态</span></span><br><span class="line">        <span class="built_in">print</span>(Fore.BLUE + <span class="string">&quot;\n🗄️ Neo4j配置:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;  URL: <span class="subst">&#123;self.config.neo4j_url&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;  用户名: <span class="subst">&#123;self.config.neo4j_username&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.config.neo4j_password:</span><br><span class="line">            <span class="built_in">print</span>(Fore.GREEN + <span class="string">f&quot;  ✅ 密码: <span class="subst">&#123;<span class="string">&#x27;*&#x27;</span> * <span class="built_in">len</span>(self.config.neo4j_password)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(Fore.RED + <span class="string">f&quot;  ❌ 密码: 未配置&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_api_connections</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;测试API连接&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(Fore.CYAN + <span class="string">&quot;\n🔗 测试API连接:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">40</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 测试Firecrawl API</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.config.firecrawl_api_key:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">from</span> camel.loaders <span class="keyword">import</span> Firecrawl</span><br><span class="line">                firecrawl = Firecrawl()</span><br><span class="line">                <span class="built_in">print</span>(Fore.GREEN + <span class="string">&quot;✅ Firecrawl API: 连接正常&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(Fore.RED + <span class="string">f&quot;❌ Firecrawl API: <span class="subst">&#123;<span class="built_in">str</span>(e)[:<span class="number">50</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 测试ModelScope API</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.config.modelscope_api_key:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                model = ModelFactory.create(</span><br><span class="line">                    model_platform=ModelPlatformType.OPENAI_COMPATIBLE_MODEL,</span><br><span class="line">                    model_type=<span class="variable language_">self</span>.config.model_name,</span><br><span class="line">                    url=<span class="variable language_">self</span>.config.model_url,</span><br><span class="line">                    api_key=<span class="variable language_">self</span>.config.modelscope_api_key</span><br><span class="line">                )</span><br><span class="line">                <span class="built_in">print</span>(Fore.GREEN + <span class="string">&quot;✅ ModelScope API: 连接正常&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(Fore.RED + <span class="string">f&quot;❌ ModelScope API: <span class="subst">&#123;<span class="built_in">str</span>(e)[:<span class="number">50</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">40</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SearchEngine</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;统一的搜索引擎类&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config: ResearchConfig</span>):</span><br><span class="line">        <span class="variable language_">self</span>.config = config</span><br><span class="line">        <span class="variable language_">self</span>.search_toolkit = SearchToolkit()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">duckduckgo_lite_search</span>(<span class="params">self, query: <span class="built_in">str</span>, max_results: <span class="built_in">int</span> = <span class="literal">None</span></span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;使用DuckDuckGo Lite API进行搜索&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> max_results <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            max_results = <span class="variable language_">self</span>.config.max_search_results</span><br><span class="line">            </span><br><span class="line">        url = <span class="string">f&quot;https://lite.duckduckgo.com/lite/?q=<span class="subst">&#123;query.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;+&#x27;</span>)&#125;</span>&quot;</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = requests.get(url, headers=headers, timeout=<span class="number">10</span>)</span><br><span class="line">            resp.raise_for_status()</span><br><span class="line">            soup = BeautifulSoup(resp.text, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            results = []</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> soup.select(<span class="string">&quot;a[href*=&#x27;http&#x27;]&quot;</span>)[:max_results]:</span><br><span class="line">                href = link.get(<span class="string">&quot;href&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                text = link.get_text(strip=<span class="literal">True</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> href <span class="keyword">and</span> text <span class="keyword">and</span> <span class="built_in">len</span>(text) &gt; <span class="number">10</span>:</span><br><span class="line">                    results.append(&#123;</span><br><span class="line">                        <span class="string">&quot;title&quot;</span>: text[:<span class="number">100</span>],</span><br><span class="line">                        <span class="string">&quot;url&quot;</span>: href,</span><br><span class="line">                        <span class="string">&quot;snippet&quot;</span>: text[:<span class="number">200</span>]</span><br><span class="line">                    &#125;)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> results</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logging.error(<span class="string">f&quot;DuckDuckGo Lite搜索失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">search_web</span>(<span class="params">self, query: <span class="built_in">str</span>, topic: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;通用网络搜索功能&quot;&quot;&quot;</span></span><br><span class="line">        search_query = <span class="string">f&quot;<span class="subst">&#123;query&#125;</span> <span class="subst">&#123;topic&#125;</span>&quot;</span>.strip()</span><br><span class="line">        <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;🔍 网络搜索: <span class="subst">&#123;search_query&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 首先尝试DuckDuckGo Lite搜索</span></span><br><span class="line">            <span class="built_in">print</span>(Fore.CYAN + <span class="string">&quot;🔄 使用 DuckDuckGo Lite 搜索...&quot;</span>)</span><br><span class="line">            search_results = <span class="variable language_">self</span>.duckduckgo_lite_search(search_query)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> search_results:</span><br><span class="line">                formatted_results = <span class="string">f&quot;🔍 搜索查询: <span class="subst">&#123;search_query&#125;</span>\n\n&quot;</span></span><br><span class="line">                formatted_results += <span class="string">&quot;🌐 搜索结果:\n&quot;</span></span><br><span class="line">                formatted_results += <span class="string">&quot;=&quot;</span>*<span class="number">50</span> + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                </span><br><span class="line">                urls_found = []</span><br><span class="line">                <span class="keyword">for</span> i, result <span class="keyword">in</span> <span class="built_in">enumerate</span>(search_results, <span class="number">1</span>):</span><br><span class="line">                    title = result.get(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;无标题&#x27;</span>)</span><br><span class="line">                    url = result.get(<span class="string">&#x27;url&#x27;</span>, <span class="string">&#x27;无链接&#x27;</span>)</span><br><span class="line">                    snippet = result.get(<span class="string">&#x27;snippet&#x27;</span>, <span class="string">&#x27;无描述&#x27;</span>)</span><br><span class="line">                    </span><br><span class="line">                    formatted_results += <span class="string">f&quot;<span class="subst">&#123;i&#125;</span>. 📰 <span class="subst">&#123;title&#125;</span>\n&quot;</span></span><br><span class="line">                    formatted_results += <span class="string">f&quot;   📝 <span class="subst">&#123;snippet&#125;</span>\n&quot;</span></span><br><span class="line">                    formatted_results += <span class="string">f&quot;   🔗 <span class="subst">&#123;url&#125;</span>\n\n&quot;</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span> url != <span class="string">&#x27;无链接&#x27;</span>:</span><br><span class="line">                        urls_found.append(url)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> urls_found:</span><br><span class="line">                    formatted_results += <span class="string">&quot;\n📎 发现的相关URL:\n&quot;</span></span><br><span class="line">                    <span class="keyword">for</span> url <span class="keyword">in</span> urls_found[:<span class="variable language_">self</span>.config.max_urls_to_process]:</span><br><span class="line">                        formatted_results += <span class="string">f&quot;- <span class="subst">&#123;url&#125;</span>\n&quot;</span></span><br><span class="line">                </span><br><span class="line">                <span class="built_in">print</span>(Fore.GREEN + <span class="string">f&quot;✅ 搜索完成，找到 <span class="subst">&#123;<span class="built_in">len</span>(search_results)&#125;</span> 个结果&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> formatted_results</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">&quot;DuckDuckGo Lite 未返回结果&quot;</span>)</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(Fore.YELLOW + <span class="string">f&quot;⚠️ 主搜索方法失败: <span class="subst">&#123;<span class="built_in">str</span>(e)[:<span class="number">50</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 备用搜索方法</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="built_in">print</span>(Fore.BLUE + <span class="string">&quot;🔄 尝试备用搜索方法...&quot;</span>)</span><br><span class="line">                search_results = <span class="variable language_">self</span>.search_toolkit.search_duckduckgo(search_query)</span><br><span class="line">                </span><br><span class="line">                formatted_results = <span class="string">f&quot;🔍 搜索查询: <span class="subst">&#123;search_query&#125;</span>\n\n&quot;</span></span><br><span class="line">                formatted_results += <span class="string">&quot;🌐 搜索结果 (备用方法):\n&quot;</span></span><br><span class="line">                formatted_results += <span class="string">&quot;=&quot;</span>*<span class="number">50</span> + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">isinstance</span>(search_results, <span class="built_in">list</span>):</span><br><span class="line">                    <span class="keyword">for</span> i, result <span class="keyword">in</span> <span class="built_in">enumerate</span>(search_results[:<span class="variable language_">self</span>.config.max_search_results], <span class="number">1</span>):</span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">isinstance</span>(result, <span class="built_in">dict</span>):</span><br><span class="line">                            title = result.get(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;无标题&#x27;</span>)</span><br><span class="line">                            snippet = result.get(<span class="string">&#x27;snippet&#x27;</span>, <span class="string">&#x27;无描述&#x27;</span>)</span><br><span class="line">                            link = result.get(<span class="string">&#x27;link&#x27;</span>, <span class="string">&#x27;无链接&#x27;</span>)</span><br><span class="line">                            formatted_results += <span class="string">f&quot;<span class="subst">&#123;i&#125;</span>. <span class="subst">&#123;title&#125;</span>\n   <span class="subst">&#123;snippet&#125;</span>\n   链接: <span class="subst">&#123;link&#125;</span>\n\n&quot;</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            formatted_results += <span class="string">f&quot;<span class="subst">&#123;i&#125;</span>. <span class="subst">&#123;<span class="built_in">str</span>(result)[:<span class="number">200</span>]&#125;</span>...\n\n&quot;</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> formatted_results</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> backup_e:</span><br><span class="line">                error_msg = <span class="string">f&quot;所有搜索方法都失败了: <span class="subst">&#123;<span class="built_in">str</span>(backup_e)[:<span class="number">100</span>]&#125;</span>...&quot;</span></span><br><span class="line">                <span class="built_in">print</span>(Fore.RED + error_msg)</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;搜索查询: <span class="subst">&#123;search_query&#125;</span>\n\n搜索服务暂时不可用，请稍后重试。&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UniversalResearchSystem</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;通用研究系统&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config_manager: ConfigManager</span>):</span><br><span class="line">        <span class="variable language_">self</span>.config = config_manager.config</span><br><span class="line">        <span class="variable language_">self</span>._init_components()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_init_components</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;初始化系统组件&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 基础组件</span></span><br><span class="line">        <span class="variable language_">self</span>.firecrawl = Firecrawl()</span><br><span class="line">        <span class="variable language_">self</span>.auto_retriever = AutoRetriever(</span><br><span class="line">            vector_storage_local_path=<span class="variable language_">self</span>.config.vector_storage_path,</span><br><span class="line">            storage_type=StorageType.QDRANT,</span><br><span class="line">            embedding_model=SentenceTransformerEncoder(),</span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.search_engine = SearchEngine(<span class="variable language_">self</span>.config)</span><br><span class="line">        <span class="variable language_">self</span>.uio = UnstructuredIO()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 知识图谱组件</span></span><br><span class="line">        <span class="variable language_">self</span>.neo4j_graph = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.kg_agent = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>._init_knowledge_graph()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_init_knowledge_graph</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;初始化知识图谱组件&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.config.neo4j_password:</span><br><span class="line">            <span class="built_in">print</span>(Fore.YELLOW + <span class="string">&quot;⚠️ Neo4j密码未配置，将使用文本格式知识图谱&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(Fore.BLUE + <span class="string">&quot;🔗 尝试连接Neo4j数据库...&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">import</span> neo4j</span><br><span class="line">            driver = neo4j.GraphDatabase.driver(</span><br><span class="line">                <span class="variable language_">self</span>.config.neo4j_url,</span><br><span class="line">                auth=(<span class="variable language_">self</span>.config.neo4j_username, <span class="variable language_">self</span>.config.neo4j_password)</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 验证连接</span></span><br><span class="line">            <span class="keyword">with</span> driver.session() <span class="keyword">as</span> session:</span><br><span class="line">                result = session.run(<span class="string">&quot;RETURN 1 as test&quot;</span>)</span><br><span class="line">                test_value = result.single()[<span class="string">&quot;test&quot;</span>]</span><br><span class="line">                <span class="keyword">if</span> test_value == <span class="number">1</span>:</span><br><span class="line">                    <span class="built_in">print</span>(Fore.GREEN + <span class="string">&quot;✅ Neo4j连接测试成功&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            driver.close()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 初始化CAMEL的Neo4j组件</span></span><br><span class="line">            <span class="variable language_">self</span>.neo4j_graph = Neo4jGraph(</span><br><span class="line">                url=<span class="variable language_">self</span>.config.neo4j_url,</span><br><span class="line">                username=<span class="variable language_">self</span>.config.neo4j_username,</span><br><span class="line">                password=<span class="variable language_">self</span>.config.neo4j_password,</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 需要模型才能初始化KG Agent</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hasattr</span>(<span class="variable language_">self</span>, <span class="string">&#x27;model&#x27;</span>) <span class="keyword">and</span> <span class="variable language_">self</span>.model:</span><br><span class="line">                <span class="variable language_">self</span>.kg_agent = KnowledgeGraphAgent(model=<span class="variable language_">self</span>.model)</span><br><span class="line">                <span class="built_in">print</span>(Fore.GREEN + <span class="string">&quot;✅ 知识图谱组件初始化成功&quot;</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> ImportError:</span><br><span class="line">            <span class="built_in">print</span>(Fore.RED + <span class="string">&quot;❌ neo4j驱动未安装，请运行: pip install neo4j&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(Fore.RED + <span class="string">f&quot;❌ Neo4j连接失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(Fore.YELLOW + <span class="string">&quot;💡 将使用文本格式知识图谱&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ResearchToolkit</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;研究工具包&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, research_system: UniversalResearchSystem</span>):</span><br><span class="line">        <span class="variable language_">self</span>.system = research_system</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">retrieve_information_from_urls</span>(<span class="params">self, urls: <span class="type">List</span>[<span class="built_in">str</span>], query: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;从URL列表中检索相关信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;开始检索: <span class="subst">&#123;query&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;数据源: <span class="subst">&#123;<span class="built_in">len</span>(urls)&#125;</span> 个URL&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        aggregated_content = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 限制处理的URL数量</span></span><br><span class="line">        urls_to_process = urls[:<span class="variable language_">self</span>.system.config.max_urls_to_process]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i, url <span class="keyword">in</span> <span class="built_in">enumerate</span>(urls_to_process, <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="built_in">print</span>(Fore.CYAN + <span class="string">f&quot;抓取 <span class="subst">&#123;i&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(urls_to_process)&#125;</span>: <span class="subst">&#123;url&#125;</span>&quot;</span>)</span><br><span class="line">                scraped_content = <span class="variable language_">self</span>.system.firecrawl.scrape(url)</span><br><span class="line">                aggregated_content += scraped_content[<span class="string">&quot;markdown&quot;</span>] + <span class="string">&quot;\n\n&quot;</span></span><br><span class="line">                <span class="built_in">print</span>(Fore.GREEN + <span class="string">f&quot;成功抓取 <span class="subst">&#123;<span class="built_in">len</span>(scraped_content[<span class="string">&#x27;markdown&#x27;</span>])&#125;</span> 字符&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(Fore.RED + <span class="string">f&quot;抓取失败: <span class="subst">&#123;<span class="built_in">str</span>(e)[:<span class="number">100</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> aggregated_content.strip():</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;所有 URL 都抓取失败，无法继续处理&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            retrieved_info = <span class="variable language_">self</span>.system.auto_retriever.run_vector_retriever(</span><br><span class="line">                query=query,</span><br><span class="line">                contents=aggregated_content,</span><br><span class="line">                top_k=<span class="number">5</span>,</span><br><span class="line">                similarity_threshold=<span class="variable language_">self</span>.system.config.similarity_threshold,</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            result = <span class="string">f&quot;检索查询: <span class="subst">&#123;retrieved_info[<span class="string">&#x27;Original Query&#x27;</span>]&#125;</span>\n\n&quot;</span></span><br><span class="line">            result += <span class="string">&quot;相关信息:\n&quot;</span></span><br><span class="line">            <span class="keyword">for</span> i, context <span class="keyword">in</span> <span class="built_in">enumerate</span>(retrieved_info[<span class="string">&#x27;Retrieved Context&#x27;</span>], <span class="number">1</span>):</span><br><span class="line">                result += <span class="string">f&quot;<span class="subst">&#123;i&#125;</span>. <span class="subst">&#123;context[:<span class="number">300</span>]&#125;</span>...\n\n&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;检索失败: <span class="subst">&#123;e&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">search_web_for_topic</span>(<span class="params">self, query: <span class="built_in">str</span>, topic: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;根据主题搜索网络信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.system.search_engine.search_web(query, topic)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build_knowledge_graph</span>(<span class="params">self, text_input: <span class="built_in">str</span>, topic: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;构建知识图谱&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.system.neo4j_graph <span class="keyword">or</span> <span class="keyword">not</span> <span class="variable language_">self</span>.system.kg_agent:</span><br><span class="line">            <span class="built_in">print</span>(Fore.YELLOW + <span class="string">&quot;Neo4j未配置，创建文本格式知识图谱...&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            kg_result = <span class="string">f&quot;知识图谱（文本格式） - 主题: <span class="subst">&#123;topic&#125;</span>\n&quot;</span></span><br><span class="line">            kg_result += <span class="string">&quot;=&quot;</span>*<span class="number">50</span> + <span class="string">&quot;\n\n&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 简单的实体提取逻辑</span></span><br><span class="line">            lines = text_input.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            entities = []</span><br><span class="line">            relationships = []</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(line.strip()) &gt; <span class="number">10</span>:  <span class="comment"># 过滤短行</span></span><br><span class="line">                    words = line.split()</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">len</span>(words) &gt; <span class="number">3</span>:  <span class="comment"># 寻找可能的实体</span></span><br><span class="line">                        <span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">                            <span class="keyword">if</span> <span class="built_in">len</span>(word) &gt; <span class="number">4</span> <span class="keyword">and</span> word.isalpha():</span><br><span class="line">                                entities.append(word)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 去重并限制数量</span></span><br><span class="line">            entities = <span class="built_in">list</span>(<span class="built_in">set</span>(entities))[:<span class="number">10</span>]</span><br><span class="line">            </span><br><span class="line">            kg_result += <span class="string">&quot;主要实体:\n&quot;</span></span><br><span class="line">            <span class="keyword">for</span> entity <span class="keyword">in</span> entities:</span><br><span class="line">                kg_result += <span class="string">f&quot;- <span class="subst">&#123;entity&#125;</span>\n&quot;</span></span><br><span class="line">            </span><br><span class="line">            kg_result += <span class="string">f&quot;\n关系网络:\n&quot;</span></span><br><span class="line">            kg_result += <span class="string">f&quot;- 主题: <span class="subst">&#123;topic&#125;</span>\n&quot;</span></span><br><span class="line">            kg_result += <span class="string">f&quot;- 相关实体数量: <span class="subst">&#123;<span class="built_in">len</span>(entities)&#125;</span>\n&quot;</span></span><br><span class="line">            kg_result += <span class="string">f&quot;- 文本长度: <span class="subst">&#123;<span class="built_in">len</span>(text_input)&#125;</span> 字符\n&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> kg_result</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;开始构建知识图谱 - 主题: <span class="subst">&#123;topic&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            element_example = <span class="variable language_">self</span>.system.uio.create_element_from_text(</span><br><span class="line">                text=text_input,</span><br><span class="line">                element_id=<span class="string">f&quot;research_<span class="subst">&#123;topic&#125;</span>_<span class="subst">&#123;<span class="built_in">int</span>(time.time())&#125;</span>&quot;</span></span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            graph_elements = <span class="variable language_">self</span>.system.kg_agent.run(element_example, parse_graph_elements=<span class="literal">True</span>)</span><br><span class="line">            <span class="variable language_">self</span>.system.neo4j_graph.add_graph_elements(graph_elements=[graph_elements])</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(Fore.GREEN + <span class="string">&quot;知识图谱构建完成&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;知识图谱构建成功 - 主题: <span class="subst">&#123;topic&#125;</span>\n提取了图形元素: <span class="subst">&#123;<span class="built_in">str</span>(graph_elements)[:<span class="number">200</span>]&#125;</span>...&quot;</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            error_msg = <span class="string">f&quot;知识图谱构建失败: <span class="subst">&#123;e&#125;</span>&quot;</span></span><br><span class="line">            <span class="built_in">print</span>(Fore.RED + error_msg)</span><br><span class="line">            <span class="keyword">return</span> error_msg</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InteractiveResearchSystem</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;交互式研究系统&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.config_manager = ConfigManager()</span><br><span class="line">        <span class="variable language_">self</span>.model = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.research_system = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.toolkit = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>._init_system()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_init_system</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;初始化系统&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 显示配置状态</span></span><br><span class="line">        <span class="variable language_">self</span>.config_manager.display_config_status()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 测试API连接</span></span><br><span class="line">        <span class="variable language_">self</span>.config_manager.test_api_connections()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查配置</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>._check_config():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 初始化模型</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>._init_model():</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 初始化研究系统</span></span><br><span class="line">        <span class="variable language_">self</span>.research_system = UniversalResearchSystem(<span class="variable language_">self</span>.config_manager)</span><br><span class="line">        <span class="variable language_">self</span>.research_system.model = <span class="variable language_">self</span>.model  <span class="comment"># 为知识图谱组件提供模型</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 重新初始化知识图谱（现在有模型了）</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.research_system.neo4j_graph <span class="keyword">and</span> <span class="keyword">not</span> <span class="variable language_">self</span>.research_system.kg_agent:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="variable language_">self</span>.research_system.kg_agent = KnowledgeGraphAgent(model=<span class="variable language_">self</span>.model)</span><br><span class="line">                <span class="built_in">print</span>(Fore.GREEN + <span class="string">&quot;✅ 知识图谱代理初始化成功&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(Fore.YELLOW + <span class="string">f&quot;知识图谱代理初始化失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.toolkit = ResearchToolkit(<span class="variable language_">self</span>.research_system)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 初始化AgentOps</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.config_manager.config.agentops_api_key:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                agentops.init(</span><br><span class="line">                    api_key=<span class="variable language_">self</span>.config_manager.config.agentops_api_key,</span><br><span class="line">                    default_tags=[<span class="string">&quot;Universal Research&quot;</span>, <span class="string">&quot;Interactive&quot;</span>]</span><br><span class="line">                )</span><br><span class="line">                <span class="built_in">print</span>(Fore.GREEN + <span class="string">&quot;✅ AgentOps初始化成功&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(Fore.YELLOW + <span class="string">f&quot;AgentOps初始化失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_check_config</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;检查配置完整性&quot;&quot;&quot;</span></span><br><span class="line">        missing_configs = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.config_manager.config.modelscope_api_key:</span><br><span class="line">            missing_configs.append(<span class="string">&quot;MODELSCOPE_SDK_TOKEN&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> missing_configs:</span><br><span class="line">            <span class="built_in">print</span>(Fore.RED + <span class="string">&quot;❌ 缺少必要的环境变量配置:&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> config <span class="keyword">in</span> missing_configs:</span><br><span class="line">                <span class="built_in">print</span>(Fore.RED + <span class="string">f&quot;   <span class="subst">&#123;config&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.config_manager.config_file.exists():</span><br><span class="line">                <span class="built_in">print</span>(Fore.BLUE + <span class="string">&quot;\n📝 创建示例配置文件...&quot;</span>)</span><br><span class="line">                <span class="variable language_">self</span>.config_manager.create_sample_config()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_init_model</span>(<span class="params">self</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;初始化模型&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="variable language_">self</span>.model = ModelFactory.create(</span><br><span class="line">                model_platform=ModelPlatformType.OPENAI_COMPATIBLE_MODEL,</span><br><span class="line">                model_type=<span class="variable language_">self</span>.config_manager.config.model_name,</span><br><span class="line">                url=<span class="variable language_">self</span>.config_manager.config.model_url,</span><br><span class="line">                api_key=<span class="variable language_">self</span>.config_manager.config.modelscope_api_key</span><br><span class="line">            )</span><br><span class="line">            <span class="built_in">print</span>(Fore.GREEN + <span class="string">f&quot;✅ 模型初始化成功: <span class="subst">&#123;self.config_manager.config.model_name&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(Fore.RED + <span class="string">f&quot;❌ 模型初始化失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_research_tools</span>(<span class="params">self, topic: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[FunctionTool]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;为特定主题创建研究工具&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">retrieve_urls_for_topic</span>(<span class="params">urls: <span class="type">List</span>[<span class="built_in">str</span>], query: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.toolkit.retrieve_information_from_urls(urls, query)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">search_topic_info</span>(<span class="params">query: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.toolkit.search_web_for_topic(query, topic)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">build_topic_knowledge_graph</span>(<span class="params">text_input: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.toolkit.build_knowledge_graph(text_input, topic)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            FunctionTool(retrieve_urls_for_topic),</span><br><span class="line">            FunctionTool(search_topic_info),</span><br><span class="line">            FunctionTool(build_topic_knowledge_graph),</span><br><span class="line">        ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_research_task</span>(<span class="params">self, topic: <span class="built_in">str</span>, research_question: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;创建研究任务提示&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">对&quot;<span class="subst">&#123;topic&#125;</span>&quot;进行全面研究，专门回答以下问题：&quot;<span class="subst">&#123;research_question&#125;</span>&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">请按照以下步骤进行系统性研究：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. **信息搜索阶段**</span></span><br><span class="line"><span class="string">   - 使用搜索工具获取与&quot;<span class="subst">&#123;topic&#125;</span>&quot;和&quot;<span class="subst">&#123;research_question&#125;</span>&quot;相关的URL和基础信息</span></span><br><span class="line"><span class="string">   - 识别最相关和权威的信息源</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. **深度检索阶段**</span></span><br><span class="line"><span class="string">   - 使用检索工具从找到的URL中获取详细内容</span></span><br><span class="line"><span class="string">   - 重点关注能够回答研究问题的信息</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. **分析整理阶段**</span></span><br><span class="line"><span class="string">   - 系统分析所有收集到的信息</span></span><br><span class="line"><span class="string">   - 识别关键事实、数据和观点</span></span><br><span class="line"><span class="string">   - 评估信息的可靠性和相关性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4. **报告撰写阶段**</span></span><br><span class="line"><span class="string">   - 撰写一份全面的研究报告</span></span><br><span class="line"><span class="string">   - 确保报告直接回答了研究问题</span></span><br><span class="line"><span class="string">   - 提供具体的事实支撑和数据引用</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">5. **知识图谱构建阶段**</span></span><br><span class="line"><span class="string">   - 使用知识图谱工具为报告内容构建结构化的知识图谱</span></span><br><span class="line"><span class="string">   - 展示关键概念之间的关系</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">研究重点：</span></span><br><span class="line"><span class="string">- 主题: <span class="subst">&#123;topic&#125;</span></span></span><br><span class="line"><span class="string">- 核心问题: <span class="subst">&#123;research_question&#125;</span></span></span><br><span class="line"><span class="string">- 确保信息的准确性和时效性</span></span><br><span class="line"><span class="string">- 提供多角度的分析视角</span></span><br><span class="line"><span class="string">- 包含具体的案例和数据支撑</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">请系统性地完成上述研究任务，提供高质量的研究成果。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_interactive_research</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;运行交互式研究&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.model <span class="keyword">or</span> <span class="keyword">not</span> <span class="variable language_">self</span>.research_system:</span><br><span class="line">            <span class="built_in">print</span>(Fore.RED + <span class="string">&quot;❌ 系统未正确初始化，无法运行&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(Fore.CYAN + <span class="string">&quot;🚀 通用AI研究系统&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 获取用户输入</span></span><br><span class="line">                <span class="built_in">print</span>(Fore.YELLOW + <span class="string">&quot;\n请输入研究信息:&quot;</span>)</span><br><span class="line">                topic = <span class="built_in">input</span>(Fore.CYAN + <span class="string">&quot;研究主题: &quot;</span>).strip()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> topic:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line">                research_question = <span class="built_in">input</span>(Fore.CYAN + <span class="string">&quot;具体问题: &quot;</span>).strip()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> research_question:</span><br><span class="line">                    research_question = <span class="string">f&quot;关于<span class="subst">&#123;topic&#125;</span>的综合信息&quot;</span></span><br><span class="line">                </span><br><span class="line">                <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;\n📋 开始研究:&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;   主题: <span class="subst">&#123;topic&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;   问题: <span class="subst">&#123;research_question&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 创建研究工具和任务</span></span><br><span class="line">                tools = <span class="variable language_">self</span>.create_research_tools(topic)</span><br><span class="line">                task_prompt = <span class="variable language_">self</span>.create_research_task(topic, research_question)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 创建角色扮演系统</span></span><br><span class="line">                role_play_session = RolePlaying(</span><br><span class="line">                    assistant_role_name=<span class="string">&quot;AI研究助理&quot;</span>,</span><br><span class="line">                    user_role_name=<span class="string">&quot;研究用户&quot;</span>,</span><br><span class="line">                    assistant_agent_kwargs=<span class="built_in">dict</span>(</span><br><span class="line">                        model=<span class="variable language_">self</span>.model,</span><br><span class="line">                        tools=tools,</span><br><span class="line">                    ),</span><br><span class="line">                    user_agent_kwargs=<span class="built_in">dict</span>(model=<span class="variable language_">self</span>.model),</span><br><span class="line">                    task_prompt=task_prompt,</span><br><span class="line">                    with_task_specify=<span class="literal">False</span>,</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 执行研究</span></span><br><span class="line">                <span class="built_in">print</span>(Fore.GREEN + <span class="string">f&quot;🤖 AI助理: <span class="subst">&#123;role_play_session.assistant_sys_msg.content[:<span class="number">100</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;👤 用户: <span class="subst">&#123;role_play_session.user_sys_msg.content[:<span class="number">100</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                input_msg = role_play_session.init_chat()</span><br><span class="line">                chat_turn_limit = <span class="number">8</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(chat_turn_limit):</span><br><span class="line">                    <span class="built_in">print</span>(Fore.MAGENTA + <span class="string">f&quot;\n--- 研究轮次 <span class="subst">&#123;i+<span class="number">1</span>&#125;</span> ---&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        assistant_response, user_response = role_play_session.step(input_msg)</span><br><span class="line">                        </span><br><span class="line">                        <span class="keyword">if</span> assistant_response.terminated <span class="keyword">or</span> user_response.terminated:</span><br><span class="line">                            <span class="built_in">print</span>(Fore.GREEN + <span class="string">&quot;✅ 研究任务完成&quot;</span>)</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                        </span><br><span class="line">                        <span class="comment"># 显示进度</span></span><br><span class="line">                        <span class="built_in">print</span>(Fore.CYAN + <span class="string">f&quot;🔄 助理: <span class="subst">&#123;assistant_response.msg.content[:<span class="number">200</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">                        <span class="built_in">print</span>(Fore.BLUE + <span class="string">f&quot;🔄 用户: <span class="subst">&#123;user_response.msg.content[:<span class="number">200</span>]&#125;</span>...&quot;</span>)</span><br><span class="line">                        </span><br><span class="line">                        input_msg = assistant_response.msg</span><br><span class="line">                        time.sleep(<span class="number">1</span>)  <span class="comment"># 避免请求过快</span></span><br><span class="line">                        </span><br><span class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                        <span class="built_in">print</span>(Fore.RED + <span class="string">f&quot;研究过程出错: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 询问是否继续</span></span><br><span class="line">                <span class="built_in">print</span>(Fore.YELLOW + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">60</span>)</span><br><span class="line">                continue_research = <span class="built_in">input</span>(Fore.CYAN + <span class="string">&quot;是否继续新的研究? (y/n): &quot;</span>).strip().lower()</span><br><span class="line">                <span class="keyword">if</span> continue_research != <span class="string">&#x27;y&#x27;</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                    </span><br><span class="line">            <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">                <span class="built_in">print</span>(Fore.YELLOW + <span class="string">&quot;\n用户中断研究&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(Fore.RED + <span class="string">f&quot;系统错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(Fore.GREEN + <span class="string">&quot;\n👋 感谢使用通用AI研究系统！&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;主函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(Fore.CYAN + <span class="string">&quot;🎯 通用AI研究系统启动&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        research_system = InteractiveResearchSystem()</span><br><span class="line">        research_system.run_interactive_research()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(Fore.RED + <span class="string">f&quot;❌ 系统启动失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(Fore.YELLOW + <span class="string">&quot;💡 请检查配置和依赖项&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h5 id="我们运行一下整个系统，分别测试一下各个检索功能的差异："><a href="#我们运行一下整个系统，分别测试一下各个检索功能的差异：" class="headerlink" title="我们运行一下整个系统，分别测试一下各个检索功能的差异："></a>我们运行一下整个系统，分别测试一下各个检索功能的差异：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">PS G:\Python-Camel-project&gt; &amp; D:/Download/Python/py-3.11.9/python.exe g:/Python-Camel-project/Multimodal_RAG/Interactive_Multimodal_RAG.py</span><br><span class="line">W0725 14:45:52.142000 34656 site-packages\torch\distributed\elastic\multiprocessing\redirects.py:29] NOTE: Redirects are currently not supported in Windows or MacOs.   </span><br><span class="line">Web research system available</span><br><span class="line">初始化交互式多模态RAG系统...</span><br><span class="line">Initializing Simple RAG System with CAMEL...</span><br><span class="line">CAMEL LLM initialized: Qwen/Qwen2.5-72B-Instruct</span><br><span class="line">API key: 64af0689-2...16a3</span><br><span class="line">√ Embedding model loaded: intfloat/e5-large-v2</span><br><span class="line">√ Simple vector retriever initialized</span><br><span class="line">√ Simple RAG System initialized successfully!</span><br><span class="line">√ 集成CAMEL的RAG系统初始化成功</span><br><span class="line"></span><br><span class="line">🔧 系统配置状态:</span><br><span class="line">==================================================</span><br><span class="line">📋 API密钥配置:</span><br><span class="line">  ✅ AgentOps: 3e6edf79...444d</span><br><span class="line">  ✅ Firecrawl: fc-58764...87c2</span><br><span class="line">  ✅ ModelScope: 64af0689...16a3</span><br><span class="line"></span><br><span class="line">🗄️ Neo4j配置:</span><br><span class="line">  URL: bolt://localhost:7687</span><br><span class="line">  用户名: neo4j</span><br><span class="line">  ✅ 密码: ***********</span><br><span class="line">==================================================</span><br><span class="line"></span><br><span class="line">🔗 测试API连接:</span><br><span class="line">========================================</span><br><span class="line">✅ Firecrawl API: 连接正常</span><br><span class="line">✅ ModelScope API: 连接正常</span><br><span class="line">========================================</span><br><span class="line">✅ 模型初始化成功: Qwen/Qwen2.5-72B-Instruct</span><br><span class="line">D:\Download\Python\py-3.11.9\Lib\site-packages\camel\toolkits\function_tool.py:533: UserWarning: Parameter description is missing for the function &#x27;search_linkup&#x27;. The parameter definition is &#123;&#x27;enum&#x27;: [&#x27;searchResults&#x27;, &#x27;sourcedAnswer&#x27;, &#x27;structured&#x27;], &#x27;type&#x27;: [&#x27;string&#x27;, &#x27;null&#x27;]&#125;. This may affect the quality of tool calling.</span><br><span class="line">  warnings.warn(</span><br><span class="line">D:\Download\Python\py-3.11.9\Lib\site-packages\camel\toolkits\function_tool.py:533: UserWarning: Parameter description is missing for the function &#x27;search_alibaba_tongxiao&#x27;. The parameter definition is &#123;&#x27;enum&#x27;: [&#x27;OneDay&#x27;, &#x27;OneWeek&#x27;, &#x27;OneMonth&#x27;, &#x27;OneYear&#x27;, &#x27;NoLimit&#x27;], &#x27;type&#x27;: [&#x27;string&#x27;, &#x27;null&#x27;]&#125;. This may affect the quality of tool calling.</span><br><span class="line">  warnings.warn(</span><br><span class="line">D:\Download\Python\py-3.11.9\Lib\site-packages\camel\toolkits\function_tool.py:533: UserWarning: Parameter description is missing for the function &#x27;search_alibaba_tongxiao&#x27;. The parameter definition is &#123;&#x27;anyOf&#x27;: [&#123;&#x27;enum&#x27;: [&#x27;finance&#x27;, &#x27;law&#x27;, &#x27;medical&#x27;, &#x27;internet&#x27;, &#x27;tax&#x27;, &#x27;news_province&#x27;, &#x27;news_center&#x27;], &#x27;type&#x27;: &#x27;string&#x27;&#125;, &#123;&#x27;type&#x27;: &#x27;null&#x27;&#125;], &#x27;type&#x27;: [&#x27;null&#x27;]&#125;. This may affect the quality of tool calling.</span><br><span class="line">  warnings.warn(</span><br><span class="line">🔗 尝试连接Neo4j数据库...</span><br><span class="line">✅ Neo4j连接测试成功</span><br><span class="line">✅ 知识图谱代理初始化成功</span><br><span class="line">🖇 AgentOps:  WARNING: agentops is out of date. Please update with the command: &#x27;pip install --upgrade agentops&#x27;</span><br><span class="line">🖇 AgentOps: Session Replay: https://app.agentops.ai/drilldown?session_id=1daa3df4-89ba-4a7a-a1f9-991c342edb8b</span><br><span class="line">✅ AgentOps初始化成功</span><br><span class="line">√ 网页研究系统初始化成功</span><br><span class="line"></span><br><span class="line">交互式多模态RAG系统</span><br><span class="line">============================================================</span><br><span class="line">功能特性:</span><br><span class="line">- 支持在线/本地PDF加载</span><br><span class="line">- 三种检索模式</span><br><span class="line">- 网页爬取集成</span><br><span class="line">- 多模态内容处理</span><br><span class="line">============================================================</span><br><span class="line"></span><br><span class="line">PDF知识库设置</span><br><span class="line">==================================================</span><br><span class="line">1. 在线PDF (输入URL)</span><br><span class="line">2. 本地PDF (输入文件路径)</span><br><span class="line">3. 使用默认示例PDF</span><br><span class="line"></span><br><span class="line">请选择PDF来源 (1-3): 2</span><br><span class="line">请输入PDF文件路径: G:\Program for work\Other\CamelAgent.pdf  </span><br><span class="line">状态查询： 正在加载本地PDF: G:\Program for work\Other\CamelAgent.pdf</span><br><span class="line">Loading PDF from: G:\Program for work\Other\CamelAgent.pdf</span><br><span class="line">√ PDF loaded successfully</span><br><span class="line">Computing embeddings for 1839 documents...</span><br><span class="line">Added 1839 documents to retriever</span><br><span class="line">√ Knowledge base setup complete: 1839 elements</span><br><span class="line"> Content: 1839 text, 0 images, 0 tables</span><br><span class="line">√ PDF知识库加载成功！</span><br><span class="line"></span><br><span class="line">当前知识库: 本地PDF: G:\Program for work\Other\CamelAgent.pdf</span><br><span class="line">🔧 可用检索方法: Vector, Enhanced</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">查询选项</span><br><span class="line">============================================================</span><br></pre></td></tr></table></figure>
<h5 id="我们可以看到系统启动成功，本地PDF文件也成功加载了，现在我们先进行快速检索的演示"><a href="#我们可以看到系统启动成功，本地PDF文件也成功加载了，现在我们先进行快速检索的演示" class="headerlink" title="我们可以看到系统启动成功，本地PDF文件也成功加载了，现在我们先进行快速检索的演示:"></a>我们可以看到系统启动成功，本地PDF文件也成功加载了，现在我们先进行快速检索的演示:</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">请输入您的问题 (输入 &#x27;quit&#x27; 退出, &#x27;reload&#x27; 重新加载PDF): camel agent框架具备有什么特性？可以调用哪些工具？</span><br><span class="line"></span><br><span class="line">选择检索模式:</span><br><span class="line">1. 快速检索 (基础向量检索)</span><br><span class="line">2. 深度检索 (重写+HyDE+RRF)</span><br><span class="line">3. 主题检索 (PDF+网页爬取)</span><br><span class="line">请选择模式 (1-3): 1</span><br><span class="line"></span><br><span class="line">执行查询: camel agent框架具备有什么特性？可以调用哪些工具？</span><br><span class="line">检索模式: 快速检索</span><br><span class="line"></span><br><span class="line">执行快速检索...</span><br><span class="line">========================================</span><br><span class="line">正在进行向量检索...</span><br><span class="line">Retrieved 3 documents</span><br><span class="line">√ 检索到 3 个相关文档</span><br><span class="line">文档 1 (相似度: 0.910):</span><br><span class="line">   结语 恭喜您！在阅读到这里时，您已经掌握了 CAMEL-AI 应用开发框架的基础知识，并能够利 用 Agent 实例在您的代码逻辑中执行复杂的任务。此外，您还可以尝试将 Agent 实例整合 到更复杂的工作流中，或实现 Agent 实例之间的协同工作。</span><br><span class="line"></span><br><span class="line">文档 2 (相似度: 0.910):</span><br><span class="line">   为什么选择 CAMEL Multi-Agent？ 选择 CAMEL Multi-Agent 框架，你将获得以下优势：   </span><br><span class="line"></span><br><span class="line">文档 3 (相似度: 0.902):</span><br><span class="line">   Model 是 Agent 的大脑，负责处理所有输入和输出数据。通过有效调用不同的模型，智能  体可以根据任务需求执行文本分析、图像识别和复杂推理等操作。CAMEL 提供了一系列标      </span><br><span class="line"></span><br><span class="line">正在生成答案...</span><br><span class="line">Generating response with CAMEL model...</span><br><span class="line">CAMEL generation failed, using fallback: &#x27;BaseMessage&#x27; object has no attribute &#x27;get&#x27;...</span><br><span class="line">API调用 1/3...</span><br><span class="line">√ API调用成功</span><br><span class="line">√ 快速检索完成</span><br><span class="line"></span><br><span class="line">==================== 快速检索结果 ====================</span><br><span class="line">原结始查询: camel agent框架具备有什么特性？可以调用哪些工具？</span><br><span class="line">检索方法: Quick Vector Retrieval</span><br><span class="line"></span><br><span class="line">检索到的文档 (共3个):</span><br><span class="line"></span><br><span class="line">文档 1:</span><br><span class="line">相关度分数: 0.9104779362678528</span><br><span class="line">内容预览: 结语 恭喜您！在阅读到这里时，您已经掌握了 CAMEL-AI 应用开发框架的基础知识 ，并能够利 用 Agent 实例在您的代码逻辑中执行复杂的任务。此外，您还可以尝试将 Agent  实例整合 到更复杂的工作流中，或实现 Agent 实例之间的协同工作。</span><br><span class="line"></span><br><span class="line">文档 2:</span><br><span class="line">相关度分数: 0.9104548692703247</span><br><span class="line">内容预览: 为什么选择 CAMEL Multi-Agent？ 选择 CAMEL Multi-Agent 框架，你将获得以下优势：</span><br><span class="line"></span><br><span class="line">文档 3:</span><br><span class="line">相关度分数: 0.9016962051391602</span><br><span class="line">内容预览: Model 是 Agent 的大脑，负责处理所有输入和输出数据。通过有效调用不同的模型 ，智能 体可以根据任务需求执行文本分析、图像识别和复杂推理等操作。CAMEL 提供了一系列 标</span><br><span class="line"></span><br><span class="line">💡 生成答案:</span><br><span class="line">CAMEL Agent框架的特性包括：</span><br><span class="line"></span><br><span class="line">1. **多智能体协作**：支持多个Agent实例之间的协同工作，以完成更复杂的任务。</span><br><span class="line">2. **灵活的任务处理能力**：通过Model（智能体的大脑）处理所有输入和输出数据，能够根据任务需求执行多种操作。</span><br><span class="line"></span><br><span class="line">可以调用的工具包括：</span><br><span class="line"></span><br><span class="line">- **文本分析**：处理和理解文本数据。</span><br><span class="line">- **图像识别**：识别和分析图像内容。</span><br><span class="line">- **复杂推理**：进行复杂的逻辑推理和决策。</span><br><span class="line">============================================================</span><br><span class="line"></span><br><span class="line">询问：是否保存结果到文件？(y/n): n</span><br><span class="line"></span><br><span class="line">是否继续查询？(y/n): y</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">查询选项</span><br><span class="line">============================================================</span><br></pre></td></tr></table></figure>
<h5 id="接着我们测试深度检索的效果"><a href="#接着我们测试深度检索的效果" class="headerlink" title="接着我们测试深度检索的效果"></a>接着我们测试深度检索的效果</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line">请输入您的问题 (输入 &#x27;quit&#x27; 退出, &#x27;reload&#x27; 重新加载PDF): camel agent框架具备有什么特性？可以调用哪些工具？</span><br><span class="line"></span><br><span class="line">选择检索模式:</span><br><span class="line">1. 快速检索 (基础向量检索)</span><br><span class="line">2. 深度检索 (重写+HyDE+RRF)</span><br><span class="line">3. 主题检索 (PDF+网页爬取)</span><br><span class="line">请选择模式 (1-3): 2</span><br><span class="line"></span><br><span class="line">执行查询: camel agent框架具备有什么特性？可以调用哪些工具？</span><br><span class="line">检索模式: 深度检索</span><br><span class="line"></span><br><span class="line">执行深度检索...</span><br><span class="line">============================================================</span><br><span class="line">开始执行深度RAG查询</span><br><span class="line">============================================================</span><br><span class="line"></span><br><span class="line">步骤1: 查询重写</span><br><span class="line">------------------------------</span><br><span class="line">原始查询: camel agent框架具备有什么特性？可以调用哪些工具？</span><br><span class="line">Generating response with CAMEL model...</span><br><span class="line">CAMEL generation failed, using fallback: &#x27;BaseMessage&#x27; object has no attribute &#x27;get&#x27;...</span><br><span class="line">API调用 1/3...</span><br><span class="line">√ API调用成功</span><br><span class="line">Query rewritten: camel agent框架具备有什么特性？可以调用哪些工具？ -&gt; Camel Agent框 架的具体特性和可调用的工具有哪些？...</span><br><span class="line">重写查询: Camel Agent框架的具体特性和可调用的工具有哪些？</span><br><span class="line"></span><br><span class="line">步骤2: 文档检索</span><br><span class="line">------------------------------</span><br><span class="line">使用HyDE+RRF组合方法进行检索...</span><br><span class="line">使用RRF算法进行混合检索（HyDE增强向量检索）...</span><br><span class="line">执行HyDE增强向量检索...</span><br><span class="line">Generating response with CAMEL model...</span><br><span class="line">CAMEL generation failed, using fallback: &#x27;BaseMessage&#x27; object has no attribute &#x27;get&#x27;...</span><br><span class="line">API调用 1/3...</span><br><span class="line">√ API调用成功</span><br><span class="line">📝 HyDE document generated: 633 characters</span><br><span class="line">生成的假设文档:</span><br><span class="line">在分布式计算领域，Camel Agent框架因其灵活性和强大的扩展性而受到广泛关注。该框架设计 用于支持复杂环境下的任务调度与资源管理，尤其适用于异构系统中。Camel Agent框架的核心 特性包括但不限于：</span><br><span class="line"></span><br><span class="line">1. **模块化架构**：Camel Agent采用高度模块化的架构设计，允许开发者根据具体需求灵活选择和组合不同的组件。这种设计不仅简化了开发流程，还极大地提高了系统的可维护性和可扩展性。</span><br><span class="line"></span><br><span class="line">2. **丰富的插件支持**：框架内置了多种插件，涵盖了从数据处理到通信协议转换等多个方面 。例如，提供了RESTful API、AMQP (Advanced Message Queuing Protocol) 等多种消息传递机制的支持，以及对JSON、XML等数据格式的解析能力。此外，Camel Agent还支持自定义插件的开发，以满足特定应用场景的需求。</span><br><span class="line"></span><br><span class="line">3. **强大的路由与转换功能**：利用Apache Camel的核心优势，Camel Agent能够实现复杂的消息路由和转换逻辑。通过定义EIPs (Enterprise Integration Patterns)，可以轻松构建高效的数据流处理管道，支持同步/异步调用、错误处理及重试机制等高级特性。</span><br><span class="line"></span><br><span class="line">4. **动态配置与热更新**：Camel Agent支持运行时动态调整配置参数，无需重启服务即可生效，极大提升了运维效率。同时，它也具备热部署能力，允许在不停机的情况下更新应用逻辑或添加新功能</span><br><span class="line">Retrieved 5 documents</span><br><span class="line">✓ HyDE向量检索完成，获得 5 个结果</span><br><span class="line">Retrieved 0 documents</span><br><span class="line">✓ 图像检索完成，获得 0 个结果</span><br><span class="line">Retrieved 0 documents</span><br><span class="line">✓ 表格检索完成，获得 0 个结果</span><br><span class="line">执行BM25检索（使用原始查询）...</span><br><span class="line">Retrieved 5 documents</span><br><span class="line">✓ BM25检索成功，获得 5 个结果</span><br><span class="line">使用RRF算法融合检索结果...</span><br><span class="line">RRF融合完成，共处理 10 个唯一文档，返回前 5 个结果</span><br><span class="line">HyDE+RRF检索完成，返回 10 个文档</span><br><span class="line">文档 1 (RRF分数: 0.9160):</span><br><span class="line">结语 恭喜您！在阅读到这里时，您已经掌握了 CAMEL-AI 应用开发框架的基础知识，并能够利 用 Agent 实例在您的代码逻辑中执行复杂的任务。此外，您还可以尝试将 Agent 实例整合 到 更复杂的工作流中，或实现 Agent 实例之间的协同工作。</span><br><span class="line"></span><br><span class="line">文档 2 (RRF分数: 0.9094):</span><br><span class="line">想象一下，如果没有统一的语言和行为规范，来自不同公司或者基于不同技术背景开发的 AI Agent 就很难顺畅地合作。这会限制 AI Agent 网络的扩展，最终也会限制它们解决更复杂 现实 问题的能力。这种情况有点像互联网早期，各个计算机系统互不兼容，连接非常受限， 导致整 个网络发展缓慢。 一个统一的通信协议不仅仅能解决眼前的互操作问题，更有可能 催生出一个由无数智能体连接而成的巨大网络。在这个网络...</span><br><span class="line"></span><br><span class="line">文档 3 (RRF分数: 0.9136):</span><br><span class="line">评审者 Agent 的 评审标准。如果</span><br><span class="line"></span><br><span class="line">文档 4 (RRF分数: 0.9050):</span><br><span class="line">除了能把工具包转换成 MCP 服务器外，CAMEL 框架还支持一个更强大的功能：把整个 CAMEL 代理（Agent）本身也作为 MCP 服务器发布出去。这意味着，一个你精心配置好的 CAMEL 代理—— 它可能拥有特定的 AI 模型、独特的系统指令（system message），甚至内 置了一些其他的工 具——现在可以作为一个独立的服务运行。然后，任何支持 MCP 协议的 客户端（比如像 Anth...</span><br><span class="line"></span><br><span class="line">文档 5 (RRF分数: 0.9120):</span><br><span class="line">Model 是 Agent 的大脑，负责处理所有输入和输出数据。通过有效调用不同的模型，智能 体可以根据任务需求执行文本分析、图像识别和复杂推理等操作。CAMEL 提供了一系列标</span><br><span class="line"></span><br><span class="line">步骤3: 答案生成</span><br><span class="line">------------------------------</span><br><span class="line"></span><br><span class="line">正在生成最终答案...</span><br><span class="line">Generating response with CAMEL model...</span><br><span class="line">CAMEL generation failed, using fallback: &#x27;BaseMessage&#x27; object has no attribute &#x27;get&#x27;...</span><br><span class="line">API调用 1/3...</span><br><span class="line">√ API调用成功</span><br><span class="line">√ 答案生成成功</span><br><span class="line">最终答案:</span><br><span class="line">### CAMEL Agent框架的特性及可调用工具</span><br><span class="line"></span><br><span class="line">#### 特性</span><br><span class="line"></span><br><span class="line">1. **标准化协议支持**：</span><br><span class="line">   - CAMEL Agent框架支持多种标准化协议，特别是模型上下文协议（MCP）、Agent间协议（A2A）和Agent网络协议（ANP）。这些协议确保了不同AI Agent之间的互操作性和高效协作（文档 内容：“这些协议为解决 AI Agent 在理解上下文、使用工具和相互协作方面的难题提供了有效 的思路。”）。</span><br><span class="line"></span><br><span class="line">2. **高度可扩展性**：</span><br><span class="line">   - CAMEL框架允许开发者将自定义的工具和服务转换成MCP服务，使得这些工具和服务可以被 其他支持MCP协议的客户端识别和使用（文档内容：“除了能把工具包转换成 MCP 服务器外，CAMEL 框架还支持一个更强大的功能：把整个 CAMEL 代理（Agent）本身也作为 MCP 服务器发布出去。”）。</span><br><span class="line"></span><br><span class="line">3. **复杂的多代理交互**：</span><br><span class="line">   - CAMEL框架内置了多代理角色扮演（RolePlaying）模块和“工作组”（Workforce）模块，这些模块可以实现多个代理之间的协同工作，形成复杂的交互场景（文档内容：“其内部一些更复 杂的模块，比如用于实现多代理角色扮演（RolePlaying）的模块，或者用于组织多个代理协同 工作的‘工作组’（Workforce）模块，也计划或者正在被实现为 MCP 服务器。”）。</span><br><span class="line"></span><br><span class="line">4. **代码即提示（Code-as-Prompt）**：</span><br><span class="line">   - CAMEL框架强调编写既清晰易懂又可被AI代理准确理解的代码，这一设计理念有助于提高集成的质量和稳定性（文档内容：“CAMEL 框架中有一个核心的设计哲学叫做‘代码即提示’（Code-as-Prompt）。它强调编写既清晰易懂（对人类开发者而言）又能被 AI 代理准确理解的代码。”）。</span><br><span class="line"></span><br><span class="line">#### 可调用的工具</span><br><span class="line"></span><br><span class="line">1. **文本分析工具**：</span><br><span class="line">   - CAMEL Agent框架支持调用文本分析工具，这些工具可以帮助Agent执行文本分类、情感分 析、关键词提取等任务（文档内容：“通过有效调用不同的模型，智能体可以根据任务需求执行 文本分析、图像识别和复杂推理等操作。”）。</span><br><span class="line"></span><br><span class="line">2. **图像识别工具**：</span><br><span class="line">   - 框架内的Agent可以调用图像识别工具，用于图像分类、目标检测、图像生成等任务。    </span><br><span class="line"></span><br><span class="line">3. **复杂推理工具**：</span><br><span class="line">   - 支持调用复杂推理工具，这些工具可以帮助Agent解决需要多步推理的问题，例如决策树、逻辑推理等。</span><br><span class="line"></span><br><span class="line">4. **自定义工具和服务**：</span><br><span class="line">   - 开发者可以将自己开发的工具和服务转换成MCP服务，这些服务可以被其他支持MCP协议的 客户端调用，从而实现更广泛的应用（文档内容：“这意味着，一个你精心配置好的 CAMEL 代理——它可能拥有特定的 AI 模型、独特的系统指令（system message），甚至内置了一些其他的工具——现在可以作为一个独立的服务运行。”）。</span><br><span class="line"></span><br><span class="line">通过上述特性和工具的支持，CAMEL Agent框架不仅能够实现单一Agent的强大功能，还能促进不同Agent之间的协同工作，形成一个高效的AI生态系统。</span><br><span class="line"></span><br><span class="line">==================== 深度检索结果 ====================</span><br><span class="line">原结始查询: camel agent框架具备有什么特性？可以调用哪些工具？</span><br><span class="line">重写查询: Camel Agent框架的具体特性和可调用的工具有哪些？</span><br><span class="line">检索方法: Vector+Rewriting+HyDE+Image+Table+RRF</span><br><span class="line"></span><br><span class="line">检索到的文档 (共5个):</span><br><span class="line"></span><br><span class="line">文档 1:</span><br><span class="line">相关度分数: 0.01639344262295082</span><br><span class="line">内容预览: 结语 恭喜您！在阅读到这里时，您已经掌握了 CAMEL-AI 应用开发框架的基础知识 ，并能够利 用 Agent 实例在您的代码逻辑中执行复杂的任务。此外，您还可以尝试将 Agent  实例整合 到更复杂的工作流中，或实现 Agent 实例之间的协同工作。</span><br><span class="line"></span><br><span class="line">文档 2:</span><br><span class="line">相关度分数: 0.01639344262295082</span><br><span class="line">内容预览: 想象一下，如果没有统一的语言和行为规范，来自不同公司或者基于不同技术背景开发的 AI Agent 就很难顺畅地合作。这会限制 AI Agent 网络的扩展，最终也会限制它们解决更复杂 现实问题的能力。这种情况有点像互联网早期，各个计算机系统互不兼容，连接非常受限 ， 导致整个网络发展缓慢。 一个统一的通信协议不仅仅能解决眼前的互操作问题，更有可能  催生出一个由无数智能体连接而成的巨大网络。在这个网络...</span><br><span class="line"></span><br><span class="line">文档 3:</span><br><span class="line">相关度分数: 0.016129032258064516</span><br><span class="line">内容预览: 评审者 Agent 的 评审标准。如果</span><br><span class="line"></span><br><span class="line">文档 4:</span><br><span class="line">相关度分数: 0.016129032258064516</span><br><span class="line">内容预览: 除了能把工具包转换成 MCP 服务器外，CAMEL 框架还支持一个更强大的功能：把整 个 CAMEL 代理（Agent）本身也作为 MCP 服务器发布出去。这意味着，一个你精心配置好的 CAMEL 代理——它可能拥有特定的 AI 模型、独特的系统指令（system message），甚至内 置了一 些其他的工具——现在可以作为一个独立的服务运行。然后，任何支持 MCP 协议的 客户端（比如像 Anth...</span><br><span class="line"></span><br><span class="line">文档 5:</span><br><span class="line">相关度分数: 0.015873015873015872</span><br><span class="line">内容预览: Model 是 Agent 的大脑，负责处理所有输入和输出数据。通过有效调用不同的模型 ，智能 体可以根据任务需求执行文本分析、图像识别和复杂推理等操作。CAMEL 提供了一系列 标</span><br><span class="line"></span><br><span class="line">💡 生成答案:</span><br><span class="line">### CAMEL Agent框架的特性及可调用工具</span><br><span class="line"></span><br><span class="line">#### 特性</span><br><span class="line"></span><br><span class="line">1. **标准化协议支持**：</span><br><span class="line">   - CAMEL Agent框架支持多种标准化协议，特别是模型上下文协议（MCP）、Agent间协议（A2A）和Agent网络协议（ANP）。这些协议确保了不同AI Agent之间的互操作性和高效协作（文档 内容：“这些协议为解决 AI Agent 在理解上下文、使用工具和相互协作方面的难题提供了有效 的思路。”）。</span><br><span class="line"></span><br><span class="line">2. **高度可扩展性**：</span><br><span class="line">   - CAMEL框架允许开发者将自定义的工具和服务转换成MCP服务，使得这些工具和服务可以被 其他支持MCP协议的客户端识别和使用（文档内容：“除了能把工具包转换成 MCP 服务器外，CAMEL 框架还支持一个更强大的功能：把整个 CAMEL 代理（Agent）本身也作为 MCP 服务器发布出去。”）。</span><br><span class="line"></span><br><span class="line">3. **复杂的多代理交互**：</span><br><span class="line">   - CAMEL框架内置了多代理角色扮演（RolePlaying）模块和“工作组”（Workforce）模块，这些模块可以实现多个代理之间的协同工作，形成复杂的交互场景（文档内容：“其内部一些更复 杂的模块，比如用于实现多代理角色扮演（RolePlaying）的模块，或者用于组织多个代理协同 工作的‘工作组’（Workforce）模块，也计划或者正在被实现为 MCP 服务器。”）。</span><br><span class="line"></span><br><span class="line">4. **代码即提示（Code-as-Prompt）**：</span><br><span class="line">   - CAMEL框架强调编写既清晰易懂又可被AI代理准确理解的代码，这一设计理念有助于提高集成的质量和稳定性（文档内容：“CAMEL 框架中有一个核心的设计哲学叫做‘代码即提示’（Code-as-Prompt）。它强调编写既清晰易懂（对人类开发者而言）又能被 AI 代理准确理解的代码。”）。</span><br><span class="line"></span><br><span class="line">#### 可调用的工具</span><br><span class="line"></span><br><span class="line">1. **文本分析工具**：</span><br><span class="line">   - CAMEL Agent框架支持调用文本分析工具，这些工具可以帮助Agent执行文本分类、情感分 析、关键词提取等任务（文档内容：“通过有效调用不同的模型，智能体可以根据任务需求执行 文本分析、图像识别和复杂推理等操作。”）。</span><br><span class="line"></span><br><span class="line">2. **图像识别工具**：</span><br><span class="line">   - 框架内的Agent可以调用图像识别工具，用于图像分类、目标检测、图像生成等任务。    </span><br><span class="line"></span><br><span class="line">3. **复杂推理工具**：</span><br><span class="line">   - 支持调用复杂推理工具，这些工具可以帮助Agent解决需要多步推理的问题，例如决策树、逻辑推理等。</span><br><span class="line"></span><br><span class="line">4. **自定义工具和服务**：</span><br><span class="line">   - 开发者可以将自己开发的工具和服务转换成MCP服务，这些服务可以被其他支持MCP协议的 客户端调用，从而实现更广泛的应用（文档内容：“这意味着，一个你精心配置好的 CAMEL 代理——它可能拥有特定的 AI 模型、独特的系统指令（system message），甚至内置了一些其他的工具——现在可以作为一个独立的服务运行。”）。</span><br><span class="line"></span><br><span class="line">通过上述特性和工具的支持，CAMEL Agent框架不仅能够实现单一Agent的强大功能，还能促进不同Agent之间的协同工作，形成一个高效的AI生态系统。</span><br><span class="line">============================================================</span><br><span class="line"></span><br><span class="line">询问：是否保存结果到文件？(y/n): n</span><br><span class="line"></span><br><span class="line">是否继续查询？(y/n): y</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">查询选项</span><br><span class="line">============================================================</span><br></pre></td></tr></table></figure>
<h5 id="最后我们来测试一下主题检索："><a href="#最后我们来测试一下主题检索：" class="headerlink" title="最后我们来测试一下主题检索："></a>最后我们来测试一下主题检索：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">请输入您的问题 (输入 &#x27;quit&#x27; 退出, &#x27;reload&#x27; 重新加载PDF): camel agent框架具备有什么特性？可以调用哪些工具？</span><br><span class="line"></span><br><span class="line">选择检索模式:</span><br><span class="line">1. 快速检索 (基础向量检索)</span><br><span class="line">2. 深度检索 (重写+HyDE+RRF)</span><br><span class="line">3. 主题检索 (PDF+网页爬取)</span><br><span class="line">请选择模式 (1-3): 3</span><br><span class="line"></span><br><span class="line">执行查询: camel agent框架具备有什么特性？可以调用哪些工具？</span><br><span class="line">检索模式: 主题检索</span><br><span class="line"></span><br><span class="line">执行网页检索...</span><br><span class="line">========================================</span><br><span class="line">正在进行网页研究...</span><br><span class="line">🔍 网络搜索: camel agent框架具备有什么特性？可以调用哪些工具？</span><br><span class="line">🔄 使用 DuckDuckGo Lite 搜索...</span><br><span class="line">✅ 搜索完成，找到 10 个结果</span><br><span class="line">√ 网页搜索完成</span><br><span class="line">正在检索PDF文档...</span><br><span class="line">Retrieved 3 documents</span><br><span class="line">√ 检索到 3 个PDF文档</span><br><span class="line">正在生成综合答案...</span><br><span class="line">Generating response with CAMEL model...</span><br><span class="line">CAMEL generation failed, using fallback: &#x27;BaseMessage&#x27; object has no attribute &#x27;get&#x27;...</span><br><span class="line">API调用 1/3...</span><br><span class="line">√ API调用成功</span><br><span class="line">主题检索完成</span><br><span class="line"></span><br><span class="line">==================== 深度检索结果 ====================</span><br><span class="line">原结始查询: camel agent框架具备有什么特性？可以调用哪些工具？</span><br><span class="line">检索方法: PDF+Web Topic Retrieval</span><br><span class="line">💡 生成答案:</span><br><span class="line">**CAMEL Agent框架的特性及其可调用的工具**</span><br><span class="line"></span><br><span class="line">### 特性</span><br><span class="line"></span><br><span class="line">1. **多智能体系统支持**：CAMEL Agent框架支持创建和管理多个智能体，这些智能体可以在同一个系统中协同工作，共同完成复杂的任务。每个智能体都可以根据其角色和任务进行配置，从而实现高度的灵活性和适应性。</span><br><span class="line"></span><br><span class="line">2. **模块化设计**：框架采用模块化设计，使得开发者可以轻松地添加或移除功能模块，如不 同的感知模块、决策模块等，以适应不同应用场景的需求。</span><br><span class="line"></span><br><span class="line">3. **强大的模型支持**：CAMEL Agent框架中的每个Agent都有一个“大脑”，即Model，它负责处理所有输入和输出的数据。通过调用不同的模型，智能体能够执行文本分析、图像识别、复杂推理等多种任务。</span><br><span class="line"></span><br><span class="line">4. **高效的任务调度与管理**：该框架提供了高效的任务调度机制，确保多个Agent之间可以有效地分配和执行任务，即使在资源有限的情况下也能保持良好的性能。</span><br><span class="line"></span><br><span class="line">5. **易于集成第三方服务**：CAMEL Agent框架设计时考虑到了与其他服务和技术栈的兼容性，允许开发者轻松集成外部API和服务，如云存储、数据库、消息队列等，进一步扩展应用的功能 。</span><br><span class="line"></span><br><span class="line">### 可调用的工具</span><br><span class="line"></span><br><span class="line">1. **自然语言处理（NLP）工具**：包括但不限于文本分类、情感分析、实体识别等功能，帮助智能体更好地理解和生成人类语言。</span><br><span class="line"></span><br><span class="line">2. **计算机视觉（CV）工具**：如图像分类、目标检测、人脸识别等，使智能体能够在视觉任 务中发挥重要作用。</span><br><span class="line"></span><br><span class="line">3. **机器学习/深度学习框架**：如TensorFlow、PyTorch等，为智能体提供了强大的算法支持 ，使其能够学习和改进自己的行为模式。</span><br><span class="line"></span><br><span class="line">4. **数据存储与处理工具**：例如MongoDB、MySQL等数据库管理系统，以及Hadoop、Spark等大数据处理平台，用于管理和分析大量数据。</span><br><span class="line"></span><br><span class="line">5. **通信协议与工具**：包括RESTful API、WebSocket等，确保智能体之间以及智能体与外部 世界之间的高效通信。</span><br><span class="line"></span><br><span class="line">6. **任务调度与管理工具**：如Celery、RabbitMQ等，帮助实现任务的异步处理和分布式计算 ，提高系统的响应速度和处理能力。</span><br><span class="line"></span><br><span class="line">综上所述，CAMEL Agent框架不仅具备强大的多智能体系统支持和模块化设计，还能够调用多种 先进的工具和技术，使其成为构建复杂智能应用的理想选择。</span><br><span class="line">============================================================</span><br><span class="line"></span><br><span class="line">询问：是否保存结果到文件？(y/n): n</span><br><span class="line"></span><br><span class="line">是否继续查询？(y/n): y</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">查询选项</span><br><span class="line">============================================================</span><br><span class="line">请输入您的问题 (输入 &#x27;quit&#x27; 退出, &#x27;reload&#x27; 重新加载PDF):</span><br></pre></td></tr></table></figure>
<h5 id="基于以上运行结果，我们来总结一下功能实现效果"><a href="#基于以上运行结果，我们来总结一下功能实现效果" class="headerlink" title="基于以上运行结果，我们来总结一下功能实现效果"></a><strong>基于以上运行结果，我们来总结一下功能实现效果</strong></h5><p>我们可以看到，该交互式多模态RAG系统在功能实现和交互设计上表现良好，成功支持PDF知识库加载、三种检索模式和答案生成，答案质量随模式增强而提升。然而，CAMEL框架的稳定性问题、多模态支持的未充分利用、网页研究的模拟性以及性能和界面局限影响了整体效果。通过解决CAMEL兼容性、增强多模态和网页功能、优化性能和用户体验，系统可进一步提升实用性和适应稳定性，适用于更广泛的应用场景。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br></pre></td><td class="code"><pre><span class="line"> G:\Python-Camel-project\Interactive_Multi_RAG&gt; &amp; D:/Download/Python/py-3.11.9/python.exe g:/Python-Camel-project/Interactive_Multi_RAG/Enhanced_Interactive_Multimodal_RAG.py</span><br><span class="line">W0725 16:44:30.290000 32324 site-packages\torch\distributed\elastic\multiprocessing\redirects.py:29] NOTE: Redirects are currently not supported in Windows or MacOs.   </span><br><span class="line">✓ 使用Rich增强界面</span><br><span class="line">╭────────────────────────────────── 🎯 系统启动 ───────────────────────────────────╮</span><br><span class="line">│                                                                                  │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│  🤖 交互式多模态RAG系统 v2.0                                                     │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│  ✨ 新功能特性:                                                                  │</span><br><span class="line">│  • 🔧 增强的CAMEL框架集成和稳定性改进                                            │</span><br><span class="line">│  • 🖼️ 改进的多模态支持 (图像OCR + 表格提取)                                       </span><br><span class="line">│</span><br><span class="line">│  • 🌐 真实网页研究和内容分析                                                     │</span><br><span class="line">│  • ⚡ 性能监控和优化                                                             │</span><br><span class="line">│  • 🎨 增强的用户界面体验                                                         │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│  🚀 支持的检索模式:                                                              │</span><br><span class="line">│  • 快速检索: 基础向量检索                                                        │</span><br><span class="line">│  • 深度检索: 查询重写 + HyDE + RRF融合                                           │</span><br><span class="line">│  • 主题检索: PDF + 网页内容综合分析                                              │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│                                                                                  │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">🚀 正在初始化增强RAG系统...</span><br><span class="line">性能监控器初始化 (详细监控: 开启)</span><br><span class="line">🚀 初始化增强RAG系统...</span><br><span class="line">正在初始化CAMEL模型...</span><br><span class="line">CAMEL模型测试失败: &#x27;BaseMessage&#x27; object has no attribute &#x27;get&#x27;...</span><br><span class="line">⚠ CAMEL模型初始化成功但测试失败，将使用直接API调用</span><br><span class="line">✅ 嵌入模型加载成功</span><br><span class="line">✅ 增强向量检索器初始化完成</span><br><span class="line">✅ 增强文档管理器初始化完成</span><br><span class="line">📁 缓存目录: document_cache</span><br><span class="line">📋 支持格式: [&#x27;.pdf&#x27;, &#x27;.docx&#x27;, &#x27;.doc&#x27;, &#x27;.txt&#x27;, &#x27;.md&#x27;, &#x27;.csv&#x27;, &#x27;.xlsx&#x27;, &#x27;.xls&#x27;, &#x27;.pptx&#x27;, &#x27;.ppt&#x27;, &#x27;.json&#x27;, &#x27;.xml&#x27;, &#x27;.html&#x27;, &#x27;.rtf&#x27;]</span><br><span class="line">多模态处理器初始化:</span><br><span class="line">  图像OCR: ✓</span><br><span class="line">  表格处理: ✓</span><br><span class="line">  PyMuPDF: ✓</span><br><span class="line">网页研究系统初始化:</span><br><span class="line">  BeautifulSoup4: ✓</span><br><span class="line">  DuckDuckGo搜索: ✓</span><br><span class="line">✅ 增强RAG系统初始化完成!</span><br><span class="line">✅ 增强RAG系统初始化成功!</span><br><span class="line">                           🔧 系统状态</span><br><span class="line">┏━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┓</span><br><span class="line">┃ 组件                 ┃ 状态            ┃ 详情                  ┃</span><br><span class="line">┡━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━┩</span><br><span class="line">│ LLM接口              │ ✅ 正常         │                       │</span><br><span class="line">│ 嵌入模型             │ ✅ 正常         │ intfloat/e5-large-v2  │</span><br><span class="line">│ 文档管理             │ ✅ 正常         │                       │</span><br><span class="line">│ 多模态处理           │ ✅ 正常         │ OCR: True, 表格: True │</span><br><span class="line">│ 网页研究             │ ✅ 正常         │                       │</span><br><span class="line">│ 知识库               │ ✅ 正常         │                       │</span><br><span class="line">│ 性能监控             │ ✅ 正常         │                       │</span><br><span class="line">└──────────────────────┴─────────────────┴───────────────────────┘</span><br><span class="line"></span><br><span class="line">📚 文档知识库设置</span><br><span class="line">┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓</span><br><span class="line">┃ 选项     ┃ 描述                        ┃</span><br><span class="line">┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩</span><br><span class="line">│ 1        │ 在线文档 (输入URL)          │</span><br><span class="line">│ 2        │ 本地文档 (输入文件路径)     │</span><br><span class="line">│ 3        │ 批量本地文档 (输入目录路径) │</span><br><span class="line">│ 4        │ 使用默认示例PDF             │</span><br><span class="line">└──────────┴─────────────────────────────┘</span><br><span class="line"></span><br><span class="line">请选择文档来源 [1/2/3/4] (4): 2</span><br><span class="line">请输入文档文件路径 (回车结束): G:\Program for work\Other\CamelAgent.pdf</span><br><span class="line">请输入文档文件路径 (回车结束): G:\Program for work\Other\CamelAgent.pdf</span><br><span class="line">请输入文档文件路径 (回车结束): </span><br><span class="line">⏳ 正在加载 2 个文档...</span><br><span class="line">⏱ 开始监控: setup_knowledge_base</span><br><span class="line">📚 正在设置知识库...</span><br><span class="line">文档数量: 2</span><br><span class="line">来源类型: path</span><br><span class="line"></span><br><span class="line">📄 处理文档: G:\Program for work\Other\CamelAgent.pdf</span><br><span class="line">📄 处理文档: G:\Program for work\Other\CamelAgent.pdf</span><br><span class="line">✅ 文档缓存已保存: 271 个块</span><br><span class="line">✅ 文档处理完成: 271 个块, 耗时 13.07s</span><br><span class="line">✅ 文档处理完成: 271 个块</span><br><span class="line"></span><br><span class="line">📄 处理文档: G:\Program for work\Other\CamelAgent.pdf</span><br><span class="line">📄 处理文档: G:\Program for work\Other\CamelAgent.pdf</span><br><span class="line">⚡ 使用缓存数据</span><br><span class="line">✅ 文档处理完成: 271 个块</span><br><span class="line"></span><br><span class="line">⏳ 正在构建向量索引...</span><br><span class="line">⏱ 开始监控: add_documents</span><br><span class="line">⏳ 正在计算 542 个文档的嵌入向量...</span><br><span class="line">✅ 成功添加 542 个文档到检索器</span><br><span class="line">✓ 操作完成: add (耗时: 343.83s, 内存: 794.0MB)</span><br><span class="line"></span><br><span class="line">✅ 知识库设置完成!</span><br><span class="line">处理文档数: 2</span><br><span class="line">总文档块数: 542</span><br><span class="line">内容统计: 文本(418) 图像(116) 表格(8) 其他(0)</span><br><span class="line">缓存统计: 1 个文档, 0.4MB</span><br><span class="line">✓ 操作完成: setup (耗时: 356.98s, 内存: 794.0MB)</span><br><span class="line">✅ 知识库设置完成!</span><br><span class="line"></span><br><span class="line">💭 请输入您的问题 (): 介绍camel中的rag使用   </span><br><span class="line"></span><br><span class="line">🔍 选择检索模式</span><br><span class="line">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┓</span><br><span class="line">┃ 模式         ┃ 描述              ┃ 特点                     ┃</span><br><span class="line">┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━┩</span><br><span class="line">│ 1. 快速检索  │ 基础向量检索      │ 速度快，适合简单查询     │</span><br><span class="line">│ 2. 深度检索  │ 查询重写+HyDE+RRF │ 准确度高，适合复杂查询   │</span><br><span class="line">│ 3. 主题检索  │ PDF+网页综合分析  │ 信息全面，适合研究性查询 │</span><br><span class="line">└──────────────┴───────────────────┴──────────────────────────┘</span><br><span class="line">请选择检索模式 [1/2/3] (1): 2</span><br><span class="line">⏳ 正在执行深度检索...</span><br><span class="line">⏱ 开始监控: enhanced_query_深度检索</span><br><span class="line"></span><br><span class="line">🔍 执行深度检索: 介绍camel中的rag使用</span><br><span class="line">============================================================</span><br><span class="line">🔬 执行深度检索...</span><br><span class="line">📝 步骤1: 查询重写</span><br><span class="line">API调用尝试 1/3</span><br><span class="line">✓ API调用成功</span><br><span class="line">🧠 步骤2: HyDE假设文档生成</span><br><span class="line">API调用尝试 1/3</span><br><span class="line">✓ API调用成功</span><br><span class="line">🔍 步骤3: 多路检索</span><br><span class="line">⏱ 开始监控: vector_query</span><br><span class="line">✅ 检索到 5 个相关文档</span><br><span class="line">✓ 操作完成: vector (耗时: 0.20s, 内存: 569.7MB)</span><br><span class="line">⏱ 开始监控: vector_query</span><br><span class="line">✅ 检索到 5 个相关文档</span><br><span class="line">✓ 操作完成: vector (耗时: 0.19s, 内存: 571.0MB)</span><br><span class="line">⏱ 开始监控: vector_query</span><br><span class="line">✅ 检索到 5 个相关文档</span><br><span class="line">✓ 操作完成: vector (耗时: 0.95s, 内存: 584.7MB)</span><br><span class="line">⏱ 开始监控: vector_query</span><br><span class="line">✅ 检索到 0 个相关文档</span><br><span class="line">✓ 操作完成: vector (耗时: 0.12s, 内存: 581.9MB)</span><br><span class="line">⏱ 开始监控: vector_query</span><br><span class="line">✅ 检索到 0 个相关文档</span><br><span class="line">✓ 操作完成: vector (耗时: 0.14s, 内存: 581.7MB)</span><br><span class="line">🔀 步骤4: RRF结果融合</span><br><span class="line">💡 步骤5: 生成最终答案</span><br><span class="line">API调用尝试 1/3</span><br><span class="line">✓ API调用成功</span><br><span class="line">✓ 操作完成: enhanced (耗时: 41.24s, 内存: 910.7MB)</span><br><span class="line"></span><br><span class="line">================================================================================    </span><br><span class="line">╭──────────────────────────────────── 查询信息 ────────────────────────────────────╮</span><br><span class="line">│ 🔍 查询: 介绍camel中的rag使用                                                    │</span><br><span class="line">│ 🔧 方法: 深度检索(重写+HyDE+RRF)                                                 │</span><br><span class="line">│ 📝 重写: 在Apache Camel中实现RAG（Retrieval-Augmented                            │</span><br><span class="line">│ Generation）的具体应用和配置方法                                                 │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line"></span><br><span class="line">📄 检索到的文档 (共11个):</span><br><span class="line">╭───────────────────────────────────── 文档 1 ─────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0474                                                               │</span><br><span class="line">│ 内容预览: DataWhale 和 CAMEL                                                     │</span><br><span class="line">│ 之间的关系是合作和知识共享。尽管它们生活在不同的环境中——                         │</span><br><span class="line">│ CAMEL 生活在沙漠，而 DataWhale 生活在海洋，但它们都发现了神秘的古代文物，分别是  │</span><br><span class="line">│ 古代石板和古老羊皮纸。通过一只信使鸟的帮助，它们了解到对方的发现并决定合作解开这 │</span><br><span class="line">│ 些文物的秘密。CAMEL 跨越沙漠来到海洋边缘，而 DataWhale 也游到岸边与 CAMEL 会     │</span><br><span class="line">│ 合。最终，它们共同努力...                                                        │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────── 文档 2 ─────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0320                                                               │</span><br><span class="line">│ 内容预览: DataWhale 和 CAMEL                                                     │</span><br><span class="line">│ 之间的关系是合作和知识共享。尽管它们生活在不同的环境中——                         │</span><br><span class="line">│ CAMEL 生活在沙漠，而 DataWhale 生活在海洋，但它们都发现了神秘的古代文物，分别是  │</span><br><span class="line">│ 古代石板和古老羊皮纸。通过一只信使鸟的帮助，它们了解到对方的发现并决定合作解开这 │</span><br><span class="line">│ 些文物的秘密。CAMEL 跨越沙漠来到海洋边缘，而 DataWhale 也游到岸边与 CAMEL 会     │</span><br><span class="line">│ 合。最终，它们共同努力...                                                        │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────── 文档 3 ─────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0310                                                               │</span><br><span class="line">│ 内容预览:     # 遍历文本检索结果                                                 │</span><br><span class="line">│     for rank, result in enumerate(text_results):                                 │</span><br><span class="line">│         text = result[&#x27;text&#x27;]                                                    │</span><br><span class="line">│         doc_scores = doc_scores.get(text, 0) + 1 / (rank + m)                    │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│     # 按融合分数排序并返回前k 个结果                                             │</span><br><span class="line">│     ...                                                                          │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────── 文档 4 ─────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0164                                                               │</span><br><span class="line">│ 内容预览:                                                                        │</span><br><span class="line">│ 观察到文案风格确实更加活泼，且红圈部分正确修改成了中南海和配图也十分吻合。       │</span><br><span class="line">│ 6. 搭配前端食用                                                                  │</span><br><span class="line">│ 综合案例中为了尽可能让大家直观的感受到基于CAMEL 框架的Agent 产品开发的乐趣，我   │</span><br><span class="line">│ 们还为大家准备了精美的前端，搭配之前的几个后端模块一起构成我们的NavigatorAI 旅游 │</span><br><span class="line">│                                                                                  │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────── 文档 5 ─────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0164                                                               │</span><br><span class="line">│ 内容预览:                                                                        │</span><br><span class="line">│ The CAMEL framework ( (https://github.com/camel-ai))                             │</span><br><span class="line">│ developed by the CAMEL-AI community is one of the earliest open-source           │</span><br><span class="line">│ multi-agent                                                                      │</span><br><span class="line">│ projects based on large languag...                                               │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────── 文档 6 ─────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0161                                                               │</span><br><span class="line">│ 内容预览:                                                                        │</span><br><span class="line">│ 观察到文案风格确实更加活泼，且红圈部分正确修改成了中南海和配图也十分吻合。       │</span><br><span class="line">│ 6. 搭配前端食用                                                                  │</span><br><span class="line">│ 综合案例中为了尽可能让大家直观的感受到基于CAMEL 框架的Agent 产品开发的乐趣，我   │</span><br><span class="line">│ 们还为大家准备了精美的前端，搭配之前的几个后端模块一起构成我们的NavigatorAI 旅游 │</span><br><span class="line">│                                                                                  │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────── 文档 7 ─────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0161                                                               │</span><br><span class="line">│ 内容预览:                                                                        │</span><br><span class="line">│ The CAMEL framework ( (https://github.com/camel-ai))                             │</span><br><span class="line">│ developed by the CAMEL-AI community is one of the earliest open-source           │</span><br><span class="line">│ multi-agent                                                                      │</span><br><span class="line">│ projects based on large languag...                                               │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────── 文档 8 ─────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0159                                                               │</span><br><span class="line">│ 内容预览:     # 遍历文本检索结果                                                 │</span><br><span class="line">│     for rank, result in enumerate(text_results):                                 │</span><br><span class="line">│         text = result[&#x27;text&#x27;]                                                    │</span><br><span class="line">│         doc_scores = doc_scores.get(text, 0) + 1 / (rank + m)                    │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│     # 按融合分数排序并返回前k 个结果                                             │</span><br><span class="line">│     ...                                                                          │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────── 文档 9 ─────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0159                                                               │</span><br><span class="line">│ 内容预览:                                                                        │</span><br><span class="line">│ 此外，还有其他一些研究和项目也在探索如何利用LLMs 构建多智能体系统，比如通过模拟  │</span><br><span class="line">│ 社会动态、协作解决问题等。这些工作都在不同程度上推动了                           │</span><br><span class="line">│ 该领域的进步。                                                                   │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ 如果您有更具体的时间范围或其他标准来定义“第一个”，请提供更多信息，这样我可以尝试 │</span><br><span class="line">│ 给出更加准确的答案。&quot;                                                            │</span><br><span class="line">│ 之后我们将之前设定的memory 赋值给agent：                                         │</span><br><span class="line">│ # 将memory 赋值给agent                                                           │</span><br><span class="line">│ agent.memory...                                                                  │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭──────────────────────────────────── 文档 10 ─────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0156                                                               │</span><br><span class="line">│ 内容预览:                                                                        │</span><br><span class="line">│ 此外，还有其他一些研究和项目也在探索如何利用LLMs 构建多智能体系统，比如通过模拟  │</span><br><span class="line">│ 社会动态、协作解决问题等。这些工作都在不同程度上推动了                           │</span><br><span class="line">│ 该领域的进步。                                                                   │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ 如果您有更具体的时间范围或其他标准来定义“第一个”，请提供更多信息，这样我可以尝试 │</span><br><span class="line">│ 给出更加准确的答案。&quot;                                                            │</span><br><span class="line">│ 之后我们将之前设定的memory 赋值给agent：                                         │</span><br><span class="line">│ # 将memory 赋值给agent                                                           │</span><br><span class="line">│ agent.memory...                                                                  │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭──────────────────────────────────── 文档 11 ─────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0154                                                               │</span><br><span class="line">│ 内容预览: # 创建或初始化向量存储（例如 QdrantStorage）                           │</span><br><span class="line">│ from camel.storages.vectordb_storages import QdrantStorage                       │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ vector_storage = QdrantStorage(                                                  │</span><br><span class="line">│     vector_dim=embedding_model.get_output_dim(),  # 嵌入向量的维度               │</span><br><span class="line">│     collecti...                                                                  │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭────────────────────────────────── 💡 生成答案 ───────────────────────────────────╮</span><br><span class="line">│ ### CAMEL 中的 RAG 使用介绍                                                      │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ #### 1. RAG 基本概念                                                             │</span><br><span class="line">│ RAG（Retrieval-Augmented                                                         │</span><br><span class="line">│ Generation）是一种结合了信息检索和自然语言生成的技术。它通过先从大量文档中检索出 │</span><br><span class="line">│ 与查询相关的片段，再利用这些片段生成高质量的回答，从而提高生成内容的相关性和准确 │</span><br><span class="line">│ 性。在 CAMEL 框架中，RAG 技术被广泛应用于知识问答、客户服务等领域。              │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ #### 2. CAMEL 框架中的 RAG 组件                                                  │</span><br><span class="line">│ 根据文档内容，CAMEL 框架中的 RAG 技术涉及以下几个主要组件：                      │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ - **CAMEL**：一个强大的多代理框架，支持 Retrieval-Augmented Generation           │</span><br><span class="line">│ 和多代理角色扮演场景，允许执行复杂的 AI 驱动任务。                               │</span><br><span class="line">│ -                                                                                │</span><br><span class="line">│ **Firecrawl**：一个强大的网络抓取工具，可简化从各种网页中提取和清理内容的过程。  │</span><br><span class="line">│ - **Qdrant**：一种高效的向量存储系统，与 Camel 的 AutoRetriever                  │</span><br><span class="line">│ 一起使用，根据向量相似性存储和检索相关信息。                                     │</span><br><span class="line">│ - **BM25Retriever**：一种基于 BM25 算法的检索器，用于从文本中检索相关信息。      │</span><br><span class="line">│ - **SentenceTransformerEncoder**：用于生成文本的向量表示，以便进行向量检索。     │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ #### 3. RAG 的具体实现步骤                                                       │</span><br><span class="line">│ 以下是使用 CAMEL 框架实现 RAG 的具体步骤：                                       │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ ##### 3.1 设置 API 密钥                                                          │</span><br><span class="line">│ 首先，需要设置所需的 API 密钥，例如 AgentOps 和 Firecrawl 的 API 密钥：          │</span><br><span class="line">│ ```python                                                                        │</span><br><span class="line">│ import os                                                                        │</span><br><span class="line">│ from getpass import getpass                                                      │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ # 输入 AgentOps API 密钥                                                         │</span><br><span class="line">│ agentops_api_key = getpass(&#x27;请输入您的 API 密钥: &#x27;)                              │</span><br><span class="line">│ os.environ[&quot;AGENTOPS_API_KEY&quot;] = agentops_api_key                                │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ # 输入 Firecrawl API 密钥                                                        │</span><br><span class="line">│ firecrawl_api_key = getpass(&#x27;Enter your API key: &#x27;)                              │</span><br><span class="line">│ os.environ[&quot;FIRECRAWL_API_KEY&quot;] = firecrawl_api_key                              │</span><br><span class="line">│ ```                                                                              │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ ##### 3.2 使用 Firecrawl 抓取网页内容                                            │</span><br><span class="line">│ 使用 Firecrawl 从指定的 URL 抓取并清理内容：                                     │</span><br><span class="line">│ ```python                                                                        │</span><br><span class="line">│ from camel.loaders import Firecrawl                                              │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ firecrawl = Firecrawl()                                                          │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ # 从指定的 URL 抓取并清理内容                                                    │</span><br><span class="line">│ response = firecrawl.scrape(url=&quot;https://www.camel-ai.org/&quot;)                     │</span><br><span class="line">│ ```                                                                              │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ ##### 3.3 初始化检索器                                                           │</span><br><span class="line">│ 初始化向量检索器和 BM25 检索器：                                                 │</span><br><span class="line">│ ```python                                                                        │</span><br><span class="line">│ from camel.embeddings import SentenceTransformerEncoder                          │</span><br><span class="line">│ from camel.storage import QdrantStorage                                          │</span><br><span class="line">│ from camel.retrievers import VectorRetriever, BM25Retriever                      │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ # 初始化嵌入模型                                                                 │</span><br><span class="line">│ embedding_model = SentenceTransformerEncoder(model_name=&#x27;intfloat/e5-large-v2&#x27;)  │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ # 初始化向量存储                                                                 │</span><br><span class="line">│ vector_storage = QdrantStorage(                                                  │</span><br><span class="line">│     vector_dim=embedding_model.get_output_dim(),                                 │</span><br><span class="line">│     collection=&quot;demo_collection&quot;,                                                │</span><br><span class="line">│     path=&quot;storage_customized_run&quot;,                                               │</span><br><span class="line">│     collection_name=&quot;paper&quot;                                                      │</span><br><span class="line">│ )                                                                                │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ # 初始化向量检索器                                                               │</span><br><span class="line">│ vr = VectorRetriever(embedding_model=embedding_model, storage=vector_storage)    │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ # 初始化 BM25 检索器                                                             │</span><br><span class="line">│ bm25r = BM25Retriever()                                                          │</span><br><span class="line">│ ```                                                                              │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ ##### 3.4 处理文档                                                               │</span><br><span class="line">│ 处理需要检索的文档内容：                                                         │</span><br><span class="line">│ ```python                                                                        │</span><br><span class="line">│ content_path = &quot;local_data/camel_paper.pdf&quot;                                      │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ # 处理向量检索器的文档                                                           │</span><br><span class="line">│ vr.process(content=content_path)                                                 │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ # 处理 BM25 检索器的文档                                                         │</span><br><span class="line">│ bm25r.process(content_input_path=content_path)                                   │</span><br><span class="line">│ ```                                                                              │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ ##### 3.5 执行查询                                                               │</span><br><span class="line">│ 执行查询并获取检索结果：                                                         │</span><br><span class="line">│ ```python                                                                        │</span><br><span class="line">│ query = &quot;CAMEL 是                                                                │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">================================================================================    </span><br><span class="line">💾 是否保存结果到文件? [y/n] (n): n</span><br><span class="line">🔄 是否继续查询? [y/n] (y): y</span><br><span class="line"></span><br><span class="line">💭 请输入您的问题 (): 科普camel架构的功能和特性</span><br><span class="line"></span><br><span class="line">🔍 选择检索模式</span><br><span class="line">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┓</span><br><span class="line">┃ 模式         ┃ 描述              ┃ 特点                     ┃</span><br><span class="line">┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━┩</span><br><span class="line">│ 1. 快速检索  │ 基础向量检索      │ 速度快，适合简单查询     │</span><br><span class="line">│ 2. 深度检索  │ 查询重写+HyDE+RRF │ 准确度高，适合复杂查询   │</span><br><span class="line">│ 3. 主题检索  │ PDF+网页综合分析  │ 信息全面，适合研究性查询 │</span><br><span class="line">└──────────────┴───────────────────┴──────────────────────────┘</span><br><span class="line">请选择检索模式 [1/2/3] (1): 3</span><br><span class="line">⏳ 正在执行主题检索...</span><br><span class="line">⏱ 开始监控: enhanced_query_主题检索</span><br><span class="line"></span><br><span class="line">🔍 执行主题检索: 科普camel架构的功能和特性</span><br><span class="line">============================================================</span><br><span class="line">🌐 执行主题检索...</span><br><span class="line">📄 步骤1: PDF文档检索</span><br><span class="line">⏱ 开始监控: vector_query</span><br><span class="line">✅ 检索到 5 个相关文档</span><br><span class="line">✓ 操作完成: vector (耗时: 0.19s, 内存: 1275.8MB)</span><br><span class="line">🔍 步骤2: 网页研究</span><br><span class="line"></span><br><span class="line">开始网页研究: 科普camel架构的功能和特性</span><br><span class="line">==================================================</span><br><span class="line">使用DuckDuckGo搜索...</span><br><span class="line">⚠ DuckDuckGo搜索失败: https://duckduckgo.com/?q=%E7%A7%91%E6%99%AEcamel%E6%9E%B6%E6%9E%84%E7%9A%84%E5%8A%9F%E8%83%BD%E5%92%8C%E7%89%B9%E6%80%A7 202 Ratelimit</span><br><span class="line">使用备用搜索方法...</span><br><span class="line">✓ 备用搜索完成，生成 3 个模拟结果</span><br><span class="line">✓ 找到 3 个搜索结果</span><br><span class="line">正在获取网页内容 1/3: 关于科普camel架构的功能和特性的学术资源...</span><br><span class="line">✓ 成功获取内容 (706字符)</span><br><span class="line">正在获取网页内容 2/3: 科普camel架构的功能和特性 - 维基百科...</span><br><span class="line">✓ 成功获取内容 (3003字符)</span><br><span class="line">正在获取网页内容 3/3: 科普camel架构的功能和特性技术文档...</span><br><span class="line">⚠ 网页内容获取失败 (https://docs.example.com): HTTPSConnectionPool(host=&#x27;docs.example.com&#x27;, port=443): Max retries exceeded with url: / (Caused by SSLError(SSLEOFError(8, &#x27;[SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1006)&#x27;)))</span><br><span class="line">⚠ 内容获取失败</span><br><span class="line">✓ 网页研究完成，分析了 2 个网页</span><br><span class="line">🧩 步骤3: 综合分析</span><br><span class="line">API调用尝试 1/3</span><br><span class="line">✓ API调用成功</span><br><span class="line">✓ 操作完成: enhanced (耗时: 38.07s, 内存: 1307.3MB)</span><br><span class="line"></span><br><span class="line">================================================================================    </span><br><span class="line">╭──────────────────────────────────── 查询信息 ────────────────────────────────────╮</span><br><span class="line">│ 🔍 查询: 科普camel架构的功能和特性                                               │</span><br><span class="line">│ 🔧 方法: 主题检索(PDF+网页)                                                      │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭────────────────────────────────── 💡 生成答案 ───────────────────────────────────╮</span><br><span class="line">│ ### CAMEL 架构的功能和特性                                                       │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ **CAMEL（Customized Applications for Mobile network Enhanced Logic）**           │</span><br><span class="line">│ 是一种用于移动网络中实现定制化应用的逻辑框架。它允许运营商根据不同的业务需求，灵 │</span><br><span class="line">│ 活地提供增值服务，如预付费服务、智能网服务等。以下是结合PDF文档和网页信息对CAMEL │</span><br><span class="line">│ 架构功能和特性的详细介绍：                                                       │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ #### 1. **灵活性和可扩展性**                                                     │</span><br><span class="line">│    - **灵活性**：CAMEL                                                           │</span><br><span class="line">│ 架构设计允许运营商根据市场和客户需求快速推出新的增值服务，无需对核心网络进行大规 │</span><br><span class="line">│ 模改造。                                                                         │</span><br><span class="line">│    - **可扩展性**：随着技术的发展和新业务的增加，CAMEL                           │</span><br><span class="line">│ 架构能够轻松扩展，支持更多的服务和应用。                                         │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ #### 2. **智能网服务**                                                           │</span><br><span class="line">│    - **预付费服务**：CAMEL                                                       │</span><br><span class="line">│ 支持预付费用户的服务管理，包括账户充值、余额查询、计费等。                       │</span><br><span class="line">│    - **个性化服务**：运营商可以通过CAMEL 提供个性化的服务，如铃声下载、彩信等。  │</span><br><span class="line">│    - **位置服务**：CAMEL 可以支持基于用户位置的增值服务，如导航、天气预报等。    │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ #### 3. **协作与知识共享**                                                       │</span><br><span class="line">│    - **跨领域合作**：CAMEL                                                       │</span><br><span class="line">│ 架构鼓励不同背景和技术领域的合作。例如，在PDF文档中提到的故事中，CAMEL（代表沙漠 │</span><br><span class="line">│ 中的骆驼）和DataWhale（代表海洋中的鲸鱼）通过合作解开了古老的符号之谜，找到了知  │</span><br><span class="line">│ 识的宝库。                                                                       │</span><br><span class="line">│    -                                                                             │</span><br><span class="line">│ **知识共享**：通过合作，不同实体可以共享知识和资源，推动整体发展。这不仅限于技术 │</span><br><span class="line">│ 领域，还包括文化、教育等多个方面。                                               │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ #### 4. **技术实现**                                                             │</span><br><span class="line">│    - **Agent 技术**：CAMEL 架构利用Agent技术来实现智能化的服务。Agent            │</span><br><span class="line">│ 可以自主地执行任务，如搜索信息、处理请求等。                                     │</span><br><span class="line">│    - **前端与后端集成**：CAMEL                                                   │</span><br><span class="line">│ 架构不仅提供了强大的后端模块，还配备了精美的前端界面，使得用户能够直观地体验和使 │</span><br><span class="line">│ 用各种服务。例如，PDF文档中提到的“NavigatorAI                                    │</span><br><span class="line">│ 旅游”应用，就是一个典型的前后端集成示例。                                        │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ #### 5. **可靠性和安全性**                                                       │</span><br><span class="line">│    - **可靠性**：CAMEL                                                           │</span><br><span class="line">│ 架构设计注重系统的稳定性和可靠性，确保服务的连续性和高质量。                     │</span><br><span class="line">│    - **安全性**：通过多种安全机制，CAMEL                                         │</span><br><span class="line">│ 架构保护用户数据和交易的安全，防止未经授权的访问和攻击。                         │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ #### 6. **创新与未来展望**                                                       │</span><br><span class="line">│    - **创新**：CAMEL 架构不断推动技术创新，探索新的应用场景和服务模式。          │</span><br><span class="line">│    - **未来展望**：随着5G和物联网技术的发展，CAMEL                               │</span><br><span class="line">│ 架构将进一步拓展其应用范围，支持更多智能化和个性化的服务。                       │</span><br><span class="line">│                                                                                  │</span><br><span class="line">│ ### 总结                                                                         │</span><br><span class="line">│ CAMEL                                                                            │</span><br><span class="line">│ 架构以其灵活性、可扩展性、智能网服务、协作与知识共享、技术实现、可靠性和安全性等 │</span><br><span class="line">│ 多方面的优势，成为移动网络增值服务的重要支撑。通过不断的技术创新和跨领域的合作， │</span><br><span class="line">│ CAMEL 架构将继续推动移动通信行业的发展，为用户提供更加丰富和便捷的服务。         │</span><br><span class="line">╰──────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">================================================================================</span><br><span class="line">💾 是否保存结果到文件? [y/n] (n): n</span><br><span class="line">🔄 是否继续查询? [y/n] (y): n</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">📊 最终性能报告</span><br><span class="line">============================================================</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">性能监控报告</span><br><span class="line">============================================================</span><br><span class="line">总操作数: 10</span><br><span class="line">整体成功率: 100.0%</span><br><span class="line">总耗时: 781.91秒</span><br><span class="line">平均耗时: 78.19秒</span><br><span class="line">平均内存使用: 797.1MB</span><br><span class="line"></span><br><span class="line">操作详情:</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">add:</span><br><span class="line">  调用次数: 1</span><br><span class="line">  成功率: 100.0%</span><br><span class="line">  平均耗时: 343.83秒</span><br><span class="line">  平均内存: 794.0MB</span><br><span class="line"></span><br><span class="line">setup:</span><br><span class="line">  调用次数: 1</span><br><span class="line">  成功率: 100.0%</span><br><span class="line">  平均耗时: 356.98秒</span><br><span class="line">  平均内存: 794.0MB</span><br><span class="line"></span><br><span class="line">vector:</span><br><span class="line">  调用次数: 6</span><br><span class="line">  成功率: 100.0%</span><br><span class="line">  平均耗时: 0.30秒</span><br><span class="line">  平均内存: 694.1MB</span><br><span class="line"></span><br><span class="line">enhanced:</span><br><span class="line">  调用次数: 2</span><br><span class="line">  成功率: 100.0%</span><br><span class="line">  平均耗时: 39.65秒</span><br><span class="line">  平均内存: 1109.0MB</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">💾 是否保存结果到文件? [y/n] (n): n</span><br><span class="line">✅ 感谢使用增强的交互式多模态RAG系统!</span><br><span class="line">PS G:\Python-Camel-project\Interactive_Multi_RAG&gt; </span><br><span class="line">fwd-i-search: _</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br></pre></td><td class="code"><pre><span class="line">PS G:\Python-Camel-project\Interactive_Multi_RAG&gt; &amp; D:/Download/Python/py-3.11.9/python.exe g:/Python-Camel-project/Interactive_Multi_RAG/Enhanced_Interactive_Multimodal_RAG.py</span><br><span class="line">W0725 20:04:54.071000 28968 site-packages\torch\distributed\elastic\multiprocessing\redirects.py:29] NOTE: Redirects are currently not supported in Windows or MacOs.</span><br><span class="line">✓ 使用Rich增强界面</span><br><span class="line">╭─────────────────────────────────────────── 🎯 系统启动 ───────────────────────────────────────────╮</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│  🤖 交互式多模态RAG系统 v2.0                                                                      │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│  ✨ 新功能特性:                                                                                   │</span><br><span class="line">│  • 🔧 增强的CAMEL框架集成和稳定性改进                                                             │</span><br><span class="line">│  • 🖼️ 改进的多模态支持 (图像OCR + 表格提取)                                                        │</span><br><span class="line">│  • 🌐 真实网页研究和内容分析                                                                      │</span><br><span class="line"></span><br><span class="line">│  • ⚡ 性能监控和优化                                                                              │</span><br><span class="line">│  • 🎨 增强的用户界面体验                                                                          │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│  🚀 支持的检索模式:                                                                               │</span><br><span class="line">│  • 快速检索: 基础向量检索                                                                         │</span><br><span class="line">│  • 深度检索: 查询重写 + HyDE + RRF融合                                                            │</span><br><span class="line">│  • 主题检索: PDF + 网页内容综合分析                                                               │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">🚀 正在初始化增强RAG系统...</span><br><span class="line">性能监控器初始化 (详细监控: 开启)</span><br><span class="line">🚀 初始化增强RAG系统...</span><br><span class="line">正在初始化CAMEL模型...</span><br><span class="line">CAMEL模型测试失败: &#x27;BaseMessage&#x27; object has no attribute &#x27;get&#x27;...</span><br><span class="line">⚠ CAMEL模型初始化成功但测试失败，将使用直接API调用</span><br><span class="line">✅ 嵌入模型加载成功</span><br><span class="line">✅ 增强向量检索器初始化完成</span><br><span class="line">✅ 增强文档管理器初始化完成</span><br><span class="line">📁 缓存目录: document_cache</span><br><span class="line">📋 支持格式: [&#x27;.pdf&#x27;, &#x27;.docx&#x27;, &#x27;.doc&#x27;, &#x27;.txt&#x27;, &#x27;.md&#x27;, &#x27;.csv&#x27;, &#x27;.xlsx&#x27;, &#x27;.xls&#x27;, &#x27;.pptx&#x27;, &#x27;.ppt&#x27;, &#x27;.json&#x27;, &#x27;.xml&#x27;, &#x27;.html&#x27;, &#x27;.rtf&#x27;]</span><br><span class="line">多模态处理器初始化:</span><br><span class="line">  图像OCR: ✓</span><br><span class="line">  表格处理: ✓</span><br><span class="line">  PyMuPDF: ✓</span><br><span class="line">网页研究系统初始化:</span><br><span class="line">  BeautifulSoup4: ✓</span><br><span class="line">  DuckDuckGo搜索: ✓</span><br><span class="line">✅ 增强RAG系统初始化完成!</span><br><span class="line">✅ 增强RAG系统初始化成功!</span><br><span class="line">                           🔧 系统状态</span><br><span class="line">┏━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┓</span><br><span class="line">┃ 组件                 ┃ 状态            ┃ 详情                  ┃</span><br><span class="line">┡━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━┩</span><br><span class="line">│ LLM接口              │ ✅ 正常         │                       │</span><br><span class="line">│ 嵌入模型             │ ✅ 正常         │ intfloat/e5-large-v2  │</span><br><span class="line">│ 文档管理             │ ✅ 正常         │                       │</span><br><span class="line">│ 多模态处理           │ ✅ 正常         │ OCR: True, 表格: True │</span><br><span class="line">│ 网页研究             │ ✅ 正常         │                       │</span><br><span class="line">│ 知识库               │ ✅ 正常         │                       │</span><br><span class="line">│ 性能监控             │ ✅ 正常         │                       │</span><br><span class="line">└──────────────────────┴─────────────────┴───────────────────────┘</span><br><span class="line"></span><br><span class="line">📚 文档知识库设置</span><br><span class="line">┏━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓</span><br><span class="line">┃ 选项     ┃ 描述                        ┃</span><br><span class="line">┡━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩</span><br><span class="line">│ 1        │ 在线文档 (输入URL)          │</span><br><span class="line">│ 2        │ 本地文档 (输入文件路径)     │</span><br><span class="line">│ 3        │ 批量本地文档 (输入目录路径) │</span><br><span class="line">│ 4        │ 使用默认示例PDF             │</span><br><span class="line">└──────────┴─────────────────────────────┘</span><br><span class="line"></span><br><span class="line">请选择文档来源 [1/2/3/4] (4): 2</span><br><span class="line">请输入文档文件路径 (回车结束): G:\Program for work\Other\CamelAgent.pdf</span><br><span class="line">请输入文档文件路径 (回车结束): </span><br><span class="line">⏳ 正在加载 1 个文档...</span><br><span class="line">⏱ 开始监控: setup_knowledge_base</span><br><span class="line">📚 正在设置知识库...</span><br><span class="line">文档数量: 1</span><br><span class="line">来源类型: path</span><br><span class="line"></span><br><span class="line">📄 处理文档: G:\Program for work\Other\CamelAgent.pdf</span><br><span class="line">📄 处理文档: G:\Program for work\Other\CamelAgent.pdf</span><br><span class="line">⚡ 使用缓存数据</span><br><span class="line">✅ 文档处理完成: 271 个块</span><br><span class="line"></span><br><span class="line">⏳ 正在构建向量索引...</span><br><span class="line">⏱ 开始监控: add_documents</span><br><span class="line">⏳ 正在计算 271 个文档的嵌入向量...</span><br><span class="line">✅ 成功添加 271 个文档到检索器</span><br><span class="line">✓ 操作完成: add (耗时: 92.37s, 内存: 2280.5MB)</span><br><span class="line"></span><br><span class="line">✅ 知识库设置完成!</span><br><span class="line">处理文档数: 1</span><br><span class="line">总文档块数: 271</span><br><span class="line">内容统计: 文本(209) 图像(58) 表格(4) 其他(0)</span><br><span class="line">缓存统计: 1 个文档, 0.4MB</span><br><span class="line">✓ 操作完成: setup (耗时: 92.39s, 内存: 2280.5MB)</span><br><span class="line">✅ 知识库设置完成!</span><br><span class="line"></span><br><span class="line">💭 请输入您的问题 (): 详细说明camel框架roleplaying的特点以及使用场景</span><br><span class="line"></span><br><span class="line">🔍 选择检索模式</span><br><span class="line">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┓</span><br><span class="line">┃ 模式         ┃ 描述              ┃ 特点                     ┃</span><br><span class="line">┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━┩</span><br><span class="line">│ 1. 快速检索  │ 基础向量检索      │ 速度快，适合简单查询     │</span><br><span class="line">│ 2. 深度检索  │ 查询重写+HyDE+RRF │ 准确度高，适合复杂查询   │</span><br><span class="line">│ 3. 主题检索  │ PDF+网页综合分析  │ 信息全面，适合研究性查询 │</span><br><span class="line">└──────────────┴───────────────────┴──────────────────────────┘</span><br><span class="line">请选择检索模式 [1/2/3] (1): 2</span><br><span class="line">⏳ 正在执行深度检索...</span><br><span class="line">⏱ 开始监控: enhanced_query_深度检索</span><br><span class="line"></span><br><span class="line">🔍 执行深度检索: 详细说明camel框架roleplaying的特点以及使用场景</span><br><span class="line">============================================================</span><br><span class="line">🔬 执行深度检索...</span><br><span class="line">📝 步骤1: 查询重写</span><br><span class="line">API调用尝试 1/3</span><br><span class="line">✓ API调用成功</span><br><span class="line">🧠 步骤2: HyDE假设文档生成</span><br><span class="line">API调用尝试 1/3</span><br><span class="line">✓ API调用成功</span><br><span class="line">🔍 步骤3: 多路检索</span><br><span class="line">⏱ 开始监控: vector_query</span><br><span class="line">✅ 检索到 5 个相关文档</span><br><span class="line">✓ 操作完成: vector (耗时: 0.16s, 内存: 1775.6MB)</span><br><span class="line">⏱ 开始监控: vector_query</span><br><span class="line">✅ 检索到 5 个相关文档</span><br><span class="line">✓ 操作完成: vector (耗时: 0.08s, 内存: 1784.3MB)</span><br><span class="line">⏱ 开始监控: vector_query</span><br><span class="line">✅ 检索到 5 个相关文档</span><br><span class="line">✓ 操作完成: vector (耗时: 0.48s, 内存: 1807.9MB)</span><br><span class="line">⏱ 开始监控: vector_query</span><br><span class="line">✅ 检索到 0 个相关文档</span><br><span class="line">✓ 操作完成: vector (耗时: 0.06s, 内存: 1806.8MB)</span><br><span class="line">⏱ 开始监控: vector_query</span><br><span class="line">✅ 检索到 0 个相关文档</span><br><span class="line">✓ 操作完成: vector (耗时: 0.06s, 内存: 1806.4MB)</span><br><span class="line">🔀 步骤4: RRF结果融合</span><br><span class="line">💡 步骤5: 生成最终答案</span><br><span class="line">API调用尝试 1/3</span><br><span class="line">✓ API调用成功</span><br><span class="line">✓ 操作完成: enhanced (耗时: 52.06s, 内存: 1815.8MB)</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line">╭──────────────────────────────────────────── 查询信息 ─────────────────────────────────────────────╮</span><br><span class="line">│ 🔍 查询: 详细说明camel框架roleplaying的特点以及使用场景                                           │</span><br><span class="line">│ 🔧 方法: 深度检索(重写+HyDE+RRF)                                                                  │</span><br><span class="line">│ 📝 重写: 详细描述Apache Camel框架中角色扮演功能的特性及其应用场景                                 │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line"></span><br><span class="line">📄 检索到的文档 (共12个):</span><br><span class="line">╭───────────────────────────────────────────── 文档 1 ──────────────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0320                                                                                │</span><br><span class="line">│ 内容预览:                                                                                         │</span><br><span class="line">│ 在调用工具时，CAMEL 框架会将每一次FunctionCall 都记录下来，方便我们后续查看、验                   │</span><br><span class="line">│ 证。                                                                                              │</span><br><span class="line">│ 8. 第二章课程作业                                                                                 │</span><br><span class="line">│ Task1                                                                                             │</span><br><span class="line">│ •                                                                                                 │</span><br><span class="line">│ 现在来布置一些作业，帮助你利用 CAMEL 的 Prompt 功能进行练习：                                     │</span><br><span class="line">│ 1. 角色扮演任务Agent：使用 AISocietyPromptTemplateDict，创建一个角色扮演任务                      │</span><br><span class="line">│ Agent。假设你想让 AI 扮演一个“健康顾问”...                                                        │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────────────── 文档 2 ──────────────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0315                                                                                │</span><br><span class="line">│ 内容预览: 和结构化对话机制，实现智能体之间的有效协作。                                            │</span><br><span class="line">│ 在CAMEL 框架中，ChatAgent 是最基础的智能体单元，负责处理对话逻辑和任务执行。而                    │</span><br><span class="line">│ RolePlaying 和Workforce 则是多智能体系统，用于协调多个智能体的协作。                              │</span><br><span class="line">│ 详见我们的开源仓库和项目主页                                                                      │</span><br><span class="line">│ •                                                                                                 │</span><br><span class="line">│ 论文：https://ghli.org/camel.pdf                                                                  │</span><br><span class="line">│ •                                                                                                 │</span><br><span class="line">│ 项目主页：https://www.camel-ai.o...                                                               │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────────────── 文档 3 ──────────────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0313                                                                                │</span><br><span class="line">│ 内容预览: DataWhale 和 CAMEL 之间的关系是合作和知识共享。尽管它们生活在不同的环境中——             │</span><br><span class="line">│ CAMEL 生活在沙漠，而 DataWhale 生活在海洋，但它们都发现了神秘的古代文物，分别是                   │</span><br><span class="line">│ 古代石板和古老羊皮纸。通过一只信使鸟的帮助，它们了解到对方的发现并决定合作解开这                  │</span><br><span class="line">│ 些文物的秘密。CAMEL 跨越沙漠来到海洋边缘，而 DataWhale 也游到岸边与 CAMEL 会                      │</span><br><span class="line">│ 合。最终，它们共同努力...                                                                         │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────────────── 文档 4 ──────────────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0164                                                                                │</span><br><span class="line">│ 内容预览: 如果你无法回答问题就说我不知道。                                                        │</span><br><span class="line">│ &quot;&quot;&quot;                                                                                               │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ model = ModelFactory.create(                                                                      │</span><br><span class="line">│         model_platform=ModelPlatformType.OPENAI_COMPATIBLE_MODEL,                                 │</span><br><span class="line">│         model_type=&quot;Qwen/Qwen2.5-72B-Instruct&quot;,                                                   │</span><br><span class="line">│         url=&#x27;https://api-infe...                                                                  │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────────────── 文档 5 ──────────────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0164                                                                                │</span><br><span class="line">│ 内容预览: 通过一只飞翔在天空中的信使鸟，CAMEL 和DataWhale 得知彼此的发现，并决定合作解开          │</span><br><span class="line">│ 这个谜团。骆驼踏上了漫长的旅程，穿越沙漠来到了海洋边缘，而鲸鱼则游到岸边，与CAMEL                 │</span><br><span class="line">│ 会合。                                                                                            │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 在一起研究这些古老的符号时，CAMEL 运用了它在沙漠中磨炼出的耐心和智慧，而                          │</span><br><span class="line">│ DataWhale 则利用它在海洋中获得的知识和洞察力。经过一番努力，它们终于解读出这些符                  │</span><br><span class="line">│ 号的含义。原来，这些符号描绘的...                                                                 │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────────────── 文档 6 ──────────────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0161                                                                                │</span><br><span class="line">│ 内容预览:                                                                                         │</span><br><span class="line">│ 2. 使用API 调用模型                                                                               │</span><br><span class="line">│ 类 Unix 系统（Linux / macOS）                                                                     │</span><br><span class="line">│   在终端执行：                                                                                    │</span><br><span class="line">│ export MODELSCOPE_SDK_TOKEN=&quot;你的ModelScope 令牌&quot;                                                 │</span><br><span class="line">│ Windows 系统                                                                                      │</span><br><span class="line">│   命令提示符（CMD）：                                                                             │</span><br><span class="line">│ set MODELSCOPE_SDK_TOKEN=&quot;你的ModelScope 令牌&quot;                                                    │</span><br><span class="line">│   PowerShell：                                                                                    │</span><br><span class="line">│ $env:MODELSCOP...                                                                                 │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────────────── 文档 7 ──────────────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0161                                                                                │</span><br><span class="line">│ 内容预览:                                                                                         │</span><br><span class="line">│ 观察到文案风格确实更加活泼，且红圈部分正确修改成了中南海和配图也十分吻合。                        │</span><br><span class="line">│ 6. 搭配前端食用                                                                                   │</span><br><span class="line">│ 综合案例中为了尽可能让大家直观的感受到基于CAMEL 框架的Agent 产品开发的乐趣，我                    │</span><br><span class="line">│ 们还为大家准备了精美的前端，搭配之前的几个后端模块一起构成我们的NavigatorAI 旅游                  │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────────────── 文档 8 ──────────────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0161                                                                                │</span><br><span class="line">│ 内容预览:                                                                                         │</span><br><span class="line">│ 此外，还有其他一些研究和项目也在探索如何利用LLMs 构建多智能体系统，比如通过模拟                   │</span><br><span class="line">│ 社会动态、协作解决问题等。这些工作都在不同程度上推动了                                            │</span><br><span class="line">│ 该领域的进步。                                                                                    │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 如果您有更具体的时间范围或其他标准来定义“第一个”，请提供更多信息，这样我可以尝试                  │</span><br><span class="line">│ 给出更加准确的答案。&quot;                                                                             │</span><br><span class="line">│ 之后我们将之前设定的memory 赋值给agent：                                                          │</span><br><span class="line">│ # 将memory 赋值给agent                                                                            │</span><br><span class="line">│ agent.memory...                                                                                   │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────────────── 文档 9 ──────────────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0159                                                                                │</span><br><span class="line">│ 内容预览: 2. 信息检索：支持根据特定查询或上下文快速检索相关信息，帮助agent 在需要时做             │</span><br><span class="line">│ 出准确的判断。                                                                                    │</span><br><span class="line">│ 3. 记忆更新：能够根据新的信息和经验动态更新存储内容，以反映环境或任务的变化。                     │</span><br><span class="line">│ 4. 记忆管理：包括老化机制和优先级管理，确保较重要的信息能够长期保留，而不再                       │</span><br><span class="line">│ 需要的信息可以被有效清除，以优化存储资源的使用。                                                  │</span><br><span class="line">│ CAMEL 中的Memory 模块提供了一个灵活的系统，用于存储、检索和管理 A...                              │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────────────── 文档 10 ─────────────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0156                                                                                │</span><br><span class="line">│ 内容预览:                                                                                         │</span><br><span class="line">│ 可以看到对于自己不了解或者不确定的内容，Agent 系统会主动去用搜索工具搜索相应的信                  │</span><br><span class="line">│ 息，有的小伙伴可能会有疑问啦，我们怎么确定Agent 系统是否真的是调用了搜索工具去找                  │</span><br><span class="line">│ 寻了对应的内容才给出的回答还是出现了幻觉呢，麻烦一点的办法就是我们去搜索一下对应                  │</span><br><span class="line">│ 的query，看一下是不是真的是模型输出的那样：                                                       │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 可以发现Google 搜索的内容显示结果正如模型输出的那样：牛津大学真的没有确切的...                    │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────────────── 文档 11 ─────────────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0154                                                                                │</span><br><span class="line">│ 内容预览: from camel.utils import print_text_animated                                             │</span><br><span class="line">│ from camel.models import ModelFactory                                                             │</span><br><span class="line">│ from camel.types import ModelPlatformType                                                         │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ from dotenv import load_dotenv                                                                    │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ import os                                                                                         │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ load_dotenv(dotenv_path=...                                                                       │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────────────── 文档 12 ─────────────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.0154                                                                                │</span><br><span class="line">│ 内容预览:                                                                                         │</span><br><span class="line">│ 作业二：通过系统性的学习相信你已经了解了如何去构建属于你的Agent 和多Agent 系统，                  │</span><br><span class="line">│ 请回顾整体的内容并思考，我们可以在哪些方面进一步优化多智能体系统，将你的想法提交                  │</span><br><span class="line">│ 到CAMEL 仓库的issue 列表中，并参考贡献者指南提交你的代码来进行优化。                              │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 结语                                                                                              │</span><br><span class="line">│ 恭喜您！在阅读到这里时，您已经掌握了 CAMEL-AI 应用开发框架的基础知识，并能够利                    │</span><br><span class="line">│ 用 Agent 实例在您的代码逻辑...                                                                    │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭─────────────────────────────────────────── 💡 生成答案 ───────────────────────────────────────────╮</span><br><span class="line">│ ### CAMEL 框架 RolePlaying 特点及使用场景                                                         │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ #### 一、RolePlaying 特点                                                                         │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 1. **角色定义**                                                                                   │</span><br><span class="line">│    - **Assistant 角色**：负责执行具体任务并提供解决方案的智能体。                                 │</span><br><span class="line">│    - **User 角色**：负责提供指令和任务需求的智能体。                                              │</span><br><span class="line">│    - **特定领域角色**：如程序员、交易员等专业角色，可以根据具体任务需求设定不同的角色。           │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 2. **交互规则**                                                                                   │</span><br><span class="line">│    -                                                                                              │</span><br><span class="line">│ **角色固定**：防止角色翻转，维持对话的稳定性。每个智能体都有明确的角色定位，确保不会混淆角色身份  │</span><br><span class="line">│ 。                                                                                                │</span><br><span class="line">│    - **格式规范**：要求回复具有固定的开始和结束格式，例如：                                       │</span><br><span class="line">│      ```plaintext                                                                                 │</span><br><span class="line">│      Solution: &lt;YOUR_SOLUTION&gt;                                                                    │</span><br><span class="line">│      Next request.                                                                                │</span><br><span class="line">│      ```                                                                                          │</span><br><span class="line">│    -                                                                                              │</span><br><span class="line">│ **预定义的提示词**：通过预定义的提示词为不同的智能体创建唯一的初始设置，帮助智能体克服角色翻转、  │</span><br><span class="line">│ 助手重复指令、模糊回复、消息无限循环以及对话终止条件等挑战。例如：                                │</span><br><span class="line">│      ```python                                                                                    │</span><br><span class="line">│      system_message = &quot;&quot;&quot;                                                                         │</span><br><span class="line">│      ===== RULES OF ASSISTANT =====                                                               │</span><br><span class="line">│      1. Never forget you are a &#123;ASSISTANT_ROLE&#125; and I am a &#123;USER_ROLE&#125;                            │</span><br><span class="line">│      2. Never flip roles! Never instruct me!                                                      │</span><br><span class="line">│      3. You must decline my instruction honestly if you cannot perform it                         │</span><br><span class="line">│      4. Always start with: Solution: &lt;YOUR_SOLUTION&gt;                                              │</span><br><span class="line">│      5. Always end with: Next request.                                                            │</span><br><span class="line">│      &quot;&quot;&quot;                                                                                          │</span><br><span class="line">│      ```                                                                                          │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 3. **关键机制**                                                                                   │</span><br><span class="line">│    - **角色固定**：确保每个智能体在对话过程中保持其角色身份，避免混淆。                           │</span><br><span class="line">│    - **格式规范**：确保回复的格式一致，便于用户理解和后续处理。                                   │</span><br><span class="line">│    - **启发式提示**：通过预定义的提示词引导智能体完成任务，同时保持与人类意图的一致性。           │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ #### 二、使用场景                                                                                 │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 1. **教育与培训**                                                                                 │</span><br><span class="line">│    -                                                                                              │</span><br><span class="line">│ **角色扮演任务**：例如，创建一个健康顾问角色，为用户提供饮食和锻炼建议。通过思维链方式逐步提供健  │</span><br><span class="line">│ 康方案。                                                                                          │</span><br><span class="line">│    - **代码生成任务**：利用 CodePromptTemplateDict 创建一个任务                                   │</span><br><span class="line">│ Agent，帮助用户学习新的编程语言，逐步生成学习计划，包括基本概念、代码示例和练习题目。             │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 2. **客户服务**                                                                                   │</span><br><span class="line">│    - **虚拟助手**：创建不同领域的虚拟助手，如技术支持、销售咨询等，提供专业的解答和服务。         │</span><br><span class="line">│    - **客户互动**：通过角色扮演机制，模拟客户与服务人员的对话，提高服务质量。                     │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 3. **多智能体协作**                                                                               │</span><br><span class="line">│    -                                                                                              │</span><br><span class="line">│ **复杂任务处理**：在多智能体系统中，通过角色扮演机制协调多个智能体的协作，完成复杂的任务。例如，  │</span><br><span class="line">│ 交通管理、分布式机器人系统、经济市场模拟等。                                                      │</span><br><span class="line">│    - **团队合作**：模拟团队成员之间的互动，提高团队协作效率。                                     │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 4. **研究与开发**                                                                                 │</span><br><span class="line">│    -                                                                                              │</span><br><span class="line">│ **对话数据生成**：利用角色扮演生成对话数据，用于研究代理社会的行为和能力，为调查对话语言模型提供  │</span><br><span class="line">│ 宝贵的资源。                                                                                      │</span><br><span class="line">│    - **行为分析**：通过角色扮演模拟不同情境下的对话，分析智能体的行为和决策过程。                 │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ #### 三、总结                                                                                     │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ CAMEL 框架的 RolePlaying                                                                          │</span><br><span class="line">│ 机制通过角色定义、交互规则和关键机制，确保智能体在对话过程中保持角色一致性，提供高质量的回复。这  │</span><br><span class="line">│ 一机制广泛应用于教育、客户服务、多智能体协作和研究开发等多个领域，为实现复杂任务提供了有力支持。  │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">================================================================================</span><br><span class="line">💾 是否保存结果到文件? [y/n] (n): n</span><br><span class="line">🔄 是否继续查询? [y/n] (y): y</span><br><span class="line"></span><br><span class="line">💭 请输入您的问题 ():  详细说明camel框架roleplaying的特点以及使用场景</span><br><span class="line"></span><br><span class="line">🔍 选择检索模式</span><br><span class="line">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┓</span><br><span class="line">┃ 模式         ┃ 描述              ┃ 特点                     ┃</span><br><span class="line">┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━┩</span><br><span class="line">│ 1. 快速检索  │ 基础向量检索      │ 速度快，适合简单查询     │</span><br><span class="line">│ 2. 深度检索  │ 查询重写+HyDE+RRF │ 准确度高，适合复杂查询   │</span><br><span class="line">│ 3. 主题检索  │ PDF+网页综合分析  │ 信息全面，适合研究性查询 │</span><br><span class="line">└──────────────┴───────────────────┴──────────────────────────┘</span><br><span class="line">请选择检索模式 [1/2/3] (1): 3</span><br><span class="line">⏳ 正在执行主题检索...</span><br><span class="line">⏱ 开始监控: enhanced_query_主题检索</span><br><span class="line"></span><br><span class="line">🔍 执行主题检索: 详细说明camel框架roleplaying的特点以及使用场景</span><br><span class="line">============================================================</span><br><span class="line">🌐 执行主题检索...</span><br><span class="line">📄 步骤1: PDF文档检索</span><br><span class="line">⏱ 开始监控: vector_query</span><br><span class="line">✅ 检索到 5 个相关文档</span><br><span class="line">✓ 操作完成: vector (耗时: 0.08s, 内存: 1879.9MB)</span><br><span class="line">🔍 步骤2: 网页研究</span><br><span class="line"></span><br><span class="line">开始网页研究: 详细说明camel框架roleplaying的特点以及使用场景</span><br><span class="line">==================================================</span><br><span class="line">使用DuckDuckGo搜索...</span><br><span class="line">⚠ DuckDuckGo搜索失败: https://duckduckgo.com/?q=%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8Ecamel%E6%A1%86%E6%9E%B6roleplaying%E7%9A%84%E7%89%B9%E7%82%B9%E4%BB%A5%E5%8F%8A%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF 202 Ratelimit</span><br><span class="line">使用备用搜索方法...</span><br><span class="line">✓ 备用搜索完成，生成 3 个模拟结果</span><br><span class="line">✓ 找到 3 个搜索结果</span><br><span class="line">正在获取网页内容 1/3: 关于详细说明camel框架roleplaying的特点以及使用场景的学术资源...</span><br><span class="line">✓ 成功获取内容 (706字符)</span><br><span class="line">正在获取网页内容 2/3: 详细说明camel框架roleplaying的特点以及使用场景 - 维基百科...</span><br><span class="line">✓ 成功获取内容 (3003字符)</span><br><span class="line">正在获取网页内容 3/3: 详细说明camel框架roleplaying的特点以及使用场景技术文档...</span><br><span class="line">⚠ 网页内容获取失败 (https://docs.example.com): HTTPSConnectionPool(host=&#x27;docs.example.com&#x27;, port=443): Max retries exceeded with url: / (Caused by SSLError(SSLEOFError(8, &#x27;[SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1006)&#x27;)))</span><br><span class="line">⚠ 内容获取失败</span><br><span class="line">✓ 网页研究完成，分析了 2 个网页</span><br><span class="line">🧩 步骤3: 综合分析</span><br><span class="line">API调用尝试 1/3</span><br><span class="line">✓ API调用成功</span><br><span class="line">✓ 操作完成: enhanced (耗时: 34.56s, 内存: 1867.2MB)</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line">╭──────────────────────────────────────────── 查询信息 ─────────────────────────────────────────────╮</span><br><span class="line">│ 🔍 查询: 详细说明camel框架roleplaying的特点以及使用场景                                           │</span><br><span class="line">│ 🔧 方法: 主题检索(PDF+网页)                                                                       │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭─────────────────────────────────────────── 💡 生成答案 ───────────────────────────────────────────╮</span><br><span class="line">│ **CAMEL框架中的RolePlaying机制详解及其应用场景**                                                  │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ ### 特点                                                                                          │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 1. **角色扮演（Role-Playing）**：                                                                 │</span><br><span class="line">│    -                                                                                              │</span><br><span class="line">│ **角色定义**：CAMEL框架中的RolePlaying机制允许为不同的智能体（Agent）定义独特的角色，如“健康顾问” │</span><br><span class="line">│ 、“股票交易员”等。每个角色都有明确的目标和行为准则，确保智能体在交互中保持角色一致性。            │</span><br><span class="line">│    - **角色固定**：防止智能体在对话中角色翻转，确保对话的稳定性和连贯性。                         │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 2. **交互规则**：                                                                                 │</span><br><span class="line">│    - **系统消息**：通过预定义的系统消息（System                                                   │</span><br><span class="line">│ Message），为智能体设定交互规则。例如，智能体必须始终记得自己的角色，不得指令用户，如果无法执行任 │</span><br><span class="line">│ 务则应诚实地拒绝。                                                                                │</span><br><span class="line">│    - **格式规范**：要求智能体的回复具有固定的开始和结束格式，如“Solution: &lt;YOUR_SOLUTION&gt;”和“Next │</span><br><span class="line">│ request.”，确保对话的结构化和清晰度。                                                             │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 3. **大语言模型（LLMs）**：                                                                       │</span><br><span class="line">│    -                                                                                              │</span><br><span class="line">│ **认知增强**：每个智能体都使用大语言模型来增强其认知能力，使其能够理解和生成自然语言，从而有效地  │</span><br><span class="line">│ 解释指令、生成响应并参与复杂对话。                                                                │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 4. **记忆（Memory）**：                                                                           │</span><br><span class="line">│    - **上下文记忆**：智能体能够记住对话的历史，以便在对话中做出更合理的回应。                     │</span><br><span class="line">│    - **外部记忆**：智能体还可以访问外部知识库，以获取更多背景信息和支持。                         │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 5. **工具（Tools）**：                                                                            │</span><br><span class="line">│    -                                                                                              │</span><br><span class="line">│ **具身化能力**：智能体可以使用一系列工具与外部世界交互，如调用API、查询数据库等，这些工具增强了智 │</span><br><span class="line">│ 能体的实用性和灵活性。                                                                            │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 6. **通信（Communication）**：                                                                    │</span><br><span class="line">│    -                                                                                              │</span><br><span class="line">│ **灵活通信**：CAMEL框架支持智能体之间的灵活通信，允许它们在多智能体系统中进行协作或竞争，以实现更 │</span><br><span class="line">│ 复杂的行为和决策。                                                                                │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 7. **推理（Reasoning）**：                                                                        │</span><br><span class="line">│    - **规划与学习**：智能体具备规划能力和奖励学习机制，能够优化任务完成的过程，提高效率和效果。   │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ ### 应用场景                                                                                      │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 1. **教育与培训**：                                                                               │</span><br><span class="line">│    -                                                                                              │</span><br><span class="line">│ **个性化教学**：通过角色扮演，智能体可以根据学生的需求提供个性化的教学内容，如逐步生成编程学习计  │</span><br><span class="line">│ 划，包括基本概念、代码示例和练习题目。                                                            │</span><br><span class="line">│    - **模拟训练**：在医疗、军事等领域，智能体可以模拟专家或对手，为学员提供真实的训练环境。       │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 2. **客户服务**：                                                                                 │</span><br><span class="line">│    - **虚拟助手**：智能体可以扮演客服代表，为用户提供产品咨询、技术支持等服务，提升客户体验。     │</span><br><span class="line">│    - **情感支持**：智能体可以扮演心理顾问，为用户提供情感支持和心理健康建议。                     │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 3. **金融与交易**：                                                                               │</span><br><span class="line">│    - **交易机器人**：智能体可以开发为交易机器人，协助用户进行股票市场分析和交易决策。             │</span><br><span class="line">│    - **风险管理**：智能体可以通过角色扮演模拟不同的市场情景，帮助用户评估和管理投资风险。         │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 4. **娱乐与游戏**：                                                                               │</span><br><span class="line">│    - **互动故事**：智能体可以参与创造互动故事，与用户进行动态对话，提供沉浸式的娱乐体验。         │</span><br><span class="line">│    - **多人游戏**：在多人在线游戏中，智能体可以扮演NPC（非玩家角色），增加游戏的真实感和趣味性。  │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 5. **科研与实验**：                                                                               │</span><br><span class="line">│    -                                                                                              │</span><br><span class="line">│ **社会行为研究**：通过角色扮演生成对话数据，研究社会行为和群体动态，为社会科学提供宝贵的数据资源  │</span><br><span class="line">│ 。                                                                                                │</span><br><span class="line">│    - **技术验证**：智能体可以在模拟环境中验证新技术的效果，如自动驾驶算法、机器人协作等。         │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ ### 总结                                                                                          │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ CAMEL框架的RolePlaying机制通过角色定义、交互规则、大语言模型、记忆、                              │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">================================================================================</span><br><span class="line">💾 是否保存结果到文件? [y/n] (n): n</span><br><span class="line">🔄 是否继续查询? [y/n] (y): y</span><br><span class="line"></span><br><span class="line">💭 请输入您的问题 ():  详细说明camel框架roleplaying的特点以及使用场景</span><br><span class="line"></span><br><span class="line">🔍 选择检索模式</span><br><span class="line">┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┓</span><br><span class="line">┃ 模式         ┃ 描述              ┃ 特点                     ┃</span><br><span class="line">┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━┩</span><br><span class="line">│ 1. 快速检索  │ 基础向量检索      │ 速度快，适合简单查询     │</span><br><span class="line">│ 2. 深度检索  │ 查询重写+HyDE+RRF │ 准确度高，适合复杂查询   │</span><br><span class="line">│ 3. 主题检索  │ PDF+网页综合分析  │ 信息全面，适合研究性查询 │</span><br><span class="line">└──────────────┴───────────────────┴──────────────────────────┘</span><br><span class="line">请选择检索模式 [1/2/3] (1): 1</span><br><span class="line">⏳ 正在执行快速检索...</span><br><span class="line">⏱ 开始监控: enhanced_query_快速检索</span><br><span class="line"></span><br><span class="line">🔍 执行快速检索: 详细说明camel框架roleplaying的特点以及使用场景</span><br><span class="line">============================================================</span><br><span class="line">⚡ 执行快速检索...</span><br><span class="line">⏱ 开始监控: vector_query</span><br><span class="line">✅ 检索到 3 个相关文档</span><br><span class="line">✓ 操作完成: vector (耗时: 0.07s, 内存: 1864.9MB)</span><br><span class="line">API调用尝试 1/3</span><br><span class="line">✓ API调用成功</span><br><span class="line">✓ 操作完成: enhanced (耗时: 11.97s, 内存: 1860.7MB)</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line">╭──────────────────────────────────────────── 查询信息 ─────────────────────────────────────────────╮</span><br><span class="line">│ 🔍 查询: 详细说明camel框架roleplaying的特点以及使用场景                                           │</span><br><span class="line">│ 🔧 方法: 快速检索                                                                                 │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line"></span><br><span class="line">📄 检索到的文档 (共3个):</span><br><span class="line">╭───────────────────────────────────────────── 文档 1 ──────────────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.8732                                                                                │</span><br><span class="line">│ 内容预览: 如果你无法回答问题就说我不知道。                                                        │</span><br><span class="line">│ &quot;&quot;&quot;                                                                                               │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ model = ModelFactory.create(                                                                      │</span><br><span class="line">│         model_platform=ModelPlatformType.OPENAI_COMPATIBLE_MODEL,                                 │</span><br><span class="line">│         model_type=&quot;Qwen/Qwen2.5-72B-Instruct&quot;,                                                   │</span><br><span class="line">│         url=&#x27;https://api-infe...                                                                  │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────────────── 文档 2 ──────────────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.8648                                                                                │</span><br><span class="line">│ 内容预览:                                                                                         │</span><br><span class="line">│ 2. 使用API 调用模型                                                                               │</span><br><span class="line">│ 类 Unix 系统（Linux / macOS）                                                                     │</span><br><span class="line">│   在终端执行：                                                                                    │</span><br><span class="line">│ export MODELSCOPE_SDK_TOKEN=&quot;你的ModelScope 令牌&quot;                                                 │</span><br><span class="line">│ Windows 系统                                                                                      │</span><br><span class="line">│   命令提示符（CMD）：                                                                             │</span><br><span class="line">│ set MODELSCOPE_SDK_TOKEN=&quot;你的ModelScope 令牌&quot;                                                    │</span><br><span class="line">│   PowerShell：                                                                                    │</span><br><span class="line">│ $env:MODELSCOP...                                                                                 │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭───────────────────────────────────────────── 文档 3 ──────────────────────────────────────────────╮</span><br><span class="line">│ 相关度分数: 0.8580                                                                                │</span><br><span class="line">│ 内容预览: 和结构化对话机制，实现智能体之间的有效协作。                                            │</span><br><span class="line">│ 在CAMEL 框架中，ChatAgent 是最基础的智能体单元，负责处理对话逻辑和任务执行。而                    │</span><br><span class="line">│ RolePlaying 和Workforce 则是多智能体系统，用于协调多个智能体的协作。                              │</span><br><span class="line">│ 详见我们的开源仓库和项目主页                                                                      │</span><br><span class="line">│ •                                                                                                 │</span><br><span class="line">│ 论文：https://ghli.org/camel.pdf                                                                  │</span><br><span class="line">│ •                                                                                                 │</span><br><span class="line">│ 项目主页：https://www.camel-ai.o...                                                               │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">╭─────────────────────────────────────────── 💡 生成答案 ───────────────────────────────────────────╮</span><br><span class="line">│ **Camel框架RolePlaying的特点：**                                                                  │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 1.                                                                                                │</span><br><span class="line">│ **角色定义明确**：RolePlaying机制中，每个智能体都有明确的角色定义，如Assistant（执行任务）、User  │</span><br><span class="line">│ （提供指令）及特定领域的专家角色（如程序员、交易员等），确保智能体在对话中扮演合适的角色。        │</span><br><span class="line">│ 2.                                                                                                │</span><br><span class="line">│ **防止角色翻转**：通过预设的规则和提示词，智能体被设计为不会忘记自己的角色身份，避免了角色间的混  │</span><br><span class="line">│ 淆，保证了对话的连贯性和逻辑性。                                                                  │</span><br><span class="line">│ 3.                                                                                                │</span><br><span class="line">│ **固定格式的回复**：为了提高交流的效率和清晰度，智能体的回复被要求采用固定的格式，例如以“Solution │</span><br><span class="line">│ :”开头，“Next request.”结尾，使得用户能够快速理解智能体的回应。                                   │</span><br><span class="line">│ 4.                                                                                                │</span><br><span class="line">│ **解决常见问题**：RolePlaying机制还解决了智能体间可能遇到的其他问题，如助手重复指令、产生模糊回复 │</span><br><span class="line">│ 、消息无限循环以及对话过早或不当终止等问题。                                                      │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ **使用场景：**                                                                                    │</span><br><span class="line">│                                                                                                   │</span><br><span class="line">│ 1.                                                                                                │</span><br><span class="line">│ **多智能体协作**：在需要多个智能体协同工作的场景中，RolePlaying可以帮助这些智能体有效地分工合作， │</span><br><span class="line">│ 比如在虚拟团队中模拟不同角色进行项目管理。                                                        │</span><br><span class="line">│ 2.                                                                                                │</span><br><span class="line">│ **教育和培训**：在教育领域，RolePlaying可以用于创建模拟情景，让学生或员工在其中扮演特定角色，通过 │</span><br><span class="line">│ 互动学习解决问题的方法和技巧。                                                                    │</span><br><span class="line">│ 3.                                                                                                │</span><br><span class="line">│ **客户服务**：在客服行业中，RolePlaying可以用来模拟客户与服务代表之间的对话，提高服务人员的应对能 │</span><br><span class="line">│ 力和沟通技巧。                                                                                    │</span><br><span class="line">│ 4.                                                                                                │</span><br><span class="line">│ **研究和开发**：对于研究对话系统和多智能体系统的学者和开发者，RolePlaying提供了一个强大的工具，用 │</span><br><span class="line">│ 于测试和改进算法，研究智能体的社会行为和交互模式。                                                │</span><br><span class="line">╰───────────────────────────────────────────────────────────────────────────────────────────────────╯</span><br><span class="line">================================================================================</span><br><span class="line">💾 是否保存结果到文件? [y/n] (n): n </span><br><span class="line">🔄 是否继续查询? [y/n] (y): n</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">📊 最终性能报告</span><br><span class="line">============================================================</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">性能监控报告</span><br><span class="line">============================================================</span><br><span class="line">总操作数: 12</span><br><span class="line">整体成功率: 100.0%</span><br><span class="line">总耗时: 284.34秒</span><br><span class="line">平均耗时: 23.69秒</span><br><span class="line">平均内存使用: 1902.5MB</span><br><span class="line"></span><br><span class="line">操作详情:</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">add:</span><br><span class="line">  调用次数: 1</span><br><span class="line">  成功率: 100.0%</span><br><span class="line">  平均耗时: 92.37秒</span><br><span class="line">  平均内存: 2280.5MB</span><br><span class="line"></span><br><span class="line">setup:</span><br><span class="line">  调用次数: 1</span><br><span class="line">  成功率: 100.0%</span><br><span class="line">  平均耗时: 92.39秒</span><br><span class="line">  平均内存: 2280.5MB</span><br><span class="line"></span><br><span class="line">vector:</span><br><span class="line">  调用次数: 7</span><br><span class="line">  成功率: 100.0%</span><br><span class="line">  平均耗时: 0.14秒</span><br><span class="line">  平均内存: 1818.0MB</span><br><span class="line"></span><br><span class="line">enhanced:</span><br><span class="line">  调用次数: 3</span><br><span class="line">  成功率: 100.0%</span><br><span class="line">  平均耗时: 32.87秒</span><br><span class="line">  平均内存: 1847.9MB</span><br><span class="line"></span><br><span class="line">============================================================</span><br><span class="line">💾 是否保存结果到文件? [y/n] (n): n</span><br><span class="line">✅ 感谢使用增强的交互式多模态RAG系统!</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/AI/" rel="tag"># AI</a>
              <a href="/tags/CAMEL/" rel="tag"># CAMEL</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/07/21/Agent-camel%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%884%EF%BC%89/" rel="prev" title="Agent-camel框架学习记录（4）">
                  <i class="fa fa-angle-left"></i> Agent-camel框架学习记录（4）
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Su Tang</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
